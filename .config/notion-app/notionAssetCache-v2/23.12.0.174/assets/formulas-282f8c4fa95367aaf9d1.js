"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9447],{23790:(e,t,n)=>{n.d(t,{qT:()=>s,xK:()=>u,uy:()=>l,Jy:()=>d});var a=n(606);const r=n(85).hqk,o=n(85).FH8,i=n(85).MWD;function s(e,t){return Array.isArray(t)?t.some((t=>s(e,t))):"unknown"===e[i]||"unknown"===t[i]||"expression"===t[i]||e[i]===t[i]&&("block"===e[i]||"select"===e[i]||"function"===e[i]?d(e,t):"array"!==e[i]||"array"!==t[i]||s(e.of,t.of))}function u(e,t){return!!s(e,t)||(s({[i]:"checkbox"},t)?{[i]:"checkbox"}:s({[i]:"text"},t)?{[i]:"text"}:!!s({[i]:"array",of:{[i]:"text"}},t)&&{[i]:"array",of:{[i]:"text"}})}function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=n?d:(e,t)=>e[i]===t[i];return a(e,t)||"array"===e[i]&&a(e.of,t)}function d(e,t){return e[i]===t[i]&&("block"===e[i]&&"block"===t[i]?void 0===e[o]?void 0===t[o]:void 0!==t[o]&&(0,a.qo)(e[o],t[o]):"select"===e[i]&&"select"===t[i]?(0,a.qo)(e[o],t[o])&&e.property===t.property:"array"===e[i]&&"array"===t[i]?d(e.of,t.of):"function"!==e[i]||"function"!==t[i]||e[r]===t[r]&&void 0!==e.boundTargetType==(void 0!==t.boundTargetType))}},15322:(e,t,n)=>{n.r(t),n.d(t,{addTypesToFormulaASTAsync:()=>lr,analyzeFormula:()=>Cr,convertCollectionFormulaToFormula2:()=>Ir,convertFormulaCSTToAST:()=>Re,createFormulaDataRequestHandler:()=>c.yf,createFormulaDataRequestSyncHandler:()=>c.lc,evaluateFormulaASTAsync:()=>ka,executeFormulaAsync:()=>Sr,executeFormulaSync:()=>Fr,formulaResultAndOldFormulaValueEqual:()=>c.hV,getFormula2Dependencies:()=>Br,getFormulaEditorInfoAtPosition:()=>Lr,getMessageForFormulaEvaluatorError:()=>Ta.OY,getMessageForFormulaTypecheckError:()=>Ta.ic,getNodeOfInterestForFormulaTypecheckError:()=>Ta.sB,isUniqueFormulaEvaluatorError:()=>c.hp,parseFormulaInput:()=>kn,processFormulaInput:()=>Ue});var a=n(68626),r=n(7406),o=n(84116),i=(n(92087),n(77090)),s=n(96486),u=n.n(s),l=n(6287),d=n(47218),c=n(78106);const f=n(85).SPm,m=n(85).tY4,v=n(85).UIu,h=n(85).nq,p=n(85).TP7,y=n(85).TfR,b=n(85).hoK,x=n(85).ZsM,g=n(85).tj7,k=n(85).yk$,w=n(85).hpz,T=n(85).P_6,E=n(85).STy,P=n(85).Xqk,V=n(85).W3s,L=n(85).NZ$,R=n(85).WVG,A=n(85).Osc,N=n(85).G1v,O=n(85)._kS,D=n(85).skr,M=n(85).Mfg,G=n(85).IsR,I=n(85).Huq,F=n(85).H8L,S=n(85).NUU,C=n(85).vuL,B=n(85).bQp,q=n(85).Kjt,W=n(85).VhE,U=n(85).Sif,Y=n(85).yp3,j=n(85).s5F;const _=u().memoize((()=>function(){const e=(0,i.V3)({name:j,[Y]:i.hW.NA}),t=(0,i.V3)({name:"UnaryOperator",[Y]:i.hW.NA}),n=(0,i.V3)({name:"Plus",[Y]:/\+/,[U]:e}),a=(0,i.V3)({name:"Minus",[Y]:/-/,[U]:[e,t]}),r=(0,i.V3)({name:"ExclamationPoint",[Y]:/!/,[U]:t}),s=(0,i.V3)({name:W,[Y]:i.hW.NA}),u=(0,i.V3)({name:"Multi",[Y]:/\*/,[U]:s}),d=(0,i.V3)({name:"Div",[Y]:/\//,[U]:s}),f=(0,i.V3)({name:"Modulo",[Y]:/%/,[U]:s}),m=(0,i.V3)({name:"Caret",[Y]:/\^/}),v=(0,i.V3)({name:q,[Y]:i.hW.NA}),h=(0,i.V3)({name:"True",[Y]:/true/i,[U]:v}),p=(0,i.V3)({name:"False",[Y]:/false/i,[U]:v}),y=(0,i.V3)({name:"And",[Y]:/and|&&/i}),b=(0,i.V3)({name:"Or",[Y]:/or|\|\|/i}),x=(0,i.V3)({name:"Not",[Y]:/not/i,[U]:t}),g=(0,i.V3)({name:B,[Y]:i.hW.NA}),k=(0,i.V3)({name:"LessThan",[Y]:/<=?/,[U]:g}),w=(0,i.V3)({name:"GreaterThan",[Y]:/>=?/,[U]:g}),T=(0,i.V3)({name:"EqualityOperator",[Y]:i.hW.NA}),E=(0,i.V3)({name:"Equal",[Y]:/==/,[U]:T}),P=(0,i.V3)({name:"NotEqual",[Y]:/!=/,[U]:T}),V=(0,i.V3)({name:"LParen",[Y]:/\(/}),L=(0,i.V3)({name:"RParen",[Y]:/\)/}),R=(0,i.V3)({name:"LBracket",[Y]:/\[/}),A=(0,i.V3)({name:"RBracket",[Y]:/\]/}),N=(0,i.V3)({name:"Comma",[Y]:/,/}),O=(0,i.V3)({name:"Dot",[Y]:/\./}),D=(0,i.V3)({name:"QuestionMark",[Y]:/\?/}),_=(0,i.V3)({name:"Colon",[Y]:/:/}),$=(0,i.V3)({name:C,[Y]:/"(?:[^\\"]|\\.)*"/,[S]:['"']}),X=(0,i.V3)({name:F,[Y]:/"(?:[^\\"]|\\.)*/,[S]:['"']}),H=(0,i.V3)({name:"NumberLiteral",[Y]:/(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),z=(0,i.V3)({name:"Comment",[Y]:/\/\*(?:[^*]|\*(?:[^\/]))*\*\//,group:i.hW.SKIPPED,[S]:["/*"]}),J=(0,i.V3)({name:"UnclosedComment",[Y]:/\/\*(?:[^*]|\*(?:[^\/]))*/,group:i.hW.SKIPPED,[S]:["/*"]}),Z=(0,i.V3)({name:I,[Y]:{exec:(e,t)=>{if(!e.startsWith(o.Eb,t))return null;const n=e.substring(t),a=o.kA.exec(n);if(null!==a){const e=[a[0]],t=(0,c.i0)(a[1]);let n;if(void 0!==a[2])n={type:o.Oy[G],property:t,collection:{table:l.v,id:a[3],spaceId:a[4]}};else{if(!o.WG.includes(t))return null;n={type:o.Oy[G],property:t,collection:void 0}}return e.payload=n,e}const r=o.QQ.exec(n);if(null!==r){const e=[r[0]],t={type:o.Oy.Block,blockId:r[1],spaceId:void 0!==r[2]?r[2].substring(1):void 0};return e.payload=t,e}const i=o.eO.exec(n);if(null!==i){const e=[i[0]],t={type:o.Oy.Person,userId:i[1]};return e.payload=t,e}const s=o.Ci.exec(n);if(null!==s){const e=[s[0]],t={type:o.Oy.UserProperty,userProperty:s[1]};return e.payload=t,e}const u=o.DF.exec(n);if(null!==u){const e=[u[0]],t={type:o.Oy.Checkbox,checked:"true"===u[1]};return e.payload=t,e}const d=o.Uq.exec(n);if(null!==d){const e=[d[0]],t=(0,c.wf)(d[1]),n={type:o.Oy.ContextValue,valueId:t};return e.payload=n,e}const f=o.Xm.exec(n);if(null!==f){const e=[f[0]],t={type:o.Oy.Date,date:(0,c.DF)(f[1])};return e.payload=t,e}return null}},line_breaks:!1,[S]:[o.Eb]}),Q=(0,i.V3)({name:M,[Y]:(K=/[\p{Letter}_][\p{Number}\p{Letter}_]*/u,(e,t)=>{const n=new RegExp(K.source,`${K.flags}y`);return n.lastIndex=t,n.exec(e)}),line_breaks:!1});var K;return{WhiteSpace:(0,i.V3)({name:"WhiteSpace",[Y]:/\s+/,group:i.hW.SKIPPED}),NumberLiteral:H,[C]:$,[F]:X,Comment:z,UnclosedComment:J,[I]:Z,True:h,False:p,And:y,Or:b,Not:x,[M]:Q,Equal:E,NotEqual:P,Plus:n,Minus:a,ExclamationPoint:r,Multi:u,Div:d,Modulo:f,Caret:m,LParen:V,RParen:L,LBracket:R,RBracket:A,[j]:e,[W]:s,LessThan:k,GreaterThan:w,QuestionMark:D,Colon:_,Comma:N,Dot:O,UnaryOperator:t,EqualityOperator:T,[B]:g,[q]:v}}()));const $=u().memoize((e=>new i.hW(function(e){return Object.values(e)}(e))));class X extends i.wd{constructor(e){super(Object.values(e),{recoveryEnabled:!0,nodeLocationTracking:"onlyOffset"}),this[D]=void 0,this[O]=this.RULE(O,(()=>{this[N](this[A])})),this[R]=this.RULE(R,(()=>{this.OR([{ALT:()=>this[N](this[L])},{ALT:()=>this[N](this[V])},{ALT:()=>this[P](this[D].NumberLiteral)},{ALT:()=>this[P](this[D][C])},{ALT:()=>this[P](this[D][F])},{ALT:()=>this[P](this[D][q])},{ALT:()=>this[P](this[D][M])},{ALT:()=>this[P](this[D][I])}])})),this[A]=this.RULE(A,(()=>{this[N](this[E],{LABEL:"condition"}),this.OPTION((()=>{this[P](this[D].QuestionMark),this[T](this[E],{LABEL:"expIfTrue"}),this[P](this[D].Colon),this.SUBRULE3(this[E],{LABEL:"expIfFalse"})}))})),this[E]=this.RULE(E,(()=>{this[N](this[w],{LABEL:"lhs"}),this.MANY((()=>{this[P](this[D].Or),this[T](this[w],{LABEL:"rhs"})}))})),this[w]=this.RULE(w,(()=>{this[N](this[k],{LABEL:"lhs"}),this.MANY((()=>{this[P](this[D].And),this[T](this[k],{LABEL:"rhs"})}))})),this[k]=this.RULE(k,(()=>{this[N](this[g],{LABEL:"lhs"}),this.OPTION((()=>{this[P](this[D].EqualityOperator),this[T](this[g],{LABEL:"rhs"})}))})),this[g]=this.RULE(g,(()=>{this[N](this[x],{LABEL:"lhs"}),this.OPTION((()=>{this[P](this[D][B]),this[T](this[x],{LABEL:"rhs"})}))})),this[x]=this.RULE(x,(()=>{this[N](this[b],{LABEL:"lhs"}),this.MANY((()=>{this[P](this[D][j]),this[T](this[b],{LABEL:"rhs"})}))})),this[b]=this.RULE(b,(()=>{this[N](this[y],{LABEL:"lhs"}),this.MANY((()=>{this[P](this[D][W]),this[T](this[y],{LABEL:"rhs"})}))})),this[y]=this.RULE(y,(()=>{this[N](this.unaryExpression,{LABEL:"lhs"}),this.MANY((()=>{this[P](this[D].Caret),this[T](this.unaryExpression,{LABEL:"rhs"})}))})),this.unaryExpression=this.RULE("unaryExpression",(()=>{this.OPTION((()=>{this[P](this[D].UnaryOperator)})),this[N](this[p])})),this[p]=this.RULE(p,(()=>{this[N](this[R]),this.MANY((()=>{this[T](this[h])}))})),this[h]=this.RULE(h,(()=>{this.OR([{ALT:()=>this[N](this[v])},{ALT:()=>this[N](this[m])}])})),this[v]=this.RULE(v,(()=>{this[P](this[D].Dot),this.OR([{ALT:()=>this[P](this[D][M])},{GATE:()=>{var e,t;const n=this.LA(1);return n.tokenType===this[D][I]&&((null===(e=n.payload)||void 0===e?void 0:e.type)===o.Oy[G]||(null===(t=n.payload)||void 0===t?void 0:t.type)===o.Oy.UserProperty)},ALT:()=>this[P](this[D][I])}])})),this[m]=this.RULE(m,(()=>{this[P](this[D].LParen),this.OPTION((()=>{this[N](this[O]),this.MANY((()=>{this[P](this[D].Comma),this[T](this[O])}))})),this[P](this[D].RParen)})),this[L]=this.RULE(L,(()=>{this[P](this[D].LParen),this[N](this[O]),this[P](this[D].RParen)})),this[V]=this.RULE(V,(()=>{this[P](this[D].LBracket),this.OPTION((()=>{this[N](this[O]),this.MANY((()=>{this[P](this[D].Comma),this[T](this[O])}))})),this[P](this[D].RBracket)})),this[D]=e,this.performSelfAnalysis()}}const H=u().memoize((e=>new X(e)));function z(e){const t=/unexpected character: ->(.+)<- at offset/.exec(e[f]);if(null!==t)return{type:d.$E.InvalidCharacter,character:t[1],offset:e.offset};if("unclosed string literal"===e[f])return{type:d.$E[F],offset:e.offset};if("unclosed comment"===e[f])return{type:d.$E.UnclosedComment,offset:e.offset};throw new Error(`Unhandled chevrotain recognition error: ${e[f]}`)}const J={RParen:")",RBracket:"]",Colon:":"};function Z(e){const t=e.token.tokenType===i.sd?"eof":e.token.startOffset;switch(e.name){case"MismatchedTokenException":{const n=/Expecting token of type --> (.+) <-- but found/.exec(e[f]);if(null!==n){const e=n[1],a=J[e];if(void 0!==a)return{type:d.$E.TokenExpected,token:a,offset:t}}break}case"NoViableAltException":{const n=e.context.ruleStack[e.context.ruleStack.length-1];switch(n){case R:return{type:d.$E.ExpressionExpected,offset:t};case v:return{type:d.$E.PropertyTokenOrFunctionExpected,offset:t}}throw new Error(`Unhandled unviable alt: ${n}`)}case"NotAllInputParsedException":return{type:d.$E.EndOfInputExpected,offset:t}}return{type:d.$E.UnexpectedError,error:new Error(`Unhandled chevrotain recognition error: ${e.name}`),offset:t}}const Q=n(85).ffk,K=n(85).FH8,ee=n(85).E3S,te=n(85).UIu,ne=n(85).rGB,ae=n(85).tY4,re=n(85).nq,oe=n(85).TP7,ie=n(85).TfR,se=n(85).VhE,ue=n(85).hoK,le=n(85).s5F,de=n(85).bQp,ce=n(85).l81,fe=n(85).Mfg,me=n(85).Huq,ve=n(85).Kjt,he=n(85).H8L,pe=n(85).TtP,ye=n(85).vuL,be=n(85).g$6,xe=n(85).Mmq,ge=n(85).QYB,ke=n(85).W3s,we=n(85).NZ$,Te=n(85).WVG,Ee=n(85).Osc,Pe=n(85).Fxh,Ve=n(85)._kS;function Le(e){return e.find((e=>void 0!==e&&!isNaN(e)))}function Re(e){const t=function(){const e=_(),t=H(e).getBaseCstVisitorConstructor();return new class extends t{constructor(){super(),this.validateVisitor()}[Ve](e){return this[Pe](e[Ee])}[Te](e){return void 0!==e[we]?this[Pe](e[we]):void 0!==e[ke]?this[Pe](e[ke]):void 0!==e.NumberLiteral?{kind:d.bG.Number,text:e.NumberLiteral[0][ge],[xe]:e.NumberLiteral[0][xe],[be]:e.NumberLiteral[0][be]}:void 0!==e[ye]?{kind:d.bG.String,text:e[ye][0][ge].substring(1,e[ye][0][ge][pe]-1),[xe]:e[ye][0][xe],[be]:e[ye][0][be]}:void 0!==e[he]?{kind:d.bG.String,text:e[he][0][ge].substring(1,e[he][0][ge][pe]),[xe]:e[he][0][xe],[be]:e[he][0][be]}:void 0!==e[ve]?{kind:d.bG.Boolean,text:e[ve][0][ge],[xe]:e[ve][0][xe],[be]:e[ve][0][be]}:void 0!==e[me]?{kind:d.bG.NotionToken,token:e[me][0].payload,[xe]:e[me][0][xe],[be]:e[me][0][be]}:void 0!==e[fe]?{kind:d.bG.Identifier,text:e[fe][0][ge],[xe]:e[fe][0][xe],[be]:e[fe][0][be]}:{kind:d.bG.RecoveryNode,[xe]:-1,[be]:-1}}[Ee](e){const t=this[Pe](e.condition[0]);var n,a,r,o,i,s;return void 0!==e.QuestionMark?{kind:d.bG.Conditional,condition:t,expIfTrue:this[Pe](e.expIfTrue[0]),expIfFalse:void 0!==(null===(n=e.expIfFalse)||void 0===n?void 0:n[0])?this[Pe](e.expIfFalse[0]):void 0,[xe]:e.condition[0][ce][xe],[be]:Le([null===(a=e.expIfFalse)||void 0===a||null===(r=a[0][ce])||void 0===r?void 0:r[be],null===(o=e.Colon)||void 0===o||null===(i=o[0])||void 0===i?void 0:i[be],null===(s=e.expIfTrue[0][ce])||void 0===s?void 0:s[be],e.QuestionMark[0][be]])}:t}logicalOrExpression(e){const t=this[Pe](e.lhs[0]);if(void 0!==e.Or){var n,a,r,o;const i=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this[Pe](e))))??[];return{kind:d.bG.LogicalOr,elements:[t,...i],[xe]:e.lhs[0][ce][xe],[be]:Le([null===(a=e.rhs)||void 0===a||null===(r=a[e.rhs[pe]-1])||void 0===r||null===(o=r[ce])||void 0===o?void 0:o[be],e.Or[0][be]])}}return t}logicalAndExpression(e){const t=this[Pe](e.lhs[0]);if(void 0!==e.And){var n,a,r,o;const i=(null===(n=e.rhs)||void 0===n?void 0:n.map((e=>this[Pe](e))))??[];return{kind:d.bG.LogicalAnd,elements:[t,...i],[xe]:e.lhs[0][ce][xe],[be]:Le([null===(a=e.rhs)||void 0===a||null===(r=a[e.rhs[pe]-1])||void 0===r||null===(o=r[ce])||void 0===o?void 0:o[be],e.And[0][be]])}}return t}equalityExpression(e){const t=this[Pe](e.lhs[0]);if(void 0!==e.EqualityOperator){var n;const a=e.rhs[0];return{kind:d.bG.Equality,op:e.EqualityOperator[0][ge],lhs:t,rhs:this[Pe](a),[xe]:e.lhs[0][ce][xe],[be]:Le([null===(n=a[ce])||void 0===n?void 0:n[be],e.EqualityOperator[0][be]])}}return t}relationalExpression(e){const t=this[Pe](e.lhs[0]);if(void 0!==e[de]){var n;const a=e.rhs[0];return{kind:d.bG.Relational,op:e[de][0][ge],lhs:t,rhs:this[Pe](a),[xe]:e.lhs[0][ce][xe],[be]:Le([null===(n=a[ce])||void 0===n?void 0:n[be],e[de][0][be]])}}return t}additionExpression(e){let t=this[Pe](e.lhs[0]);if(void 0!==e[le])for(let a=0;a<e[le][pe];a++){var n;const r=e.rhs[a];t={kind:d.bG.Additive,op:e[le][a][ge],lhs:t,rhs:this[Pe](r),[xe]:e.lhs[0][ce][xe],[be]:Le([null===(n=r[ce])||void 0===n?void 0:n[be],e[le][a][be]])}}return t}[ue](e){let t=this[Pe](e.lhs[0]);if(void 0!==e[se])for(let a=0;a<e[se][pe];a++){var n;const r=e.rhs[a];t={kind:d.bG.Multiplicative,op:e[se][a][ge],lhs:t,rhs:this[Pe](r),[xe]:e.lhs[0][ce][xe],[be]:Le([null===(n=r[ce])||void 0===n?void 0:n[be],e[se][a][be]])}}return t}[ie](e){let t;const n=this[Pe](e.lhs[0]);if(void 0!==e.Caret){var a;const r=e.Caret[pe]-1;let o,i=null===(a=e.rhs[r][ce])||void 0===a?void 0:a[be];(void 0===i||isNaN(i))&&(i=e.Caret[r][be]);for(let n=e.Caret[pe]-1;n>=0;n--){const a=e.rhs[n];t=void 0===o?this[Pe](a):{kind:d.bG.Exponentiation,op:o,lhs:this[Pe](a),rhs:t,[xe]:a[ce][xe],[be]:i},o=e.Caret[n][ge]}return{kind:d.bG.Exponentiation,op:o,lhs:n,rhs:t,[xe]:e.lhs[0][ce][xe],[be]:i}}return n}unaryExpression(e){const t=this[Pe](e[oe][0]);return void 0!==e.UnaryOperator?{kind:d.bG.Unary,op:e.UnaryOperator[0][ge].toLowerCase(),[Ve]:t,[xe]:e.UnaryOperator[0][xe],[be]:t[be]}:t}[oe](e){let t=this[Pe](e[Te][0]),n=e[Te][0][ce][xe];var a;if(isNaN(n)&&(n=null===(a=e[re])||void 0===a?void 0:a[0][ce][xe]),void 0!==e[re])for(const l of e[re]){const e=l[ce][be];if(void 0!==l[ne][ae]){var r,i,s,u;const a=l[ne][ae][0][ne];t={kind:d.bG.Call,[Ve]:t,arguments:(null===(r=l[ne][ae][0])||void 0===r||null===(i=r[ne][Ve])||void 0===i?void 0:i.map((e=>this[Pe](e))))??[],lParenOffset:a.LParen[0][xe],rParenOffset:null===(s=a.RParen)||void 0===s?void 0:s[0][xe],commaOffsets:(null===(u=a.Comma)||void 0===u?void 0:u.map((e=>e[xe])))??[],[xe]:n,[be]:e}}else if(void 0!==l[ne][te]){const a=l[ne][te][0][ne];if(void 0!==a[fe]){const r=a[fe][0];t={kind:d.bG[ee],[Ve]:t,name:r[ge],nameStartOffset:r[xe],nameEndOffset:r[be],[xe]:n,[be]:e}}else if(void 0!==a[me]){const r=a[me][0],i=r.payload;switch(i.type){case o.Oy.BlockProperty:t={kind:d.bG.MemberBlockProperty,[Ve]:t,propertyToken:void 0===i[K]?{[Q]:i[Q],[K]:void 0}:{[Q]:i[Q],[K]:i[K]},propertyStartOffset:r[xe],propertyEndOffset:r[be],[xe]:n,[be]:e};break;case o.Oy.UserProperty:t={kind:d.bG.MemberUserProperty,[Ve]:t,userProperty:i.userProperty,propertyStartOffset:r[xe],propertyEndOffset:r[be],[xe]:n,[be]:e}}}}}return t}[we](e){return this[Pe](e[Ve][0])}[ke](e){var t,n,a,r,o,i,s;return{kind:d.bG.Array,elements:(null===(t=e[Ve])||void 0===t?void 0:t.map((e=>this[Pe](e))))??[],lBracketOffset:e.LBracket[0][xe],rBracketOffset:null===(n=e.RBracket)||void 0===n?void 0:n[0][xe],commaOffsets:(null===(a=e.Comma)||void 0===a?void 0:a.map((e=>e[xe])))??[],[xe]:e.LBracket[0][xe],[be]:Le([null===(r=e.RBracket)||void 0===r?void 0:r[0][be],null===(o=e[Ve])||void 0===o||null===(i=o[e[Ve][pe]-1])||void 0===i||null===(s=i[ce])||void 0===s?void 0:s[be],e.LBracket[0][be]])}}[re](e){throw new Error("unexpected memberCallSubExpression")}[te](e){throw new Error("unexpected dotMemberExpression")}[ae](e){throw new Error("unexpected callArguments")}}}();try{return{value:t[Pe](e)}}catch(n){return{error:{type:d.$E.UnexpectedError,error:(0,r.tg)(n),offset:0}}}}var Ae=n(80951),Ne=n(34299),Oe=n(60246),De=n(29477),Me=n(606),Ge=n(21202),Ie=n(19889),Fe=n(70203),Se=n(97880),Ce=n(84682),Be=n(21027);const qe=n(85).TtP;function We(e,t,n){let a=0,r=0;for(let o=0;o<e[qe];o++){const i=e[o];switch(i.type){case"code":if(r+i[qe]>=t)return a+(t-r);a+=i[qe],r+=i[qe];break;case"token":if(r+i[qe]>=t)return a+("right"===n?1:0);a+=1,r+=i[qe]}}return r}function Ue(e){let t="";const n=[];return e.forEach((e=>{const a=(0,Fe.getTokenAnnotations)(e),r=(0,c._u)(a);if(void 0!==r)return t+=r,void n.push({type:"token",[qe]:r[qe]});const o=(0,Fe.getTokenValue)(e);t+=o,n.push({type:"code",[qe]:o[qe]})})),[t,n]}function Ye(e,t){return{...e,startOffset:We(t,e.startOffset,"left"),endOffset:We(t,e.endOffset,"left")}}var je=n(5366),_e=n(40506),$e=n(53877),Xe=n(84795),He=n(64340),ze=n(76725),Je=n(4615),Ze=n(63143),Qe=n(23790);const Ke=n(85).iQh,et=n(85).yp3,tt=n(85).FlC,nt=n(85).CEC,at=n(85).ZWc,rt=n(85).JP6,ot=n(85).Q0u,it=n(85).AL1,st=n(85).wbz,ut=n(85).Gpy,lt=n(85)._kS,dt=n(85).w8T,ct=n(85).fB_,ft=n(85).Wkb,mt=n(85).Moc,vt=n(85).ROM,ht=n(85).zDZ,pt=n(85).PX7,yt=n(85).dO7,bt=n(85).mPA,xt=n(85).mqR,gt=n(85).Uz9,kt=n(85).XZk,wt=n(85).tX7,Tt=n(85).MWD,Et=n(85).y4s,Pt=n(85).p_S,Vt=n(85).GA9,Lt=n(85).ZtU,Rt=n(85).eqJ,At=n(85).ff7,Nt=n(85).T9w,Ot=n(85).jxj,Dt=n(85).QbP,Mt=n(85).iF8,Gt=n(85).yFA,It=n(85).ieD,Ft=n(85).Lby,St=n(85).O__,Ct=n(85).XPo,Bt=n(85).fHe,qt=n(85).Wa9,Wt=n(85).d1X,Ut=n(85).urI,Yt=n(85).TtP,jt=n(85).uFt,_t=n(85).OeL,$t=n(85).ge0,Xt=n(85).e2W,Ht=n(85).$FA,zt=n(85).p9g,Jt=n(85).Yii,Zt=n(85).yMG,Qt=n(85)._It,Kt=n(85).GVC,en=n(85).JrN,tn=n(85).fbO,nn=n(85).eiN,an=n(85).nx5;function rn(e){if(!e)throw new Error("Assertion failed in formulaLibraryFunctions")}const on=(0,je.defineMessages)({dateStart:{id:"database.formula2.function.dateStart.description",[an]:"Retrieves the start of a date range."},e:{id:"database.formula2.constant.e.description",[an]:"The base of the natural logarithm."},pi:{id:"database.formula2.constant.pi.description",[an]:"The ratio of a circle's circumference to its diameter."},if:{id:"database.formula2.operator.if.description",[an]:"Switches between two options based on another value."},ifs:{id:"database.formula2.operator.ifs.description",[an]:"Checks whether one or more conditions are met. Returns the value that corresponds to the first true result. Can be used to replace multiple nested IF statements."},add:{id:"database.formula2.operator.add.description",[an]:"Adds two numbers and returns their sum."},at:{id:"database.formula2.operator.at.description",[an]:"Returns the value at the specified index in a list of values."},every:{id:"database.formula2.operator.every.description",[an]:"Returns true if the expression returns true for all entries in a list, and false otherwise."},[nn]:{id:"database.formula2.operator.filter.description",[an]:"Returns the values in the first argument that returned true when run on the expression in the second argument."},find:{id:"database.formula2.operator.find.description",[an]:"Returns the first element in the list for which the second argument returns true."},first:{id:"database.formula2.operator.first.description",[an]:"Returns the first element in a list."},flat:{id:"database.formula2.operator.flat.description",[an]:"Flattens a list of lists into a single list."},[tn]:{id:"database.formula2.operator.includes.description",[an]:"Returns true if the list contains the specified value, and false otherwise."},last:{id:"database.formula2.operator.last.description",[an]:"Returns the last element in a list."},map:{id:"database.formula2.operator.map.description",[an]:"Returns a list of the results of applying the second argument to each element in the first argument."},reverse:{id:"database.formula2.operator.reverse.description",[an]:"Reverses the order of elements in a list."},slice:{id:"database.formula2.operator.slice.description",[an]:"Returns a subset of the input list, from the provided start index (inclusively) to the end index (optional and exclusively)."},[en]:{id:"database.formula2.operator.findIndex.description",[an]:"Returns the index of the first element in the list for which the second argument returns true."},unique:{id:"database.formula2.operator.unique.description",[an]:"Returns a list of unique values in the input list."},toPlainText:{id:"database.formula2.operator.toPlainText.description",[an]:"Returns the plain text representation of the input text."},toText:{id:"database.formula2.operator.toText.description",[an]:"Returns the text representation of the input value."},sort:{id:"database.formula2.operator.sort.description",[an]:"Returns a sorted version of the input list"},some:{id:"database.formula2.operator.some.description",[an]:"Returns true if the provided expression returns true for any entry in the list, and false otherwise."},let:{id:"database.formula2.operator.let.description",[an]:"Introduces a variable by the name of the first argument and the value of the second argument and returns the result of the expression which can use the variable."},lets:{id:"database.formula2.operator.lets.description",[an]:"Introduces multiple variables and returns the result of an expression which can use the variables."},sum:{id:"database.formula2.operator.sum.description",[an]:"Sums a list of numbers."},subtract:{id:"database.formula2.operator.subtract.description",[an]:"Subtracts two numbers and returns their difference."},multiply:{id:"database.formula2.operator.multiply.description",[an]:"Multiplies two numbers and returns their product."},divide:{id:"database.formula2.operator.divide.description",[an]:"Divides two numbers and returns their quotient."},pow:{id:"database.formula2.operator.pow.description",[an]:"Returns the result of a base number raised to an exponent power."},mod:{id:"database.formula2.operator.mod.description",[an]:"Divides two numbers and returns their remainder."},unaryMinus:{id:"database.formula2.operator.unaryMinus.description",[an]:"Negates a number."},unaryPlus:{id:"database.formula2.operator.unaryPlus.description",[an]:"Converts its argument into a number."},not:{id:"database.formula2.operator.not.description",[an]:"Returns the logical NOT of its argument."},and:{id:"database.formula2.operator.and.description",[an]:"Returns the logical AND of its two arguments."},or:{id:"database.formula2.operator.or.description",[an]:"Returns the logical OR of its two arguments."},equal:{id:"database.formula2.operator.equal.description",[an]:Kt},unequal:{id:"database.formula2.operator.unequal.description",[an]:Qt},larger:{id:"database.formula2.operator.larger.description",[an]:Zt},largerEq:{id:"database.formula2.operator.largerEq.description",[an]:Jt},smaller:{id:"database.formula2.operator.smaller.description",[an]:zt},smallerEq:{id:"database.formula2.operator.smallerEq.description",[an]:Ht},concat:{id:"database.formula2.function.concat.description",[an]:"Concatenates its arguments and returns the result."},join:{id:Xt,[an]:$t},joinText:{id:Xt,[an]:$t},[_t]:{id:"database.formula2.function.slice.description",[an]:jt},[Yt]:{id:"database.formula2.function.length.description",[an]:"Returns the length of a string or a list."},[Ut]:{id:"database.formula2.function.format.description",[an]:"Formats an input as a string"},style:{id:"database.formula2.function.style.description",[an]:"Adds formatting styles to a given input."},unstyle:{id:"database.formula2.function.unstyle.description",[an]:"Removes formatting styles from a given input. If no styles are specified, all styles are removed."},link:{id:"database.formula2.function.link.description",[an]:"Creates a link from a label and a URL."},toNumber:{id:"database.formula2.function.toNumber.description",[an]:"Parses a number from text."},[Wt]:{id:"database.formula2.function.contains.description",[an]:qt},[Bt]:{id:"database.formula2.function.replace.description",[an]:Ct},[St]:{id:"database.formula2.function.replaceAll.description",[an]:Ft},test:{id:"database.formula2.function.test.description",[an]:"Tests if a string matches a regular expression."},empty:{id:"database.formula2.function.empty.description",[an]:"Returns true if a value is empty. 0, “”, and [] are considered empty."},abs:{id:"database.formula2.function.abs.description",[an]:"Returns the absolute value of a number."},cbrt:{id:"database.formula2.function.cbrt.description",[an]:"Returns the cube root of a number."},ceil:{id:"database.formula2.function.ceil.description",[an]:It},exp:{id:"database.formula2.function.exp.description",[an]:Gt},floor:{id:"database.formula2.function.floor.description",[an]:Mt},ln:{id:"database.formula2.function.ln.description",[an]:"Returns the natural logarithm of a number."},log10:{id:"database.formula2.function.log10.description",[an]:"Returns the base 10 logarithm of a number."},log2:{id:"database.formula2.function.log2.description",[an]:"Returns the base 2 logarithm of a number."},max:{id:"database.formula2.function.max.description",[an]:"Returns the largest of zero or more numbers."},min:{id:"database.formula2.function.min.description",[an]:"Returns the smallest of zero or more numbers."},round:{id:"database.formula2.function.round.description",[an]:Dt},sign:{id:"database.formula2.function.sign.description",[an]:Ot},sqrt:{id:"database.formula2.function.sqrt.description",[an]:"Returns the positive square root of a number."},start:{id:"database.formula2.function.start.description",[an]:"Returns the start of a date range."},end:{id:"database.formula2.function.end.description",[an]:"Returns the end of a date range."},now:{id:"database.formula2.function.now.description",[an]:"Returns the current date and time."},[Nt]:{id:"database.formula2.function.timestamp.description",[an]:At},[Rt]:{id:"database.formula2.function.fromTimestamp.description",[an]:Lt},dateAdd:{id:"database.formula2.function.dateAdd.description",[an]:'Add to a date. The last argument, unit, can be one of: "years", "quarters", "months", "weeks", "days", "hours", "minutes", "seconds", or "milliseconds".'},[Vt]:{id:"database.formula2.function.dateSubtract.description",[an]:'Subtract from a date. The last argument, unit, can be one of: "years", "quarters", "months", "weeks", "days", "hours", "minutes", "seconds", or "milliseconds".'},[Pt]:{id:"database.formula2.function.dateBetween.description",[an]:'Calculate the difference between two dates in milliseconds. The last argument, unit, can be one of: "years", "quarters", "months", "weeks", "days", "hours", "minutes", "seconds", or "milliseconds".'},formatDate:{id:"database.formula2.function.formatDate.description",[an]:'Formats a date using a custom format string. The format string can contain tokens that represent parts of the date, like: "yyyy" for the year, "MM" for the month, "dd" for the day, "HH" for the hour, "mm" for the minute, "ss" for the second, "SSS" for the millisecond. Literal characters can be included in the format string by surrounding them with single quotes.'},[Et]:{id:"database.formula2.function.date.description",[an]:"Returns the day of month from a date (1-31)."},day:{id:"database.formula2.function.day.description",[an]:"Returns the day of week of a date, between 1 (Monday) and 7 (Sunday)."},month:{id:"database.formula2.function.month.description",[an]:"Returns the number representation of the month of a date, between 1 and 12."},year:{id:"database.formula2.function.year.description",[an]:"Returns the year of a date."},hour:{id:"database.formula2.function.hour.description",[an]:"Returns the hour of a date."},minute:{id:"database.formula2.function.minute.description",[an]:"Returns the minute of a date."},second:{id:"database.formula2.function.second.description",[an]:"Returns the second of a date."},today:{id:"database.formula2.function.today.description",[an]:"Returns the current date."},parseDate:{id:"database.formula2.function.parseDate.description",[an]:"Parses a date according to the ISO 8601 standard."},dateEnd:{id:"database.formula2.function.dateEnd.description",[an]:"Retrieves the end of a date range."},id:{id:"database.formula2.function.id.description",[an]:"Returns the id of the current page"}});function sn(e,t,n){return{name:e,eval:function*(e,t){return{[Tt]:wt,value:n}},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:"name",[yt]:n.toString()}],[pt]:[e],[ht]:t}}function un(e,t,n){return{name:e,eval:function*(e,t){const[a]=e;return rn("number"===a[Tt]),{[Tt]:wt,value:n(a.value)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:wt}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:`${e}(10)`,[yt]:`${n(10)}`}],[pt]:[`${e}(number)`,`number.${e}()`],[ht]:t}}function ln(e,t,n){return{name:e,eval:function*(e,t){const[a,r]=e;return rn("number"===a[Tt]&&"number"===r[Tt]),{[Tt]:wt,value:n(a.value,r.value)}},[vt]:{[mt]:[{name:"lhs",[Tt]:{[Tt]:wt}},{name:"rhs",[Tt]:{[Tt]:wt}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:`${e}(5, 10)`,[yt]:`${n(5,10)}`}],[pt]:[`${e}(number, number)`,`number.${e}(number)`],[ht]:t}}const dn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];function*cn(e,t){const n=yield*(0,c.PX)(e,t);if(!dn[tn](n))throw new d.Mu({[Tt]:d.sj.DateInvalidDurationUnit,invalidUnit:n});return n}function fn(e){return function*(t,n){const[a,r,o]=t;rn("date"===a[Tt]&&"number"===r[Tt]&&"text"===o[Tt]);const i=(0,$e.getLuxonRange)(a.value,n[ft]).start,s=e(i,r.value,yield*cn(o.value,n));return{[Tt]:Et,value:"date"===a.value[Tt]||"daterange"===a.value[Tt]?(0,$e.date)(s,n[ft]):(0,$e.dateTime)(s,n[ft])}}}function mn(e){return function*(t,n){const[a]=t;return rn("date"===a[Tt]),{[Tt]:wt,value:e((0,$e.getLuxonRange)((0,_e.getStart)(a.value),n[ft],n.intl.locale).start)}}}const vn="currentValue",hn={[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}},{name:lt,[Tt]:{[Tt]:lt},augmentScope:e=>{var t;return{[vn]:"array"===(null===(t=e[0])||void 0===t?void 0:t[Tt])?e[0].of:{[Tt]:dt}}}}]};function pn(e,t,n){return(0,c.LD)(e.map((e=>ga(t,{...n,[ut]:[{kind:o.yp.Binding,id:vn,value:e},...n[ut]]}))))}const yn={[Tt]:st},bn={joinText:{name:"joinText",eval:function*(e){const[t,...n]=e;return rn("text"===t[Tt]),{[Tt]:it,value:(0,Fe.normalizeTextValue)((0,ze.Z)(n.map((e=>(rn("text"===e[Tt]),e.value))),(()=>t.value)).flat())}},[vt]:{[mt]:[{name:"joiner",[Tt]:{[Tt]:it}}],varargs:[{name:"arg",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'joinText(","", "one", "two")',[yt]:"one,two"},{[bt]:'",".joinText("one", "two")',[yt]:"one,two"}],[pt]:["joinText(joiner, text, …)","joiner.joinText(text, …)"],[ht]:on.joinText},[_t]:{name:_t,eval:function*(e,t){const[n,a,r]=e;rn("text"===n[Tt]&&"number"===a[Tt]);const o=yield*(0,c.PX)(n.value,t);return{[Tt]:it,value:[[o.slice(a.value,"number"===(null==r?void 0:r[Tt])?r.value:void 0)]]}},[vt]:{[mt]:[{name:"target",[Tt]:{[Tt]:it}},{name:ot,[Tt]:{[Tt]:wt}},{name:"endIndex",[rt]:!0,[Tt]:{[Tt]:wt}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'substring("Notion", 0 , 2)',[yt]:'"No"'},{[bt]:'"Notion".substring(0, 2)',[yt]:'"No"'}],[pt]:["substring(text, startIndex, endIndex)","substring(text, startIndex)","text.substring(startIndex, endIndex)","text.substring(startIndex)"],[ht]:on[_t]},[Yt]:{name:Yt,eval:function*(e,t){const[n]=e;return"array"===n[Tt]?{[Tt]:wt,value:n[ut][Yt]}:(rn("text"===n[Tt]),{[Tt]:wt,value:n.value.reduce(((e,t)=>e+(0,Fe.getTokenLength)(t)),0)})},[vt]:{[mt]:[{name:bt,[Tt]:[{[Tt]:it},{[Tt]:ct,of:{[Tt]:dt}}]}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:it},[xt]:[{[bt]:'length("hi")',[yt]:"2"},{[bt]:'"hi".length()',[yt]:"2"},{[bt]:"length([1])",[yt]:"1"},{[bt]:"[1].length()",[yt]:"1"}],[pt]:["length(text)","length(list)","text.length()","list.length()"],[ht]:on[Yt]},[Ut]:{name:Ut,eval:function*(e,t){const[n]=e;return rn("text"===n[Tt]),{[Tt]:it,value:(0,Fe.createTextValue)(yield*(0,c.PX)(n.value,t))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:"format(2)",[yt]:'"2"'},{[bt]:"2.format()",[yt]:'"2"'}],[pt]:["format(value)","value.format()"],[ht]:on[Ut]},style:{name:"style",eval:function*(e){const[t,...n]=e;rn("text"===t[Tt]),n.forEach((e=>rn("text"===e[Tt])));const a=n[Yt]>0?(0,c.LF)(n.map((e=>(rn("text"===e[Tt]),e.value)))[nn](Se.isDefined)):[];return{[Tt]:it,value:(0,Fe.addStyleAnnotations)(t.value,a)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}}],varargs:[{name:"styles",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'style("Hello world", "sui")',[yt]:[["Hello world",[["s"],["_"],["i"]]]]},{[bt]:'"Some text".style("bc")',[yt]:[["Hello world",[["b"],["c"]]]]},{[bt]:'"Some text".style("purple")',[yt]:[["Some text",[["h","purple"]]]]},{[bt]:'"With background".style("green_background")',[yt]:[["With background",[["h","teal_background"]]]]}],[pt]:["style(value, styles)","value.style(styles)"],[ht]:on.style},unstyle:{name:"unstyle",eval:function*(e){const[t,...n]=e;rn("text"===t[Tt]);const a=n[Yt]>0?(0,c.LF)(n.map((e=>(rn("text"===e[Tt]),e.value)))[nn](Se.isDefined)):void 0;return{[Tt]:it,value:(0,Fe.removeStyleAnnotations)(t.value,a)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}}],varargs:[{name:"styles",[rt]:!0,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:[['"'],["Text",[["i"],["b"]]],['".unstyle("i")']],[yt]:[["Text",[["b"]]]]},{[bt]:[['unstyle("'],["Text",[["i"],["b"]]],['")']],[yt]:[["Text"]]},{[bt]:[['"'],["Text",[["h","blue"],["b"]]],['".unstyle()']],[yt]:[["Text"]]}],[pt]:["unstyle(value, styles)","value.unstyle(styles)"],[ht]:on.unstyle},link:{name:"link",eval:function*(e){const[t,n]=e;return rn("text"===t[Tt]),rn("text"===n[Tt]),{[Tt]:it,value:(0,Fe.addLinkAnnotation)(t.value,(0,Fe.getTextWithoutTokens)(n.value))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}},{name:"url",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'link("Notion", "https://notion.so")',[yt]:[["Notion",[(0,Fe.createLinkAnnotation)("https://notion.so")]]]},{[bt]:'"Notion".link("https://notion.so"))',[yt]:[["Notion",[(0,Fe.createLinkAnnotation)("https://notion.so")]]]}],[pt]:["link(text, url)"],[ht]:on.link},[Wt]:{name:Wt,eval:function*(e,t){const[n,a]=e;rn("text"===n[Tt]&&"text"===a[Tt]);const r=yield*(0,c.PX)(n.value,t),o=yield*(0,c.PX)(a.value,t);return{[Tt]:at,value:r[tn](o)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}},{name:"searchString",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:at},[gt]:{[Tt]:it},[xt]:[{[bt]:'contains("Notion", "ot")',[yt]:nt},{[bt]:'"Notion".contains("ot")',[yt]:nt},{[bt]:"contains([1, 2], 3)",[yt]:tt},{[bt]:"[1, 2].contains(3)",[yt]:tt}],[pt]:["contains(text, searchString)","text.contains(searchString)","contains(list, value)","list.contains(value)"],[ht]:on[Wt]},[Bt]:{name:Bt,eval:function*(e,t){const[n,a,r]=e;rn("text"===n[Tt]&&"text"===a[Tt]);const o=yield*(0,c.PX)(n.value,t),i=yield*(0,c.PX)(a.value,t);return{[Tt]:it,value:(0,Fe.createTextValue)(o[Bt](new RegExp(i),"text"===(null==r?void 0:r[Tt])?yield*(0,c.PX)(r.value,t):""))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}},{name:et,[Tt]:{[Tt]:it}},{name:"replacement",[rt]:!0,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'replace("NotionNotion", "N", "M"',[yt]:'"MotionNotion"'},{[bt]:'"NotionNotion".replace("N", "M")',[yt]:'"MotionNotion"'}],[pt]:["replace(text, pattern, replacement)","text.replace(pattern, replacement)"],[ht]:on[Bt]},[St]:{name:St,eval:function*(e,t){const[n,a,r]=e;rn("text"===n[Tt]&&"text"===a[Tt]);const o=yield*(0,c.PX)(n.value,t);return{[Tt]:it,value:(0,Fe.createTextValue)(o[Bt](new RegExp(yield*(0,c.PX)(a.value,t),"g"),"text"===(null==r?void 0:r[Tt])?yield*(0,c.PX)(r.value,t):""))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}},{name:et,[Tt]:{[Tt]:it}},{name:"replacement",[rt]:!0,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'replaceAll("NotionNotion", "N", "M"',[yt]:'"MotionMotion"'},{[bt]:'"NotionNotion".replaceAll("N", "M")',[yt]:'"MotionMotion"'}],[pt]:["replaceAll(text, pattern, replacement)","text.replaceAll(pattern, replacement)"],[ht]:on[St]},test:{name:"test",eval:function*(e,t){const[n,a]=e;return rn("text"===n[Tt]&&"text"===a[Tt]),{[Tt]:at,value:new RegExp(yield*(0,c.PX)(a.value,t)).test(yield*(0,c.PX)(n.value,t))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}},{name:et,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:it},[xt]:[{[bt]:'test("Notion", "Not")',[yt]:nt},{[bt]:'"Notion.test("Mo")',[yt]:tt}],[pt]:["test(text, pattern)","text.test(pattern)"],[ht]:on.test},empty:{name:"empty",eval:function*(e,t){const[n]=e;return{[Tt]:at,value:"array"===n[Tt]?0===n[ut][Yt]:!(0,c.vh)(n)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:dt}}]},[kt]:{[Tt]:at},[gt]:{[Tt]:at},[xt]:[{[bt]:'empty("")',[yt]:nt},{[bt]:'empty("Notion")',[yt]:tt},{[bt]:"empty(0)",[yt]:nt},{[bt]:"[].empty()",[yt]:nt}],[pt]:["empty(value)","value.empty()"],[ht]:on.empty},toNumber:{name:"toNumber",eval:function*(e,t){const[n]=e;switch(n[Tt]){case wt:return n;case at:return{[Tt]:wt,value:n.value?1:0};case it:{const e=yield*(0,c.PX)(n.value,t),a=parseFloat(e);return(0,Ze.isNumber)(a)?{[Tt]:wt,value:parseFloat(e)}:yn}case Et:return{[Tt]:wt,value:(0,$e.getLuxonRange)(n.value,t[ft]).start.valueOf()};default:return yn}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:dt}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:'toNumber("2")',[yt]:"2"},{[bt]:"now().toNumber()",[yt]:"1689024036038"}],[pt]:["toNumber(value)","value.toNumber()"],[ht]:on.toNumber},e:sn("e",on.e,Math.E),pi:sn("pi",on.pi,Math.PI),abs:un("abs",on.abs,Math.abs),ceil:un("ceil",on.ceil,Math.ceil),floor:un("floor",on.floor,Math.floor),round:un("round",on.round,Math.round),sqrt:un("sqrt",on.sqrt,Math.sqrt),cbrt:un("cbrt",on.cbrt,Math.cbrt),exp:un("exp",on.exp,Math.exp),ln:un("ln",on.ln,Math.log),log10:un("log10",on.log10,Math.log10),log2:un("log2",on.log2,Math.log2),sign:un("sign",on.sign,Math.sign),add:ln("add",on.add,((e,t)=>e+t)),subtract:ln("subtract",on.subtract,((e,t)=>e-t)),multiply:ln("multiply",on.multiply,((e,t)=>e*t)),divide:ln("divide",on.divide,((e,t)=>e/t)),mod:ln("mod",on.mod,((e,t)=>e%t)),pow:ln("pow",on.pow,((e,t)=>e**t)),min:{name:"min",eval:function*(e,t){const n=e.flatMap((e=>"array"===e[Tt]?e[ut].map((e=>{if("number"===e[Tt])return e.value}))[nn](Se.isDefined):"number"===e[Tt]?[e.value]:void 0))[nn](Se.isDefined);return{[Tt]:wt,value:Math.min(...n)}},[vt]:{varargs:[{name:"value",[Tt]:[{[Tt]:wt},{[Tt]:ct,of:{[Tt]:wt}}]}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:"min(1, 2, 3)",[yt]:"1"},{[bt]:"[1, 2, 3, 4, 5].min()",[yt]:"1"}],[pt]:["min(values...)","min(list)","list.min()"],[ht]:on.min},max:{name:"max",eval:function*(e,t){const n=e.flatMap((e=>"array"===e[Tt]?e[ut].map((e=>{if("number"===e[Tt])return e.value}))[nn](Se.isDefined):"number"===e[Tt]?[e.value]:void 0))[nn](Se.isDefined);return{[Tt]:wt,value:Math.max(...n)}},[vt]:{varargs:[{name:"value",[Tt]:[{[Tt]:wt},{[Tt]:ct,of:{[Tt]:wt}}]}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:"max(1, 2, 3)",[yt]:"3"},{[bt]:"[1, 2, 3, 4, 5].max()",[yt]:"5"}],[pt]:["max(values...)","max(list)","list.max()"],[ht]:on.max},dateStart:{name:"dateStart",eval:function*(e,t){const[n]=e;return rn("date"===n[Tt]),{[Tt]:Et,value:(0,_e.getStart)(n.value)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:"dateStart(aDateRange)",[yt]:Ke},{[bt]:"aDateRange.dateStart()",[yt]:Ke}],[pt]:["dateStart(dateRange)","dataRange.dateStart()"],[ht]:on.dateStart},dateEnd:{name:"dateEnd",eval:function*(e,t){const[n]=e;return rn("date"===n[Tt]),{[Tt]:Et,value:(0,_e.getEnd)(n.value)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:"dateEnd(aDateRange)",[yt]:"dateRangeEnd"},{[bt]:"aDateRange.dateEnd()",[yt]:"dateRangeEnd"}],[pt]:["dateEnd(dateRange)","dataRange.dateEnd()"],[ht]:on.dateEnd},now:{name:"now",eval:function*(e,t){return{[Tt]:Et,value:(0,$e.minuteNow)(t[ft])}},[vt]:{},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:"now()",[yt]:"today's date"}],[pt]:["now()"],[ht]:on.now},[Nt]:{name:Nt,eval:function*(e,t){const[n]=e;return rn("date"===n[Tt]),{[Tt]:wt,value:(0,$e.timeStamp)(n.value,t[ft])}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:"now().timestamp()",[yt]:"1689024900000"}],[pt]:["timesamp(date)","date.timestamp()"],[ht]:on[Nt]},[Rt]:{name:Rt,eval:function*(e,t){const[n]=e;return rn("number"===n[Tt]),{[Tt]:Et,value:(0,$e.dateTime)(n.value,t[ft])}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:wt}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:"now().timestamp()",[yt]:"1689024900000"}],[pt]:["timesamp(date)","date.timestamp()"],[ht]:on[Rt]},parseDate:{name:"parseDate",eval:function*(e,t){const[n]=e;rn("text"===n[Tt]);const a=yield*(0,c.PX)(n.value,t),r=(0,Xe.fuzzyValidDateTimeFromISO)(a);return r?{[Tt]:Et,value:(0,Xe.luxonDateToNotionDateOrDateTime)(r)}:yn},[vt]:{[mt]:[{name:"dateString",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2022-01-01")',[yt]:"Date Value for 2022-01-01"}],[pt]:['parseDate("ISO_DATE")','"ISO_DATE".parseDate()'],[ht]:on.parseDate},dateAdd:{name:"dateAdd",eval:fn(((e,t,n)=>e.plus({[n]:t}).valueOf())),[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:Et}},{name:"num",[Tt]:{[Tt]:wt}},{name:"unit",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2022-01-01").dateAdd(1, "years")',[yt]:"Date Value for 2023-01-01"},{[bt]:'parseDate("2022-01-01").dateAdd(1, "days")',[yt]:"Date Value for 2022-01-02"},{[bt]:'parseDate("2022-01-01").dateAdd(1, "months")',[yt]:"Date Value for 2022-02-01"}],[pt]:["dateAdd(date, num, unit)","date.dateAdd(num, unit)"],[ht]:on.dateAdd},[Vt]:{name:Vt,eval:fn(((e,t,n)=>e.minus({[n]:t}).valueOf())),[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:Et}},{name:"num",[Tt]:{[Tt]:wt}},{name:"unit",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:Et},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2022-01-01").dateSubtract(1, "years")',[yt]:"Date Value for 2021-01-01"},{[bt]:'parseDate("2022-01-02").dateSubtract(1, "days")',[yt]:"Date Value for 2022-01-01"},{[bt]:'parseDate("2022-01-01").dateSubtract(1, "months")',[yt]:"Date Value for 2021-12-01"}],[pt]:["dateSubtract(date, num, unit)","date.dateSubtract(num, unit)"],[ht]:on[Vt]},[Pt]:{name:Pt,eval:function*(e,t){const[n,a,r]=e;rn("date"===n[Tt]&&"date"===a[Tt]&&"text"===r[Tt]);const o=(0,$e.getLuxonRange)(n.value,t[ft]).start,i=(0,$e.getLuxonRange)(a.value,t[ft]).start,s=yield*cn(r.value,t);return{[Tt]:wt,value:Math.trunc(o.diff(i,s).get(s))}},[vt]:{[mt]:[{name:"left",[Tt]:{[Tt]:Et}},{name:"right",[Tt]:{[Tt]:Et}},{name:"unit",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'dateBetween(parseDate("2021-01-01"), parseDate("2021-01-02"), "days")',[yt]:"1"},{[bt]:'dateBetween(parseDate("2021-01-01"), parseDate("2021-02-02"), "months")',[yt]:"1"}],[pt]:["dateBetween(date, date, unit)","date.dateBetween(date, unit)"],[ht]:on[Pt]},formatDate:{name:"formatDate",eval:function*(e,t){const[n,a]=e;rn("date"===n[Tt]&&"text"===a[Tt]);const r=(0,$e.getLuxonRange)((0,_e.getStart)(n.value),t[ft],t.intl.locale).start;return{[Tt]:it,value:(0,Fe.createTextValue)((0,He.P)(r,yield*(0,c.PX)(a.value,t)))}},[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}},{name:Ut,[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2021-01-01").formatDate("MMMM D, Y")',[yt]:"January 1, 2021"},{[bt]:'parseDate("2021-01-01").formatDate("MM/DD/YYYY")',[yt]:"01/01/2021"}],[pt]:["formatDate(date, format)","date.formatDate(format)"],[ht]:on.formatDate},minute:{name:"minute",eval:mn((e=>e.minute)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").minute()',[yt]:"35"}],[pt]:["minute(date)","date.minute()"],[ht]:on.minute},hour:{name:"hour",eval:mn((e=>e.hour)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").hour()',[yt]:"17"}],[pt]:["hour(date)","date.hour()"],[ht]:on.hour},day:{name:"day",eval:mn((e=>e.weekday)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").day()',[yt]:"1"}],[pt]:["day(date)","date.day()"],[ht]:on.day},[Et]:{name:Et,eval:mn((e=>e.day)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").date()',[yt]:"10"}],[pt]:["date(date)","date.date()"],[ht]:on[Et]},month:{name:"month",eval:mn((e=>e.month)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").month()',[yt]:"7"}],[pt]:["month(date)","date.month()"],[ht]:on.month},year:{name:"year",eval:mn((e=>e.year)),[vt]:{[mt]:[{name:Et,[Tt]:{[Tt]:Et}}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:Et},[xt]:[{[bt]:'parseDate("2023-07-10T17:35Z").year()',[yt]:"2023"}],[pt]:["year(date)","date.year()"],[ht]:on.year},if:{name:"if",eval:function*(e,t){const[n,a,r]=e;return rn("checkbox"===n[Tt]),n.value?yield*ga(a,t):yield*ga(r,t)},[vt]:{[mt]:[{name:"condition",[Tt]:{[Tt]:at}},{name:"ifTrue",[Tt]:{[Tt]:lt}},{name:"ifFalse",[Tt]:{[Tt]:lt}}]},[kt]:e=>{let[t,n,a]=e;return void 0!==n&&void 0!==a&&(0,Qe.Jy)(n,a)?n:{[Tt]:dt}},[gt]:{[Tt]:at},[xt]:[{[bt]:'if(true, "yes", "no")',[yt]:"yes"},{[bt]:'if(false, "yes", "no")',[yt]:"no"}],[pt]:["if(condition, ifTrue, ifFalse)","condition.if(ifTrue, ifFalse)"],[ht]:on.if},ifs:{name:"ifs",[vt]:{[mt]:[{name:"condition",[Tt]:{[Tt]:lt}},{name:"ifTrue",[Tt]:{[Tt]:lt}}],varargs:[{name:"args",[Tt]:{[Tt]:lt}}]},[kt]:e=>{if(e[Yt]<2)return{[Tt]:dt};const t=e[1];let n=2;for(;n<e[Yt]-1;n+=2)if(!(0,Qe.Jy)(e[n+1],t))return{[Tt]:dt};if(n<e[Yt]){const a=e[n];if(!(0,Qe.Jy)(a,t))return{[Tt]:dt}}return t},eval:function*(e,t){const n=e;let a=0;for(;a<n[Yt]-1;a+=2){const e=yield*ga(n[a],t);if((0,c.vh)(e))return yield*ga(n[a+1],t)}return a<n[Yt]?yield*ga(n[a],t):yn},[gt]:{[Tt]:at},[xt]:[{[bt]:'ifs(true, "yes", false, "no")',[yt]:"yes"},{[bt]:'ifs(false, "no", true, "yes")',[yt]:"no"}],[pt]:["ifs(condition1, ifTrue1, condition2, ifTrue2, ..., else)","condition1.ifs(ifTrue1, condition2, ifTrue2, ..., else)"],[ht]:on.ifs},sum:{name:"sum",eval:function*(e,t){return{[Tt]:wt,value:e.reduce(((e,t)=>e+("number"===t[Tt]?t.value:"array"===t[Tt]?t[ut].reduce(((e,t)=>e+("number"===t[Tt]?t.value:0)),0):0)),0)}},[vt]:{varargs:[{name:"value",[Tt]:[{[Tt]:wt},{[Tt]:ct,of:{[Tt]:wt}}]}]},[kt]:{[Tt]:wt},[gt]:{[Tt]:wt},[xt]:[{[bt]:"sum(1, 2, 3)",[yt]:"6"},{[bt]:"sum([1, 2, 3])",[yt]:"6"}],[pt]:["sum(value1, value2, ...)","[value1, value2, ...].sum()"],[ht]:on.sum},at:{name:"at",eval:function*(e,t){const[n,a]=e;return rn("array"===n[Tt]&&"number"===a[Tt]),void 0!==n[ut][a.value]?n[ut][a.value]:yn},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}},{name:"index",[Tt]:{[Tt]:wt}}]},[kt]:e=>{let[t]=e;return"array"===(null==t?void 0:t[Tt])?t.of:{[Tt]:dt}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"at([1, 2, 3], 1)",[yt]:"2"},{[bt]:"at([1, 2, 3], 5)",[yt]:st}],[pt]:["at(list, index)","list.at(index)"],[ht]:on.at},concat:{name:"concat",eval:function*(e){return{[Tt]:ct,[ut]:e.flatMap((e=>(rn("array"===e[Tt]),e[ut][nn]((e=>"undefined"!==e[Tt])))))}},[vt]:{varargs:[{name:"arg",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{var t;if("array"===(null===(t=e[0])||void 0===t?void 0:t[Tt]))return{[Tt]:ct,of:{[Tt]:dt}};const n=e[0];for(let a=1;a<e[Yt];a++)if(void 0!==e[a]&&!(0,Qe.Jy)(e[a],n))return{[Tt]:ct,of:{[Tt]:dt}};return n},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"concat([1, 2], [3, 4])",[yt]:"[1, 2, 3, 4]"},{[bt]:'concat(["a", "b"], ["c", "d"])',[yt]:'["a", "b", "c", "d"]'}],[pt]:["concat(list1, list2, ...)","list1.concat(list2, ...)"],[ht]:on.concat},every:{name:"every",eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);const r=yield*pn(n[ut],a,t);return{[Tt]:at,value:r.every((e=>(0,c.vh)(e)))}},[vt]:hn,[kt]:{[Tt]:at},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"every([1, 2, 3], currentValue > 0)",[yt]:nt},{[bt]:"every([1, 2, 3], currentValue > 1)",[yt]:tt}],[pt]:["every(list, expression)","list.every(expression)"],[ht]:on.every},[nn]:{name:nn,eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);const r=yield*pn(n[ut],a,t);return{[Tt]:ct,[ut]:n[ut][nn](((e,t)=>(0,c.vh)(r[t])))}},[vt]:hn,[kt]:e=>{let[t,n]=e;return"array"===(null==t?void 0:t[Tt])?t:{[Tt]:dt}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"filter([1, 2, 3], currentValue > 1)",[yt]:"[2, 3]"},{[bt]:'filter(["a", "b", "c"], currentValue = "a")',[yt]:'["a"]'}],[pt]:["filter(list, expression)","list.filter(expression)"],[ht]:on[nn]},find:{name:"find",eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);const r=yield*pn(n[ut],a,t);return n[ut].find(((e,t)=>(0,c.vh)(r[t])))??{[Tt]:"undefined"}},[vt]:hn,[kt]:e=>{let[t,n]=e;return"array"===(null==t?void 0:t[Tt])?t.of:{[Tt]:dt}},[gt]:{[Tt]:it},[xt]:[{[bt]:'find(["a", "b", "c"], currentValue = "b")',[yt]:'"b"'},{[bt]:"find([1, 2, 3], currentValue > 100)",[yt]:st}],[pt]:["find(list, expression)","list.find(expression)"],[ht]:on.find},[en]:{name:en,eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);const r=yield*pn(n[ut],a,t);return{[Tt]:wt,value:r[en]((e=>(0,c.vh)(e)))}},[vt]:hn,[kt]:e=>{let[t,n]=e;return"array"===(null==t?void 0:t[Tt])?t.of:{[Tt]:dt}},[gt]:{[Tt]:it},[xt]:[{[bt]:'findIndex(["a", "b", "c"], currentValue = "b")',[yt]:"1"},{[bt]:"findIndex([1, 2, 3], currentValue > 100)",[yt]:"-1"}],[pt]:["findIndex(list, expression)","list.findIndex(expression)"],[ht]:on[en]},first:{name:"first",eval:function*(e,t){const[n]=e;return rn("array"===n[Tt]),n[ut][Yt]>0?n[ut][0]:yn},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e;return"array"===(null==t?void 0:t[Tt])?t.of:{[Tt]:dt}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"first([1, 2, 3])",[yt]:"1"},{[bt]:"first([])",[yt]:st}],[pt]:["first(list)","list.first()"],[ht]:on.first},flat:{name:"flat",eval:function*(e,t){const[n]=e;rn("array"===n[Tt]);const a=[];for(const r of n[ut])"array"===r[Tt]?a.push(...r[ut]):a.push(r);return{[Tt]:ct,[ut]:a}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e,n={[Tt]:dt};return"array"===(null==t?void 0:t[Tt])&&(n="array"===t.of[Tt]?t.of.of:t.of),{[Tt]:ct,of:n}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"flat([[1, 2], [3, 4]])",[yt]:"[1, 2, 3, 4]"},{[bt]:"flat([1, 2, 3])",[yt]:"[1, 2, 3]"}],[pt]:["flat(list)","list.flat()"],[ht]:on.flat},join:{name:"join",eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]&&"text"===a[Tt]);const r=yield*(0,c.LD)(n[ut].map((e=>(rn("text"===e[Tt]),(0,c.PX)(e.value,t)))));return{[Tt]:it,value:(0,Fe.normalizeTextValue)((0,ze.Z)(r.map((e=>(0,Fe.createTextValue)(e))),(()=>a.value)).flat())}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:ct,of:{[Tt]:it}}},{name:"joiner",[Tt]:{[Tt]:it}}]},[kt]:{[Tt]:it},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:'join(["a", "b", "c"], ", ")',[yt]:'"a, b, c"'}],[pt]:["join(list, joiner)","list.join(joiner)"],[ht]:on.join},[tn]:{name:tn,eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);for(const r of n[ut]){if(yield*(0,c.Jr)(r,a,t))return{[Tt]:at,value:!0}}return{[Tt]:at,value:!1}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}},{name:"needle",[Tt]:{[Tt]:dt}}]},[kt]:{[Tt]:at},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:'includes(["a", "b", "c"], "b")',[yt]:nt},{[bt]:'includes(["a", "b", "c"], "d")',[yt]:tt}],[pt]:["includes(list, value)","list.includes(value)"],[ht]:on[tn]},last:{name:"last",eval:function*(e,t){const[n]=e;return rn("array"===n[Tt]),n[ut][Yt]>0?n[ut][n[ut][Yt]-1]:yn},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e;return"array"===(null==t?void 0:t[Tt])?t.of:{[Tt]:dt}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"last([1, 2, 3])",[yt]:"3"}],[pt]:["last(list)","list.last()"],[ht]:on.last},map:{name:"map",eval:function*(e,t){const[n,a]=e;return rn("array"===n[Tt]),{[Tt]:ct,[ut]:yield*pn(n[ut],a,t)}},[vt]:hn,[kt]:e=>{let[t,n]=e;return{[Tt]:ct,of:n??{[Tt]:"unknown"}}},[gt]:{[Tt]:ct,of:{[Tt]:it}},[xt]:[{[bt]:"map([1, 2, 3], currentValue + 1)",[yt]:"[2, 3, 4]"}],[pt]:["map(list, expression)","list.map(expression)"],[ht]:on.map},reverse:{name:"reverse",eval:function*(e,t){const[n]=e;rn("array"===n[Tt]);const a=[...n[ut]].reverse();return{[Tt]:ct,[ut]:a}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e;return"array"===t[Tt]?t:{[Tt]:ct,of:{[Tt]:dt}}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"reverse([1, 2, 3])",[yt]:"[3, 2, 1]"}],[pt]:["reverse(list)","list.reverse()"],[ht]:on.reverse},slice:{name:"slice",eval:function*(e,t){const[n,a,r]=e;return rn("array"===n[Tt]&&"number"===a[Tt]),{[Tt]:ct,[ut]:n[ut].slice(a.value,"number"===(null==r?void 0:r[Tt])?r.value:void 0)}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}},{name:ot,[Tt]:{[Tt]:wt}},{name:"endIndex",[rt]:!0,[Tt]:{[Tt]:wt}}]},[kt]:e=>{let[t]=e;return"array"===(null==t?void 0:t[Tt])?t:{[Tt]:ct,of:{[Tt]:dt}}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"slice([1, 2, 3], 1, 2)",[yt]:"[2]"},{[bt]:"slice([1, 2, 3], 1)",[yt]:"[2, 3]"}],[pt]:["slice(list, startIndex, endIndex)","list.slice(startIndex, endIndex)","slice(list, startIndex)","list.slice(startIndex)"],[ht]:on.slice},some:{name:"some",eval:function*(e,t){const[n,a]=e;rn("array"===n[Tt]);const r=yield*pn(n[ut],a,t);return{[Tt]:at,value:r.some((e=>(0,c.vh)(e)))}},[vt]:hn,[kt]:{[Tt]:at},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"some([1, 2, 3], currentValue > 2)",[yt]:nt},{[bt]:"some([1, 2, 3], currentValue > 10)",[yt]:tt}],[pt]:["some(list, expression)","list.some(expression)"],[ht]:on.some},sort:{name:"sort",eval:function*(e,t){const[n]=e;rn("array"===n[Tt]);const a=n[ut][nn]((e=>"undefined"!==e[Tt])),r=yield*(0,c.Ex)(a,t);return{[Tt]:ct,[ut]:r}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e;return"array"===t[Tt]?t:{[Tt]:ct,of:{[Tt]:dt}}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"sort([3, 1, 2])",[yt]:"[1, 2, 3]"}],[pt]:["sort(list)","list.sort()"],[ht]:on.sort},unique:{name:"unique",eval:function*(e,t){const[n]=e;rn("array"===n[Tt]);const a=[];for(const r of n[ut]){(yield*(0,c.LD)(a.map((e=>(0,c.Jr)(e,r,t))))).some((e=>e))||a.push(r)}return{[Tt]:ct,[ut]:a}},[vt]:{[mt]:[{name:"list",[Tt]:{[Tt]:ct,of:{[Tt]:dt}}}]},[kt]:e=>{let[t]=e;return"array"===t[Tt]?t:{[Tt]:ct,of:{[Tt]:dt}}},[gt]:{[Tt]:ct,of:{[Tt]:dt}},[xt]:[{[bt]:"unique([1, 1, 2])",[yt]:"[1, 2]"}],[pt]:["unique(list)","list.unique()"],[ht]:on.unique},_toPlainText:{name:"_toPlainText",eval:function*(e,t){const[n]=e;return rn("text"===n[Tt]),{[Tt]:it,value:(0,Fe.createTextValue)(yield*(0,c.PX)(n.value,t))}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:it}}]},[kt]:()=>({[Tt]:it}),[gt]:{[Tt]:it},[xt]:[{[bt]:"_toPlainText(2)",[yt]:'"2"'}],[pt]:["_toPlainText(value)","value._toPlainText()"],[ht]:on.toPlainText},_toText:{name:"_toText",eval:function*(e,t){const[n]=e;return{[Tt]:it,value:(0,c.j4)(n)}},[vt]:{[mt]:[{name:bt,[Tt]:{[Tt]:dt}}]},[kt]:()=>({[Tt]:it}),[gt]:{[Tt]:it},[xt]:[{[bt]:"_toText(2)",[yt]:'"2"'}],[pt]:["_toText(value)","value._toText()"],[ht]:on.toText},let:{name:"let",eval:function*(e,t){const[n,a,r]=e;if(n.kind!==d.bG.Identifier)throw new d.Mu({[Tt]:d.sj.LetBindingNameNotIdentifier,node:n});return yield*ga(r,{...t,[ut]:[{kind:o.yp.Binding,id:n[it],value:yield*ga(a,t)},...t[ut]]})},[vt]:{[mt]:[{name:"identifier",[Tt]:{[Tt]:lt}},{name:"value",[Tt]:{[Tt]:lt}},{name:lt,[Tt]:{[Tt]:lt}}]},[kt]:e=>{let[t,n,a]=e;return a??{[Tt]:"unknown"}},[gt]:{[Tt]:it},[xt]:[{[bt]:"let(a, 2, a + 2)",[yt]:"4"},{[bt]:'let(a, "hello", a + " world")',[yt]:"hello world"}],[pt]:["let(variableName, variableValue, expression)","variableName.let(variableValue, expression)"],[ht]:on.let},lets:{name:"lets",eval:function*(e,t){const n=e;if(n[Yt]<3||n[Yt]%2!=1)throw new d.Mu({[Tt]:d.sj.NotEnoughArguments});const a={...t};for(let i=0;i<n[Yt]-1;i+=2){const e=n[i],t=n[i+1];if(e.kind!==d.bG.Identifier)throw new d.Mu({[Tt]:d.sj.LetBindingNameNotIdentifier,node:e});a[ut]=[{kind:o.yp.Binding,id:e[it],value:yield*ga(t,a)},...a[ut]]}const r=n[n[Yt]-1];return yield*ga(r,a)},[vt]:{varargs:[{name:"args",[Tt]:{[Tt]:lt}}]},[kt]:e=>e[e[Yt]-1]??{[Tt]:"unknown"},[gt]:{[Tt]:it},[xt]:[{[bt]:"lets(a, 1, b, 2, a + b)",[yt]:"3"},{[bt]:'lets(a, "hello", b, "world", a + " " + b)',[yt]:"hello world"}],[pt]:["lets(variableName1, variableValue1, variableName2, variableValue2, ..., expression)"],[ht]:on.lets},id:{name:"id",eval:function*(e,t){var n;const a=null===(n=t[ut].find((e=>e.kind===o.yp.ThisRow)))||void 0===n?void 0:n.value;if("block"!==(null==a?void 0:a[Tt]))throw new d.Mu({[Tt]:d.sj.TryingToGetIdWithoutThisRow});return{[Tt]:it,value:(0,Fe.createTextValue)((0,Je.withoutDashes)(a.value.id))}},[kt]:()=>({[Tt]:it}),[gt]:{[Tt]:it},[xt]:[{[bt]:"id()",[yt]:"current page id"}],[pt]:["id()"],[ht]:on.id}},xn=n(85).Mmq,gn=n(85).H8L;function kn(e,t){const n=_(),a=$(n).tokenize(e),r=[...a.errors],i=[];for(const o of r)i.push(z(o));for(const o of a.tokens.filter((e=>e.tokenType===n[gn]||e.tokenType===n.UnclosedComment)))i.push({type:o.tokenType===n[gn]?d.$E[gn]:d.$E.UnclosedComment,offset:o[xn]});for(const l of a.tokens.filter((e=>e.tokenType===n.StringLiteral)))o.zF.test(l.image)&&i.push({type:d.$E.StringLiteralContainsToken,offset:t?We(t,l[xn],"left"):l[xn]});const s=H(n);s.input=a.tokens;const u=s.expression();for(const o of s.errors)i.push(Z(o));return[u,i]}const wn=n(85).biQ,Tn=n(85).CNJ,En=n(85).CyM,Pn=n(85).h$M,Vn=n(85).fy_,Ln=n(85).mFu,Rn=n(85).tb8,An=n(85).g5Y,Nn=n(85).NlJ,On=n(85).Br6,Dn=n(85).Rii,Mn=n(85).HBc,Gn=n(85).ohA,In=n(85).r3G,Fn=n(85).V5b,Sn=n(85).ygH,Cn=n(85).cZP,Bn=n(85).E3S,qn=n(85).xSd,Wn=n(85).dQj,Un=n(85).cxc,Yn=n(85)._kS,jn=n(85).wbz,_n=n(85).blL,$n=n(85).Wkb,Xn=n(85).We4,Hn=n(85).dHo,zn=n(85).WD5,Jn=n(85).y4s,Zn=n(85).fuO,Qn=n(85).hzi,Kn=n(85).EdP,ea=n(85).V87,ta=n(85).rKZ,na=n(85).vM5,aa=n(85).JmH,ra=n(85).Ql2,oa=n(85).MiB,ia=n(85).ffk,sa=n(85).FH8,ua=n(85).voC,la=n(85).Xfe,da=n(85).tX7,ca=n(85).n19,fa=n(85).AL1,ma=n(85).Gpy,va=n(85).fB_,ha=n(85).ZWc,pa=n(85).hqk,ya=n(85).NQT,ba=n(85).MWD;function xa(e,t,n){if("number"!==t[ba]&&"undefined"!==t[ba])throw new d.WV({[ba]:d.FY.CannotDoMathOnType,op:n,operand:e,valueType:t[ba]})}function*ga(e,t){if(t.depth>7)throw new d.WV({[ba]:d.FY.DepthExceeded});switch(e.kind){case d.bG.Number:return{[ba]:da,value:parseFloat(e[fa])};case d.bG.String:return{[ba]:fa,value:[[e[fa].replace(/\\([\\"])/g,"$1")]]};case d.bG.Boolean:return{[ba]:ha,value:"true"===e[fa].toLowerCase()};case d.bG.NotionToken:{const a=e.token;switch(a[ba]){case o.Oy.Checkbox:return{[ba]:ha,value:a.checked};case o.Oy.BlockProperty:{const n=t[ma].find((e=>e.kind===o.yp.ThisRow));if("block"!==(null==n?void 0:n.value[ba]))throw new d.WV({[ba]:d.FY.MissingThisRow,node:e});const r=n.value.value,i=(yield{[la]:[r]})[ua](r);if(void 0===i)throw new d.WV({[ba]:d.FY.MissingThisRow,node:e});if(void 0===a[sa])return(0,c.SQ)(i,a[ia]);const s=(0,c.SR)(a[ia]),u={table:l.v,id:i[oa](),[ra]:i[aa]()};if(!(0,Me.qo)(a[sa],u))throw new d.WV({[ba]:d.FY[na],node:e,thisRowCollection:u});const f=(yield{[la]:[u]})[ua](u),m=null==f?void 0:f[ta](),v=null==m?void 0:m[s];if(void 0===v||void 0===m)throw new d.WV({[ba]:d.FY[ea],node:e,collectionId:i[oa](),[ia]:s});return yield*wa(i,s,m,v,t)}case o.Oy.Block:return{[ba]:Kn,value:{table:Ge.iU,id:a.blockId,[ra]:a[ra]}};case o.Oy[Qn]:{var n;const r=null===(n=t[ma].find((e=>e.kind===o.yp[Qn]&&e.id===(0,c.Kv)(a.valueId))))||void 0===n?void 0:n.value;if(void 0===r)throw new d.WV({[ba]:d.FY[Zn],node:e,valueId:a.valueId});return r}case o.Oy.Date:return{[ba]:Jn,value:a[Jn]};case o.Oy.Person:return{[ba]:zn,value:{table:Ie.KJ,id:a.userId}};case o.Oy.UserProperty:throw new d.WV({[ba]:d.FY[Hn],node:e});default:(0,Se.unreachable)(a)}break}case d.bG.Identifier:{var a;const n=null===(a=t[ma].find((t=>t.kind===o.yp.Binding&&t.id===e[fa])))||void 0===a?void 0:a.value;if(void 0!==n)return n;if(e[fa]in bn)return{[ba]:Xn,[Xn]:bn[e[fa]]};throw new d.WV({[ba]:d.FY.IdentifierNotFound,node:e})}case d.bG.Array:{const n=yield*(0,c.LD)(e.elements.map((e=>ga(e,t))));return{[ba]:va,[ma]:n}}case d.bG.Conditional:{const n=yield*ga(e.condition,t);return(0,c.vh)(n)?yield*ga(e.expIfTrue,t):yield*ga(e.expIfFalse,t)}case d.bG.LogicalOr:{const n=(yield*(0,c.LD)(e.elements.map((e=>ga(e,t))))).map(c.vh);return{[ba]:ha,value:n.some((e=>e))}}case d.bG.LogicalAnd:{const n=(yield*(0,c.LD)(e.elements.map((e=>ga(e,t))))).map(c.vh);return{[ba]:ha,value:n.every((e=>e))}}case d.bG.Equality:{const[n,a]=yield*(0,c.LD)([ga(e.lhs,t),ga(e.rhs,t)]),r=yield*(0,c.Jr)(n,a,t);switch(e.op){case"==":return{[ba]:ha,value:r};case"!=":return{[ba]:ha,value:!r}}break}case d.bG.Relational:{const[n,a]=yield*(0,c.LD)([ga(e.lhs,t),ga(e.rhs,t)]);if("date"===n[ba]&&"date"===a[ba]){const r=(0,c.SU)(n.value,a.value,t[$n]);switch(e.op){case"<":return{[ba]:ha,value:r<0};case"<=":return{[ba]:ha,value:r<=0};case">":return{[ba]:ha,value:r>0};case">=":return{[ba]:ha,value:r>=0}}}if("text"===n[ba]&&"text"===a[ba]){const[r,o]=yield*(0,c.LD)([(0,c.PX)(n.value,t),(0,c.PX)(a.value,t)]);switch(e.op){case"<":return{[ba]:ha,value:r<o};case"<=":return{[ba]:ha,value:r<=o};case">":return{[ba]:ha,value:r>o};case">=":return{[ba]:ha,value:r>=o}}}if("number"===n[ba]&&"number"===a[ba]||"checkbox"===n[ba]&&"checkbox"===a[ba])switch(e.op){case"<":return{[ba]:ha,value:n.value<a.value};case"<=":return{[ba]:ha,value:n.value<=a.value};case">":return{[ba]:ha,value:n.value>a.value};case">=":return{[ba]:ha,value:n.value>=a.value}}throw new d.WV({[ba]:d.FY[_n],lhs:e.lhs,rhs:e.rhs,lhsType:n[ba],rhsType:a[ba]})}case d.bG.Additive:{let[n,a]=yield*(0,c.LD)([ga(e.lhs,t),ga(e.rhs,t)]);if("undefined"===n[ba]&&"undefined"===a[ba])return{[ba]:da,value:0};switch("undefined"===n[ba]&&"number"===a[ba]?n={[ba]:da,value:0}:"undefined"===a[ba]&&"number"===n[ba]&&(a={[ba]:da,value:0}),e.op){case"+":return"number"===n[ba]&&"number"===a[ba]?{[ba]:da,value:n.value+a.value}:{[ba]:fa,value:(0,Fe.normalizeTextValue)((0,c.j4)(n).concat((0,c.j4)(a)))};case"-":if(xa(e.lhs,n,e.op),xa(e.rhs,a,e.op),"number"===n[ba]&&"number"===a[ba])return{[ba]:da,value:n.value-a.value}}return{[ba]:jn}}case d.bG.Multiplicative:{const[n,a]=yield*(0,c.LD)([ga(e.lhs,t),ga(e.rhs,t)]);switch(xa(e.lhs,n,e.op),xa(e.rhs,a,e.op),e.op){case"*":if("number"===n[ba]&&"number"===a[ba])return{[ba]:da,value:n.value*a.value};break;case"/":if("number"===n[ba]&&"number"===a[ba])return{[ba]:da,value:n.value/a.value};break;case"%":if("number"===n[ba]&&"number"===a[ba])return{[ba]:da,value:n.value%a.value}}return{[ba]:jn}}case d.bG.Exponentiation:{const[n,a]=yield*(0,c.LD)([ga(e.lhs,t),ga(e.rhs,t)]);switch(xa(e.lhs,n,e.op),xa(e.rhs,a,e.op),e.op){case"^":if("number"===n[ba]&&"number"===a[ba])return{[ba]:da,value:n.value**a.value}}return{[ba]:jn}}case d.bG.Unary:{const n=yield*ga(e[Yn],t);switch(e.op){case"-":if("number"!==n[ba])throw new d.WV({[ba]:d.FY[Un],node:e[Yn],expressionType:n[ba]});return{[ba]:da,value:-n.value};case"!":case"not":return{[ba]:ha,value:!(0,c.vh)(n)}}throw new Error("unexpected unary operator")}case d.bG.Call:{const n=yield*ga(e[Yn],t);if("function"!==n[ba])throw new d.WV({[ba]:d.FY.CannotCallNonFunction,node:e,calleeType:n[ba]});const a=n[Xn],o=(0,c.P2)(a),i=void 0!==n.boundTarget?[n.boundTarget,...e.arguments]:e.arguments;if(i.length<o)throw new d.WV({[ba]:d.FY[Wn],node:e,[pa]:a,numArguments:i.length});const s=yield*(0,c.LD)(i.map(((n,r)=>function*(e,t,n,a,r){const o=(0,c.J3)(a,n);if(void 0===o)throw new d.WV({[ba]:d.FY[ya],node:e,argument:t,[pa]:a,parameterIndex:n});if(!Array.isArray(o[ba])&&"expression"===o[ba][ba])return t;const i=yield*ga(t,r);if(!(0,c.mB)(i,o[ba])){if(Array.isArray(o[ba])?o[ba].some((e=>"checkbox"===e[ba])):"checkbox"===o[ba][ba])return{[ba]:ha,value:(0,c.vh)(i)};if(Array.isArray(o[ba])?o[ba].some((e=>"text"===e[ba])):"text"===(0,c.B8)(o[ba])[ba])return"array"===i[ba]&&(Array.isArray(o[ba])?o[ba].some((e=>"array"===e[ba])):"array"===o[ba][ba])?{[ba]:va,[ma]:i[ma].map((e=>({[ba]:fa,value:(0,c.j4)(e)})))}:{[ba]:fa,value:(0,c.j4)(i)};throw new d.WV({[ba]:d.FY[ca],node:e,argument:t,[pa]:a,parameterIndex:n,argumentType:i[ba]})}return i}(e,n,r,a,t))));try{return yield*a.eval(s,t)}catch(r){throw new d.WV({[ba]:d.FY[qn],node:e,[pa]:a,error:r})}}case d.bG[Bn]:if(e.name in bn)return{[ba]:Xn,[Xn]:bn[e.name],boundTarget:e[Yn]};throw new d.WV({[ba]:d.FY[Cn],node:e});case d.bG.MemberBlockProperty:{const n=yield*ga(e[Yn],t);if("undefined"===n[ba])return{[ba]:jn};if("block"!==n[ba])throw new d.WV({[ba]:d.FY.AccessingPropertyOnNonBlock,node:e,expressionValue:n});const a=(yield{[la]:[n.value]})[ua](n.value);if(void 0===a)throw new d.WV({[ba]:d.FY.MissingDataDependencyBlock,node:e,blockPointer:n.value});if(void 0===e[Sn][sa])return(0,c.SQ)(a,e[Sn][ia]);const r={table:l.v,id:a[oa](),[ra]:a[aa]()},o=(0,c.SR)(e[Sn][ia]);if(!(0,Me.qo)(e[Sn][sa],r))throw new d.WV({[ba]:d.FY[Fn],node:e,blockCollection:r});const i=(yield{[la]:[r]})[ua](r),s=null==i?void 0:i[ta](),u=null==s?void 0:s[o];if(void 0===u||void 0===s)throw new d.WV({[ba]:d.FY[In],node:e});return yield*wa(a,o,s,u,t)}case d.bG.MemberUserProperty:{const n=yield*ga(e[Yn],t);if("undefined"===n[ba])return{[ba]:jn};if("person"!==n[ba])throw new d.WV({[ba]:d.FY[Gn],node:e,expressionValue:n});const a=(yield{[la]:[n.value]})[ua](n.value);if(void 0===a)throw new d.WV({[ba]:d.FY.MissingDataDependencyPerson,node:e,personPointer:n.value});return function(e,t,n){switch(t){case o.V2.Name:return{[ba]:fa,value:[[e.getDisplayName(n.intl)]]};case o.V2.Email:return{[ba]:fa,value:[[e.getEmail()]]};default:(0,Se.unreachable)(t)}}(a,e.userProperty,t)}case d.bG.RecoveryNode:throw new d.WV({[ba]:d.FY.UnexpectedRecoveryNode,recovery:e});default:(0,Se.unreachable)(e)}}async function ka(e,t,n){try{const n=ga(e,t);let a=n.next();for(;!a.done;){const e=t[Mn](a.value);a=n.next((0,De.isPromise)(e)?await e:e)}return{value:a.value}}catch(a){if(a instanceof d.WV){const e=a.info;return n&&(0,c.w7)(e)?{error:{...e,node:Ye(e.node,n)}}:{error:e}}return{error:{[ba]:d.FY[Dn],error:(0,r.tg)(a)}}}}function*wa(e,t,n,r,i){const s=`${e.id}:${t}`;if(i[On].has(s))throw new d.WV({[ba]:d.FY.CycleDetected});const f=new Set(i[On]);f.add(s);const m={...i,[On]:f,depth:i.depth+1};if("rollup"===r[ba]){if(r[Nn]&&"show_unique"!==r[Nn]){var v;const a=yield*(0,Be.g)(t,n),{[An]:o}=r;if(null==a||!a.targetCollectionPointer||!o)return{[ba]:jn};const i=(0,Ae.toRelationValueAsPointers)(null===(v=e[Rn]())||void 0===v?void 0:v[o]);if(!i)return{[ba]:jn};const{[ua]:s}=yield{[la]:[a.targetCollectionPointer,e[Ln],...i],[Vn]:[{blockPointers:[e[Ln]],[Pn]:{table:l.v,id:e[oa](),[ra]:e[aa]()},schema:n,[ia]:t}]},u=(0,Ne.O0)({[ia]:t,schema:n,[Kn]:e,[ua]:s,[$n]:m[$n],depth:m.depth,intl:m.intl,[On]:m[On],resultCache:{}});return void 0===u?{[ba]:jn}:function(e){if(void 0===e.value)return{[ba]:jn};switch(e[ba]){case fa:return{[ba]:fa,value:(0,Fe.createTextValue)(e.value)};case da:return{[ba]:da,value:e.value};case Jn:return{[ba]:Jn,value:e.value}}}(u)}{var h;const a=yield*(0,Be.g)(t,n),{[An]:i,target_property:s}=r;if(void 0===a||void 0===i||void 0===s)return{[ba]:jn};const{[En]:l,targetCollectionSchema:d}=a,f=(0,Ae.toRelationValueAsPointers)(null===(h=e[Rn]())||void 0===h?void 0:h[i]),v=yield*(0,Be.u)(f,l),p=yield*(0,c.LD)(v.flatMap((e=>{if(void 0===e)return[];const t=d[s];if(void 0===t)return[];const n={kind:o.yp.ThisRow,value:{[ba]:Kn,value:e[Ln]}},a={...m,[ma]:[n]};return[wa(e,s,d,t,a)]}))),y=(0,c.Yw)({[ba]:va,[ma]:p});if("show_unique"===r[Nn]){const{[ua]:t}=yield{[la]:[e[Ln],...f]},n=u().uniqBy(y[ma],(e=>(0,Oe.QT)({result:e,[ua]:t,[$n]:m[$n],intl:m.intl})));return{[ba]:va,[ma]:n}}return{[ba]:va,[ma]:y[ma]}}}if("formula"===r[ba]){const{[ua]:i}=yield{[Vn]:[{blockPointers:[e[Ln]],[Pn]:{table:l.v,id:e[oa](),[ra]:e[aa]()},schema:n,[ia]:t}]};if(void 0!==r.version){var p;const t=null===(p=r.formula2)||void 0===p?void 0:p.code;if(!t)return{[ba]:jn};const[n,i]=Ue(t),[s,u]=kn(n);if(u.length>0)return{[ba]:jn};const l=Re(s);if(a.x.isFail(l))return{[ba]:jn};const d={kind:o.yp.ThisRow,value:{[ba]:Kn,value:e[Ln]}},c={...m,[ma]:[d]};return yield*ga(l.value,c)}{const a=(0,Ce.AH)({schema:n,[ia]:t,[Kn]:e,[ua]:i,[$n]:m[$n],intl:m.intl,depth:0,resultCache:{},[On]:new Set});switch(typeof a){case"string":return{[ba]:fa,value:(0,Fe.createTextValue)(a)};case da:return{[ba]:da,value:a};case"boolean":return{[ba]:ha,value:a};case"object":return{[ba]:Jn,value:a};case jn:default:return{[ba]:jn}}}}else if(o.WG.includes(r[ba]))return(0,c.SQ)(e,r[ba]);const y=(0,Ae.getNormalizedPropertyValue)(e,t);if("status"===r[ba]){const e=(0,Ae.toStatusValue)(y,r);return void 0===e?{[ba]:jn}:{[ba]:fa,value:(0,Fe.createTextValue)(e)}}if("checkbox"===r[ba]&&void 0===y)return{[ba]:ha,value:!1};if(void 0===y)return{[ba]:jn};switch(r[ba]){case"title":case fa:return{[ba]:fa,value:y};case"url":case"email":case"phone_number":return{[ba]:fa,value:(0,Fe.createTextValue)((0,Ae.toUrlValue)(y))};case"select":{const e=(0,Ae.toSelectValue)(y,r.options??[]);return void 0===e?{[ba]:jn}:{[ba]:fa,value:(0,Fe.createTextValue)(e)}}case"multi_select":return{[ba]:va,[ma]:(0,Ae.toMultiSelectValue)(y,r.options??[]).map((e=>({[ba]:fa,value:(0,Fe.createTextValue)(e)})))};case ha:return{[ba]:ha,value:(0,Ae.toCheckboxValue)(y)};case Jn:{const e=(0,Ae.toDateValue)(y);return void 0===e?{[ba]:jn}:{[ba]:Jn,value:e}}case zn:{const e=(0,Ae.toPersonValue)({textValue:y,propertySchema:r});return{[ba]:va,[ma]:e.map((e=>({[ba]:zn,value:e})))}}case"relation":{const e=yield*(0,Be.u)((0,Ae.toRelationValueAsPointers)(y),r);return{[ba]:va,[ma]:e.map((e=>({[ba]:Kn,value:{table:Ge.iU,id:e.id,[ra]:e[aa]()}})))}}case da:case Tn:{const e=(0,Ae.toNumberValue)(y);return"number"==typeof e?{[ba]:da,value:e}:{[ba]:jn}}case"file":{const e=(0,Ae.toFileValue)(y);return{[ba]:va,[ma]:e.map((e=>{let{url:t}=e;return{[ba]:fa,value:(0,Fe.createTextValue)(t)}}))}}case"created_time":case"last_edited_time":case"created_by":case"last_edited_by":case wn:case"button":return{[ba]:jn};case"location":return{[ba]:jn};case"verification":return{[ba]:jn};default:(0,Se.unreachable)(r)}}var Ta=n(5998);const Ea=n(85).HBc,Pa=n(85).B4J,Va=n(85).pmH,La=n(85).V5b,Ra=n(85).ygH,Aa=n(85).U2N,Na=n(85).fSf,Oa=n(85).E3S,Da=n(85).XZk,Ma=n(85).n19,Ga=n(85).NQT,Ia=n(85).dQj,Fa=n(85).jyp,Sa=n(85).cxc,Ca=n(85)._kS,Ba=n(85).blL,qa=n(85).k$k,Wa=n(85).hrG,Ua=n(85).hqk,Ya=n(85).TtP,ja=n(85).dHo,_a=n(85).Gqc,$a=n(85).fuO,Xa=n(85).hzi,Ha=n(85).SvT,za=n(85).rKZ,Ja=n(85).voC,Za=n(85).Xfe,Qa=n(85).ffk,Ka=n(85).RDm,er=n(85).FH8,tr=n(85).w8T,nr=n(85).ZWc,ar=n(85).KMp,rr=n(85).Ddq,or=n(85).tX7,ir=n(85).fbO,sr=n(85).MWD;function*ur(e,t){switch(e.kind){case d.bG.Number:return{node:{...e,[sr]:{[sr]:or},[rr]:t},[ar]:[]};case d.bG.String:return{node:{...e,[sr]:{[sr]:"text"},[rr]:t},[ar]:[]};case d.bG.Boolean:return{node:{...e,[sr]:{[sr]:nr},[rr]:t},[ar]:[]};case d.bG.NotionToken:{const r=e.token;switch(r[sr]){case o.Oy.Checkbox:return{node:{...e,[sr]:{[sr]:nr},[rr]:t},[ar]:[]};case o.Oy.BlockProperty:{var n;const a=null===(n=t.find((e=>e.kind===o.yp.ThisRow)))||void 0===n?void 0:n[sr];if(void 0===a)return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4.ThisRowTypeNotFound,node:e}]};if("block"!==a[sr]||void 0===a[er])return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4[Ka],node:e}]};if(void 0===r[er])return{node:{...e,[sr]:o.dy[r[Qa]],[rr]:t},[ar]:[]};const i=(yield{[Za]:[a[er]]})[Ja](a[er]),s=null==i?void 0:i[za](),u=(0,c.SR)(r[Qa]),l=null==s?void 0:s[u];if(void 0===l||void 0===s)return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4.MissingPropertyOnThisRow,node:e,token:r}]};const[f,m]=yield*(0,c.IP)(u,s,l);return{node:{...e,[sr]:f,[rr]:t},[ar]:!0===m?[{[sr]:d.h4[Ha],node:e,token:r}]:[]}}case o.Oy[Xa]:{var a;const n=null===(a=t.find((e=>e.kind===o.yp[Xa]&&e.id===(0,c.Kv)(r.valueId))))||void 0===a?void 0:a[sr];return void 0===n?{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4[$a],node:e,token:r}]}:{node:{...e,[sr]:n,[rr]:t},[ar]:[]}}case o.Oy.Block:{const n={table:Ge.iU,id:r.blockId,spaceId:r.spaceId},a=(yield{[Za]:[n]})[Ja](n);if(void 0===a)return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4.MissingBlock,node:e,token:r}]};const o=a[_a]();return{node:{...e,[sr]:{[sr]:"block",[er]:o},[rr]:t},[ar]:[]}}case o.Oy.Person:return{node:{...e,[sr]:{[sr]:"person"},[rr]:t},[ar]:[]};case o.Oy.UserProperty:return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[{[sr]:d.h4[ja],node:e,token:r}]};case o.Oy.Date:return{node:{...e,[sr]:{[sr]:"date"},[rr]:t},[ar]:[]};default:(0,Se.unreachable)(r)}break}case d.bG.Array:{const n=yield*(0,c.LD)(e.elements.map((e=>ur(e,t))));let a={[sr]:tr};if(n[Ya]>0){a=n[0].node[sr];for(let e=1;e<n[Ya];e++)if(!(0,Qe.Jy)(a,n[e].node[sr])){a={[sr]:tr};break}}return{node:{...e,elements:n.map((e=>e.node)),[sr]:{[sr]:"array",of:a},[rr]:t},[ar]:n.flatMap((e=>e[ar]))}}case d.bG.Identifier:{var r;const n=null===(r=t.find((t=>t.kind===o.yp.Binding&&t.id===e.text)))||void 0===r?void 0:r[sr];if(void 0!==n)return{node:{...e,[sr]:n,[rr]:t},[ar]:[]};const a=bn[e.text];if(void 0===a){const n=["prop"===e.text?{[sr]:d.h4.PropNotSupported,node:e}:{[sr]:d.h4.UndefinedIdentifier,node:e}];return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:n}}return{node:{...e,[sr]:{[sr]:"function",[Ua]:a,[Wa]:!1},[rr]:t},[ar]:[]}}case d.bG.Conditional:{const n=yield*ur(e.condition,t),a=yield*ur(e.expIfTrue,t),r=void 0!==e.expIfFalse?yield*ur(e.expIfFalse,t):void 0;let o={[sr]:tr};return void 0===a.node[sr]||void 0!==(null==r?void 0:r.node[sr])&&!(0,Qe.Jy)(a.node[sr],r.node[sr])||(o=a.node[sr]),{node:{...e,condition:n.node,expIfTrue:a.node,expIfFalse:null==r?void 0:r.node,[sr]:o,[rr]:t},[ar]:[...n[ar],...a[ar]??[],...(null==r?void 0:r[ar])??[]]}}case d.bG.LogicalOr:case d.bG.LogicalAnd:const l=yield*(0,c.LD)(e.elements.map((e=>ur(e,t)))),f=l.flatMap((e=>e[ar]));return{node:{...e,elements:l.map((e=>e.node)),[sr]:{[sr]:nr},[rr]:t},[ar]:f};case d.bG.Equality:case d.bG.Relational:{const n=yield*ur(e.lhs,t),a=yield*ur(e.rhs,t),r=[...n[ar],...a[ar]];if(e.kind===d.bG.Relational){const t=n.node[sr],o=a.node[sr];"unknown"===t[sr]||"unknown"===o[sr]||t[sr]===o[sr]&&["number","date","text","boolean"][ir](t[sr])||r[qa]({[sr]:d.h4[Ba],node:e,lhsType:t,rhsType:o})}return{node:{...e,lhs:n.node,rhs:a.node,[sr]:{[sr]:nr},[rr]:t},[ar]:r}}case d.bG.Additive:case d.bG.Multiplicative:case d.bG.Exponentiation:{const n=yield*ur(e.lhs,t),a=yield*ur(e.rhs,t),r=[...n[ar],...a[ar]];if("+"===e.op)return"number"===n.node[sr][sr]&&"number"===a.node[sr][sr]?{node:{...e,lhs:n.node,rhs:a.node,[sr]:{[sr]:or},[rr]:t},[ar]:r}:{node:{...e,lhs:n.node,rhs:a.node,[sr]:["unknown","number"][ir](n.node[sr][sr])&&["unknown","number"][ir](a.node[sr][sr]??"unknown")?{[sr]:tr}:{[sr]:"text"},[rr]:t},[ar]:r};const o=function(e,t,n){const a=t[sr],r=(null==n?void 0:n[sr])??{[sr]:"unknown"};if(!["unknown","number"][ir](a[sr])||!["unknown","number"][ir](r[sr]))return{[sr]:d.h4.CannotDoMathOnType,node:e,lhsType:a,rhsType:r}}(e,n.node,a.node);return void 0!==o&&r[qa](o),{node:{...e,lhs:n.node,rhs:a.node,[sr]:{[sr]:or},[rr]:t},[ar]:r}}case d.bG.Unary:{const n=yield*ur(e[Ca],t),a=[...n[ar]];let r;switch(e.op){case"-":["number","unknown"][ir](n.node[sr][sr])||a[qa]({[sr]:d.h4[Sa],node:e,[Ca]:n.node}),r={[sr]:or};break;case"!":case"not":r={[sr]:nr};break;default:(0,Se.unreachable)(e)}return{node:{...e,[Ca]:n.node,[sr]:r,[rr]:t},[ar]:a}}case d.bG.Call:{const{node:n,[ar]:a}=yield*ur(e[Ca],t),r=[...a];if(n.kind===d.bG.Identifier&&"let"===n.text){var i;const a=[];for(let n=0;n<e[Fa][Ya];n++){const i=e[Fa][n];if(0===n)a[0]={...i,[sr]:{[sr]:tr},[rr]:t};else if(1===n){const{node:e,[ar]:o}=yield*ur(i,t);a[n]=e,r[qa](...o)}else if(2===n){var s,u;const l=(null===(s=e[Fa][0])||void 0===s?void 0:s.kind)===d.bG.Identifier?e[Fa][0].text:void 0,{node:c,[ar]:f}=yield*ur(i,void 0!==l?[{kind:o.yp.Binding,id:l,name:l,[sr]:(null===(u=a[1])||void 0===u?void 0:u[sr])??{[sr]:"unknown"}},...t]:t);a[n]=c,r[qa](...f)}}return{node:{...e,[Ca]:n,[Fa]:a,[sr]:(null===(i=a[2])||void 0===i?void 0:i[sr])??{[sr]:"unknown"},[rr]:t},[ar]:r}}if(n.kind===d.bG.Identifier&&"lets"===n.text){const n=[];let a=[...t];for(let t=0;t<e[Fa][Ya]-1;t+=2){const i=e[Fa][t],s=e[Fa][t+1];if(i.kind!==d.bG.Identifier){r[qa]({[sr]:d.h4.IdentifierExpected,node:i});continue}const{node:u,[ar]:l}=yield*ur(s,a);n[t+1]=u,r[qa](...l);const c=i.text;a=[{kind:o.yp.Binding,id:c,name:c,[sr]:u[sr]},...a],n[t]={...i,[sr]:u[sr],[rr]:a}}const i=e[Fa][e[Fa][Ya]-1],{node:s,[ar]:u}=yield*ur(i,a);return n[e[Fa][Ya]-1]=s,r[qa](...u),{node:{...e,[Ca]:s,[Fa]:n,[sr]:s[sr],[rr]:a},[ar]:r}}["function","unknown"][ir](n[sr][sr])||r[qa]({[sr]:d.h4.CallingNotFunction,node:e,callee:n});const l="function"===n[sr][sr]?n[sr][Ua]:void 0,f="function"===n[sr][sr]?n[sr].boundTargetType:void 0;if(void 0!==l){const t=(0,c.P2)(l),a=e[Fa][Ya]+(void 0!==f?1:0);a<t&&("function"===n[sr][sr]&&n[sr][Wa]?r[qa]({[sr]:d.h4[Ia],node:e,[Ua]:l,numArguments:a-1,minNumParameters:t-1}):r[qa]({[sr]:d.h4[Ia],node:e,[Ua]:l,numArguments:a,minNumParameters:t}))}const m=[],v=[];void 0!==f&&v[qa](f);for(let i=0;i<e[Fa][Ya];i++){const n=e[Fa][i],a=void 0!==f?i+1:i,s=void 0!==l?(0,c.J3)(l,a):void 0;if(void 0!==l&&void 0===s&&r[qa]({[sr]:d.h4[Ga],node:e,[Ua]:l,argument:n,parameterIndex:a}),void 0!==(null==s?void 0:s.augmentScope)){const e=m.map((e=>(null==e?void 0:e[sr])??{[sr]:"unknown"})),a=s.augmentScope(void 0!==f?[f,...e]:e),{node:u,[ar]:l}=yield*ur(n,[...Object.entries(a).map((e=>{let[t,n]=e;return{kind:o.yp.Binding,id:t,[sr]:n}})),...t]);m[i]=u,v[qa](u[sr]),r[qa](...l)}else{const{node:a,[ar]:o}=yield*ur(n,t);if(m[i]=a,void 0!==l&&void 0!==s){const t=(0,Qe.xK)(a[sr],s[sr]);"boolean"==typeof t?(v[qa](a[sr]),t||r[qa]({[sr]:d.h4[Ma],node:e,[Ua]:l,argument:a,expectedParameter:s})):v[qa](t)}else v[qa](a[sr]);r[qa](...o)}}return{node:{...e,[Ca]:n,[Fa]:m,[sr]:void 0!==l?"function"==typeof l[Da]?l[Da](v):l[Da]:{[sr]:tr},[rr]:t},[ar]:r}}case d.bG[Oa]:{const n=bn[e.name],{node:a,[ar]:r}=yield*ur(e[Ca],t),o=[...r];let i={[sr]:tr};if(void 0===n)o[qa]({[sr]:d.h4[Na],node:e,name:e.name});else{const t=(0,c.J3)(n,0);if(void 0===t)o[qa]({[sr]:d.h4.UnifiedFunctionNoArguments,node:e,[Ua]:n});else{const r=(0,Qe.xK)(a[sr],t[sr]);"boolean"==typeof r?(i=a[sr],r||o[qa]({[sr]:d.h4[Aa],node:e,[Ca]:a,[Ua]:n})):i=r}}return{node:{...e,[Ca]:a,[sr]:void 0!==n?{[sr]:"function",boundTargetType:i,[Ua]:n,[Wa]:!0}:{[sr]:tr},[rr]:t},[ar]:o}}case d.bG.MemberBlockProperty:{const{node:n,[ar]:a}=yield*ur(e[Ca],t),r=[...a];let i;if("block"===n[sr][sr])if(void 0===e[Ra][er])i=o.dy[e[Ra][Qa]];else{const t=(yield{[Za]:[e[Ra][er]]})[Ja](e[Ra][er]),a=null==t?void 0:t[za](),o=(0,c.SR)(e[Ra][Qa]),s=null==a?void 0:a[o];if(void 0===s||void 0===a)r[qa]({[sr]:d.h4.MemberPropertyMissing,node:e,token:e[Ra]});else if(void 0!==n[sr][er])if((0,Me.qo)(e[Ra][er],n[sr][er])){const t=yield*(0,c.IP)(o,a,s);i=t[0],!0===t[1]&&r[qa]({[sr]:d.h4[Ha],node:e,token:e[Ra]})}else r[qa]({[sr]:d.h4[La],node:e,token:e[Ra]})}else"unknown"!==n[sr][sr]&&r[qa]({[sr]:d.h4[Va],node:e,[Ca]:n});return{node:{...e,[Ca]:n,[sr]:i??{[sr]:"unknown"},[rr]:t},[ar]:r}}case d.bG.MemberUserProperty:{const{node:n,[ar]:a}=yield*ur(e[Ca],t),r=[...a];let i;return"person"===n[sr][sr]?i=o.VJ[e.userProperty]:"unknown"!==n[sr][sr]&&r[qa]({[sr]:d.h4[Pa],node:e,[Ca]:n}),{node:{...e,[Ca]:n,[sr]:i??{[sr]:"unknown"},[rr]:t},[ar]:r}}case d.bG.RecoveryNode:return{node:{...e,[sr]:{[sr]:tr},[rr]:t},[ar]:[]};default:(0,Se.unreachable)(e)}}async function lr(e,t,n){const a=ur(e,t[rr]);let r=a.next();for(;!r.done;){const e=t[Ea](r.value);r=a.next((0,De.isPromise)(e)?await e:e)}if(!n)return r.value;const o=r.value[ar].map((e=>{const t=(0,Ta.sB)(e);return{...e,node:Ye(t,n)}}));if(t.sourceProperty){(0,c.JT)(e)[ir](t.sourceProperty)&&o[qa]({[sr]:d.h4.CircularDependency,node:Ye(e,n)})}return{node:r.value.node,[ar]:o}}var dr=n(58573);const cr=n(85).SkZ,fr=n(85).Mfg,mr=n(85).ROM,vr=n(85).hzi,hr=n(85).Ddq,pr=n(85).FH8,yr=n(85).IsR,br=n(85).HBc,xr=n(85).E3S,gr=n(85)._kS,kr=n(85).TtP;function wr(e,t){if(t<e.startOffset||t>e.endOffset+1)return[];const n=e.kind;switch(n){case d.bG.Number:case d.bG.String:case d.bG.Boolean:case d.bG.NotionToken:case d.bG.Identifier:case d.bG.RecoveryNode:return[e];case d.bG.Conditional:{const n=wr(e.condition,t);if(n[kr]>0)return[e,...n];const a=wr(e.expIfTrue,t);if(a[kr]>0)return[e,...a];if(void 0!==e.expIfFalse){const n=wr(e.expIfFalse,t);if(n[kr]>0)return[e,...n]}return[e]}case d.bG.Equality:case d.bG.Relational:case d.bG.Additive:case d.bG.Multiplicative:case d.bG.Exponentiation:{const n=wr(e.lhs,t);if(n[kr]>0)return[e,...n];const a=wr(e.rhs,t);return a[kr]>0?[e,...a]:[e]}case d.bG.LogicalOr:case d.bG.LogicalAnd:case d.bG.Array:for(const n of e.elements){const a=wr(n,t);if(a[kr]>0)return[e,...a]}return[e];case d.bG.Unary:{const n=wr(e[gr],t);return n[kr]>0?[e,...n]:[e]}case d.bG.Call:{const n=wr(e[gr],t);if(n[kr]>0)return[e,...n];for(const a of e.arguments){const n=wr(a,t);if(n[kr]>0)return[e,...n]}return[e]}case d.bG[xr]:case d.bG.MemberBlockProperty:case d.bG.MemberUserProperty:{const n=wr(e[gr],t);return n[kr]>0?[e,...n]:[e]}default:(0,Se.unreachable)(n)}}async function Tr(e,t,n){const a=[];if(void 0!==e){const r=t[br]({recordPointers:[e]}),i=((0,De.isPromise)(r)?await r:r).getRecordModel(e),s=null==i?void 0:i.getNormalizedSchema();if(s)for(const[u,l]of Object.entries(s))u!==t.sourceProperty&&null!=l&&l.name&&Er(n,l.name)&&a.push({kind:o.WY.Token,name:l.name,token:{type:o.Oy[yr],property:(0,c.Uw)(u),[pr]:e}})}for(const r of Object.values(o.vz)){if(r===o.vz.Title)continue;const e=(0,c.Ve)(r);(""===n||Er(n,e))&&a.push({kind:o.WY.Token,token:{type:o.Oy[yr],property:r,[pr]:void 0},name:e})}return a}function Er(e,t){return""===e||(0,dr.C6)(e,t)}async function Pr(e){const{prefix:t,context:n,receiverType:a,hideDeprecatedCompletions:r}=e,i=[],s=new Set;if(void 0===a){var u;n[hr].forEach((e=>{if(e.kind===o.yp.Binding){const n=e.id;!s.has(n)&&Er(t,e.id)&&(i.push({kind:o.WY.Binding,text:n,type:e.type}),s.add(n))}}));const e=null===(u=n[hr].find((e=>e.kind===o.yp.ThisRow)))||void 0===u?void 0:u.type;"block"===(null==e?void 0:e.type)&&void 0!==e[pr]&&i.push(...await Tr(e[pr],n,t)),n[hr].forEach((e=>{if(e.kind===o.yp[vr]&&Er(t,e.name)){const t=(0,c.ij)(e.id);i.push({kind:o.WY.Token,token:{type:o.Oy[vr],valueId:t}})}}))}else"block"===a.type?i.push(...await Tr(a[pr],n,t)):"person"===a.type&&i.push(...function(e){const t=[];for(const n of Object.values(o.V2))(""===e||n.startsWith(e))&&t.push({kind:o.WY.Token,token:{type:o.Oy.UserProperty,userProperty:n}});return t}(t));for(const c in bn)if(!s.has(c)&&Er(t,c)&&(!r||!c.startsWith("_")&&"joinText"!==c)){const e=bn[c];if(void 0!==a){var l,d,f,m,v,h;const t=(null===(l=e[mr])||void 0===l||null===(d=l.expected)||void 0===d||null===(f=d[0])||void 0===f?void 0:f.type)??(null===(m=e[mr])||void 0===m||null===(v=m.varargs)||void 0===v||null===(h=v[0])||void 0===h?void 0:h.type);if(void 0===t||!(0,Qe.qT)(a,t))continue}i.push({kind:o.WY.LibraryFunction,libraryFunction:e}),s.add(c)}return i}function Vr(e,t){const n=[...e].reverse().find((e=>e.kind===d.bG.Call));if((null==n?void 0:n.kind)===d.bG.Call){let e=-1;if(t>n.lParenOffset&&(void 0===n.rParenOffset||t<=n.rParenOffset))for(e=0;e<n.commaOffsets[kr]&&!(n.commaOffsets[e]>t);e++);return{[gr]:n[gr],parameterIndex:e}}}async function Lr(e){const{formula:t,inputPosition:n,context:r,hideDeprecatedCompletions:s}=e,[u,l]=Ue(t),c=function(e,t){if(0===t)return 0;let n=0,a=0;for(let r=0;r<e[qe];r++){const o=e[r];switch(o.type){case"code":if(n+o[qe]>=t)return a+(t-n);n+=o[qe],a+=o[qe];break;case"token":if(n+1>=t)return a+o[qe];n+=1,a+=o[qe];break;default:(0,Se.unreachable)(o)}}return a}(l,n);let f=u.substring(0,c);if(""===f.trim())return{value:{inputPosition:n,mappedPosition:c,completions:await Pr({prefix:"",context:r,hideDeprecatedCompletions:s})}};const m=f[f[kr]-1],v=/[\s.]/.test(m);v&&(f=`${f}_`);const h=_(),p=$(h).tokenize(f).tokens,y=H(h);y.input=p;const b=Re(y[gr]());if(a.x.isFail(b))return{value:void 0};const x=await lr(b.value,r,l),{node:g}=x,k=p[p[kr]-1];let w=!1,T=p;void 0!==k&&(0,i.ol)(k,h[fr])&&(T=[...T],T.pop(),w=!0);const E=y.computeContentAssist(gr,T),P=w?k.image.substring(0,k.image[kr]-(v?1:0)):void 0,V=wr(g,c),L={inputPosition:n,mappedPosition:c,nodePath:V,callParameter:Vr(V,c)},R=[],A=Vr(V,c);if(A&&(A[gr].kind===d.bG[xr]&&0===A.parameterIndex||A[gr].kind===d.bG.Identifier&&1===A.parameterIndex)){const e=A[gr].kind===d.bG[xr]?A[gr].name:A[gr].text,t=bn[e];(null==t?void 0:t[mr])===hn&&Er(P??"",vn)&&P!==vn&&"currentValue."!==P&&R.push({kind:o.WY.Binding,text:vn,type:{type:"unknown"}})}const N={[br]:r[br],[hr]:g[hr],sourceProperty:r.sourceProperty};for(const a of E)if(a.nextTokenType===h[fr])if("dotMemberExpression"===a.ruleStack[a.ruleStack[kr]-1]){const e=T[T[kr]-1];if(!(0,i.ol)(e,h.Dot))return{value:void 0};const t=V[V[kr]-1];if(void 0!==t&&(t.kind===d.bG[xr]||t.kind===d.bG.MemberBlockProperty)){const e=t[gr];L[cr]={type:"member dot receiver",prefix:P,receiverNode:e};const n=await Pr({prefix:P??"",context:N,receiverType:e.type,hideDeprecatedCompletions:s});R.push(...n)}}else{L[cr]={type:"free identifier",prefix:P};const e=await Pr({prefix:P??"",context:N,hideDeprecatedCompletions:s});R.push(...e)}return L.completions=R,{value:L}}var Rr=n(91905);const Ar=n(85).mUE,Nr=n(85).FlC,Or=n(85).S6r,Dr={slice:"substring",start:"dateStart",end:"dateEnd"},Mr=["add","subtract","multiply","divide","pow","mod","and","or","equal","unequal","larger","largerEq","smaller","smallerEq"];function Gr(e,t,n){return a=e,r=Ir(e,t,n),"conditional"===a.type||"function"===a.type&&(Mr.includes(a.name)||["unaryPlus","unaryMinus"].includes(a.name))||"operator"===a.type&&void 0!==a[Or]&&a[Or].length>=2?[["("],...r,[")"]]:r;var a,r}function Ir(e,t,n){switch(e.type){case"conditional":return[...Gr(e.condition,t,n),[" ? "],...Gr(e.true,t,n),[" : "],...Gr(e[Nr],t,n)];case"constant":switch(e.value_type){case"number":return(0,Fe.createTextValue)(`${e.value}`);case"string":return(0,Fe.createTextValue)(`"${e.value.replace(/"/g,'\\"')}"`);case"boolean":return(0,Fe.createTextValue)(`${e.value?"true":Nr}`);default:throw new Error(`unexpected constant type: ${e.value_type}`)}case"function":if(Mr.includes(e.name)){const a="equal"===e.name?"==":"concat"===e.name?"+":Rr.Gn[e.name][Ar];return[...Gr(e[Or][0],t,n),[` ${a} `],...Gr(e[Or][1],t,n)]}switch(e.name){case"unaryMinus":return[["-"],...Gr(e[Or][0],t,n)];case"unaryPlus":return[["toNumber("],...Ir(e[Or][0],t,n),[")"]];case"month":return[["month("],...Ir(e[Or][0],t,n),[") - 1"]];case"day":return[["day("],...Ir(e[Or][0],t,n),[") % 7"]];case"concat":return[["("],...(0,ze.Z)((e[Or]??[]).map((e=>Ir(e,t,n))),(()=>[[" + "]])).flat(),[")"]];case"join":return[["join("],["["],...(0,ze.Z)((e[Or]??[]).slice(1).map((e=>Ir(e,t,n))),(()=>[[", "]])).flat(),["]"],[", "],...Ir(e[Or][0],t,n),[")"]];default:if("id"===e.name)return(0,Fe.createTextValue)("id()");const a=Dr[e.name]??e.name;if(void 0===bn[a])throw new Error(`unexpected formula: ${a}`);return[[`${a}(`],...(0,ze.Z)((e[Or]??[]).map((e=>Ir(e,t,n))),(()=>[[", "]])).flat(),[")"]]}case Ar:var a,r;if(1===(null===(a=e[Or])||void 0===a?void 0:a.length))switch(e[Ar]){case"not":return[["!"],...Gr(e[Or][0],t,n)];case"+":return[["toNumber("],...Ir(e[Or][0],t,n),[")"]];default:return[[`${e[Ar]}`],...Gr(e[Or][0],t,n)]}if(2===(null===(r=e[Or])||void 0===r?void 0:r.length))return[...Gr(e[Or][0],t,n),[` ${e[Ar]} `],...Gr(e[Or][1],t,n)];switch(e[Ar]){case"?":return[...Gr(e[Or][0],t,n),[" ? "],...Gr(e[Or][0],t,n),[" : "],...Gr(e[Or][0],t,n)];default:throw new Error(`unhandled operator: ${e[Ar]}`)}case"symbol":switch(e.name){case"pi":return(0,Fe.createTextValue)("pi()");case"e":return(0,Fe.createTextValue)("e()");case"true":return(0,Fe.createTextValue)("true");case Nr:return(0,Fe.createTextValue)(Nr);default:throw new Error(`unexpected constant: ${e.name}`)}case"property":{const a=n[e.id];if(void 0===a)return[[e.name]];const r=(0,Fe.createMentionToken)((0,Fe.createFormulaPagePropertyMentionAnnotation)({collection:t,property:e.id,name:a.name}));switch(a.type){case"person":case"relation":return[["join(map("],r,[', format(currentValue)), ", ")']];case"rollup":return a.aggregation&&"show_unique"!==a.aggregation?[r]:[["join(map("],r,[', format(currentValue)), ",")']];case"file":case"multi_select":return[["join("],r,[', ", ")']];default:return[r]}}case"error":throw new Error("unexpected formula error node")}}function Fr(e,t){const[n,o]=Ue(e),[i,s]=kn(n);if(s.length>0)return{error:s[0]};const u=Re(i);return a.x.isFail(u)?u:function(e,t,n){try{const n=ga(e,t);let a=n.next();for(;!a.done;){const e=t[Mn](a.value);a=n.next(e)}return{value:a.value}}catch(a){if(a instanceof d.WV){const e=a.info;return n&&(0,c.w7)(e)?{error:{...e,node:Ye(e.node,n)}}:{error:e}}return{error:{[ba]:d.FY[Dn],error:(0,r.tg)(a)}}}}(u.value,t)}async function Sr(e,t){const[n,r]=Ue(e),[o,i]=kn(n);if(i.length>0)return{error:i[0]};const s=Re(o);return a.x.isFail(s)?s:ka(s.value,t)}async function Cr(e,t){const[n]=Ue(e),[r,o]=kn(n);if(o.length>0)return{value:{parseErrors:o}};const i=Re(r);if(a.x.isFail(i))return{value:{parseErrors:[i.error]}};const s=await lr(i.value,t),{node:u,errors:l}=s;return{value:{type:u.type,typeErrors:l}}}function Br(e){const[t,n]=Ue(e),[r,o]=kn(t);if(o.length>0)return[];const i=Re(r);return a.x.isFail(i)?[]:(0,c.JT)(i.value)}}}]);