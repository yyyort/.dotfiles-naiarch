"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5741],{30038:(e,t,o)=>{o.r(t),o.d(t,{CompletionPopup:()=>Mi});var n=o(97464),i=o.n(n),r=o(77094),s=o.n(r),a=o(67294),l=o(18466),c=o(26263),u=o(1302),d=o(480),p=o(81954),m=o(24405),f=o(42875),v=o(66673),g=o(62965),y=o(44805),h=o(97880),w=o(5366),k=o(96323),b=o(50906),C=o(43132),S=o(73928),x=o(12359),A=o(3386),P=o(43250),I=o(99417),E=o(43455),M=o(16772),Z=o(29798),_=o(89626),T=o(16091),R=o(92022),D=o(3909),F=o(72897),L=o(32163),B=o(53953),O=o(63296),K=o(72495),H=o(34859);const V=o(85).j7K,U=o(85).y79,z=o(85).D7I,$=o(85).nx5,J=o(85).kVk;function G(e){window.__c={n:"ExitConfirmationDialog"};const{open:t,onCancelExit:o,onConfirmExit:n}=e,i=(0,a.useCallback)((()=>s()(N,{onConfirmExit:n,onCancelExit:o})),[n,o]);return s()(B.Z,{open:t,render:i,disableAnimation:!0,onDismiss:o})}function N(e){window.__c={n:"ExitConfirmationDialogContent"};const t=(0,m.yK)((e=>({wrapper:{padding:24,display:"flex",flexDirection:"column",minWidth:280},[J]:{fontWeight:500,maxWidth:240,textAlign:"center",marginTop:8,marginBottom:8,lineHeight:"1.2em"},icon:{width:32,height:32,alignSelf:"center",paddingTop:8,fill:e.accentColors.purple[400]}})),[]),o={width:"100%",marginTop:8},n=[{key:"confirm",render:e=>a[z](O.Z,i()({style:o},e),s()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.confirmExit",[$]:"Discard"})),action:e.onConfirmExit},{key:"cancel",render:e=>a[z](O.Z,i()({style:o},e),s()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.cancelExit",[$]:"Cancel"})),action:e.onCancelExit}];return s()(F.Z,{capture:!0,preventType:H.Z.All},void 0,s()("div",{style:t.wrapper},void 0,D.Z.sparkles(t.icon),s()("p",{style:t[J]},void 0,s()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.question",[$]:"Do you want to discard the AI response?"})),s()(L.Z,{type:L.i[U],[V]:0,sections:[{key:"dialog",render:e=>a[z](K.Z,i()({topBorder:!1,disableMobileBorders:!0},e)),items:n}]})))}var W=o(10534),j=o(62967),q=o(48019),Y=o(73063),Q=o(68894),X=o(78140),ee=o(86825),te=o(64369),oe=o(33929),ne=o(87279),ie=o(79315),re=o(71184);const se=o(85).j7K,ae=o(85).P0G,le=o(85).gGi,ce=o(85).ChN,ue=o(85).jkI,de=o(85).H1U,pe=o(85).$bT,me=o(85).EMU,fe=o(85).Ws3,ve=o(85).Ubh,ge=o(85).pJD,ye=o(85).wgE,he=o(85).D7I,we=o(85).Yzm,ke=o(85).VFs,be=o(85).iB2,Ce=o(85).iDK,Se=o(85).Ezy,xe=o(85).SAR,Ae=o(85).kUS,Pe=o(85).bSA,Ie=o(85).rG,Ee=o(85).nx5,Me=(0,w.defineMessages)({save:{id:"ai.favorites.save",[Ee]:"Save changes"},[Ie]:{id:"ai.favorites.delete",[Ee]:"Delete"},runImmediately:{id:"ai.favorites.runImmediately",[Ee]:"Run immediately"},actionNameLabel:{id:"ai.favorites.actionNameLabel",[Ee]:"Action name"},cancelAndGoBack:{id:"ai.favorites.cancelAndGoBack",[Ee]:"Cancel and go back"}});function Ze(e){window.__c={n:"FavoriteEditorMenuPopupContent"};const{state:t,context:o,sessionId:n}=e,r=(0,w.useIntl)(),l=(0,d.O7)(),c=(0,a.useMemo)((()=>new Z.Z),[]),u=(0,j.PH)({key:"input",[Pe]:"TODO",[Ae]:Me.save,[xe]:[],[Se]:!1,render:()=>s()(K.Z,{isInput:!0,style:{marginTop:0}},void 0,s()(Q.ZP,{value:t[Ce].name,onChange:e=>{t.set({...t[Ce],name:e.target.value}),c.setState({focus:{section:0,[be]:1,[ke]:1}})},placeholder:oe.default[we](Me.actionNameLabel),focusInitial:!0})),action(e,t){}}),p=[(0,j.$J)({key:"favorite options section",render:e=>a[he](K.Z,e),actions:[u,(0,j.PH)({key:"runImmediately",[Pe]:"TODO",[Ae]:Me.runImmediately,[xe]:[],render:(e,o,n)=>{let{blocks:r,[ye]:s}=o;const l=Boolean(t[Ce][ge]);return a[he](ee.Z,i()({},e,{title:oe.default[we](Me.runImmediately),on:l}))},[Se]:!1,action(e,o){t.set({...t[Ce],[ge]:!t[Ce][ge]})}})]}),(0,j.$J)({actions:[(0,j.PH)({key:"save",[Pe]:"TODO",[Ae]:Me.save,[xe]:[],svg:D.Z.save,[Se]:!1,action(e,o){(0,W.m5)({state:t,[ye]:l,sessionId:n})}})],key:"actions",render:e=>a[he](K.Z,e)}),(0,j.$J)({key:"delete action section",render:e=>a[he](K.Z,e),actions:[(0,j.PH)({key:Ie,[Pe]:"TODO",[Ae]:Me[Ie],[xe]:[],svg:D.Z.trash,[Se]:!1,action(e,o){const{[ve]:i}=ie.default.state;i&&(x.createAndCommit({userAction:"ai.favoriteEditorPopup.delete",[ye]:l,perform(e){(0,re.QC)(t[Ce],i,e)}}),t.clear(),b[fe](l,{type:Ie,session_id:n,gtm_favorite_id:t[Ce].gtmFavoriteId}))}})]})],m=(0,a.useCallback)((()=>{}),[]);return s()("div",{style:{display:me,[pe]:"column"}},void 0,s()("div",{style:{display:me,[de]:ue,padding:"8px 8px 0 8px"}},void 0,s()(Y.Z,{icon:D.Z.backward,onClick:()=>{(0,W.ny)({[ye]:l,state:t})},ariaLabel:r[we](Me.cancelAndGoBack)}),s()(te.Z,{isSecondaryColor:!0,isSmall:!0,style:{[ce]:700}},void 0,s()(w.FormattedMessage,{id:"ai.favorites.saveHeader",[Ee]:"Save AI action"}))),s()(X.Z,{menuType:ne.og.Popup,width:le,maxHeight:"min(40vh, 320px)",minHeight:le},void 0,s()(q.Z,{[ae]:c,sections:p,onAccept:m,[se]:0,context:o})))}var _e=o(57819),Te=o(10161);const Re=o(85).Q9F,De=o(85).Yzm,Fe=o(85).nx5,Le=(0,w.defineMessages)({undoAriaLabel:{[Fe]:"Go to previous AI response",id:"id.completions.undoAriaLabel"},redoAriaLabel:{[Fe]:"Go to next AI response",id:"id.completions.redoAriaLabel"},historyLabel:{[Fe]:"{currentRevision} of {totalRevisions}",id:"id.completions.historyLabel"}}),Be={display:"flex",alignItems:"center",marginLeft:-2,marginRight:-2},Oe={width:20,height:20,marginLeft:2,marginRight:2};function Ke(e){window.__c={n:"CompletionHistory"};const{onUndo:t,onRedo:o,historyLabel:n}=e,i=(0,w.useIntl)();return t||o?s()("div",{style:Be},void 0,s()(Y.Z,{icon:D.Z.chevronLeft,ariaLabel:i[De](Le.undoAriaLabel),disabled:!t,onClick:t,style:Oe}),s()(te.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontVariantNumeric:"tabular-nums"}},void 0,n),s()(Y.Z,{icon:D.Z[Re],ariaLabel:i[De](Le.redoAriaLabel),disabled:!o,onClick:o,style:Oe})):null}const He={onUndo:void 0,onRedo:void 0,historyLabel:void 0};function Ve(e,t){const o=M.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;const{sessionId:n}=o,i=(0,I.xM)(o);b.trackAICompletionPopupHistoryNavigation(e,{session_id:n,inference_id:i.inferenceId,type:t})}var Ue=o(56863),ze=o(81598),$e=o(82375),Je=o(11066),Ge=o(1743),Ne=o(74194);const We=o(85).wgE,je=o(85).D7I,qe=o(85).Mm1,Ye=o(85)._V5,Qe=o(85).raT,Xe=o(85).L$z,et=o(85).$mk,tt=o(85).X5t,ot=o(85).iDK,nt=o(85).nx5,it=(0,w.defineMessages)({promptLabel:{[nt]:"Prompt for action",id:"ai.favoritePromptEditor.promptLabel"}});function rt(e,t){e.set({...e[ot],[tt]:{...e[ot][tt],[et]:t}})}function st(e){window.__c={n:"FavoritePromptEditorContent"};const{state:t,inputRef:o,[Xe]:n}=e,i=(0,d.O7)(),r=(0,_e.bJ)(),l=(0,w.useIntl)().formatMessage(it.promptLabel);return s()(Ge.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,a[je](Ne.Z,{ref:o,format:Ne.Z.Format[Qe],placeholder:l,selectAll:!0,value:t[ot][tt][et],textarea:!0,textareaSubmitOnEnter:!1,autosize:!0,style:{minHeight:28,[Ye]:4,[qe]:4},onChange:e=>rt(t,e.target.value),onKeyDown:e=>{"Enter"===e.key&&rt(t,`${t[ot][tt][et]}\n`)},focusInitial:!1}),s()("div",{style:r.inputActions},void 0,s()(Je.Z,{style:r.purpleButton,onClick:()=>(0,W.m5)({state:t,[We]:i,[Xe]:n})},void 0,s()(w.FormattedMessage,{[nt]:"Done",id:"ai.favoritePromptEditor.done"}))))}var at=o(61519);const lt=o(85).D7I,ct=o(85).DIE,ut=o(85).Mm1,dt=o(85)._V5,pt=o(85).raT;function mt(e){window.__c={n:"PromptOrActionInput"};const{query:t,setQuery:o,onDismiss:n,onSubmit:i,inputRef:r,submitOnEnter:l,inputPlaceholder:c,children:u}=e,[d,p]=(0,a.useState)(void 0);return s()(Ge.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,a[lt](Ne.Z,{ref:r,format:Ne.Z.Format[pt],placeholder:c,selectAll:!0,value:t,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,[dt]:4,[ut]:4},onSubmit:e=>{t&&l&&(e[ct](),null==i||i())},onChange:e=>{o(e.target.value)},onKeyUp:e=>{"Backspace"===e.key&&(""===d&&n(),p(void 0))},onKeyDown:e=>{"Backspace"===e.key&&void 0===d&&p(t)},focusInitial:!0}),u)}var ft=o(58261),vt=o(58032);const gt=o(85).D7I,yt=o(85).qc1,ht=o(85).nx5;function wt(e){window.__c={n:"SubmitAIPromptButton"};const{onSubmit:t,canSend:o}=e,n=(0,_e.bJ)(),r=(0,d.O7)(),l=(0,p.VK)((()=>r.device.isPhone),[r]);return s()(vt.Z,{renderTooltip:()=>s()("div",{},void 0,s()(w.FormattedMessage,{[ht]:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip"}),s()(ft.Z,{style:n.keyboardShortcutInverted,name:"enter"})),placement:vt.Z.Placement.Bottom,render:e=>a[gt](Y.Z,i()({icon:D.Z.sendArrow,onClick:t,isPurple:o,disabled:!o,iconStyle:{height:l?24:20,width:l?24:20},style:{[yt]:"auto",height:l?24:20,width:l?24:20}},e))})}const kt=o(85).D7I,bt=o(85).Yzm,Ct=(0,w.defineMessages)({followUpInputPlaceholder:{id:"AlternativeCommandPalette.followUp.inputPlaceholder",defaultMessage:"Tell AI what to do next…"}}),St={padding:"8px 10px 8px 14px"};function xt(e){window.__c={n:"CompletionFinishedContent"};const t=(0,_e.bJ)(),o=(0,w.useIntl)(),n=0===e.query.trim().length,r=(0,d.O7)(),l=(0,p.VK)((()=>{if(!(0,I.E8)(r.device)||!(0,I.Gw)())return!1;const e=$e.XN.state;return Boolean(e&&e.previewingStep)}),[r]);return a[kt](mt,i()({},e,{inputPlaceholder:o[bt](Ct.followUpInputPlaceholder)},l&&{onSubmit:void 0}),s()("div",{style:t.inputActions},void 0,s()(wt,{onSubmit:e.onSubmit,canSend:!n&&!l}),(e.onUndo||e.onRedo)&&a[kt](a.Fragment,null,s()(at.Z,{vertical:!0,size:1,style:St}),a[kt](Ke,e))))}var At=o(64921),Pt=o(91839);const It=o(85).V3,Et=o(85).nx5;function Mt(e){window.__c={n:"CompletionInProgressContent"};const{onStop:t,onRetry:o}=e,n=(0,_e.bJ)(),i=(0,d.O7)().device,r=i.isMobileNative&&i.isIOS;return s()(A.Z,{capture:!0,onEnter:()=>{t()},onEsc:()=>{t()},onKeypress:e=>{e.metaKey||"r"!==e.key||o()}},void 0,s()("div",{style:n.writingLabel},void 0,s()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.writing",[Et]:"AI is writing"}),s()(Pt.Z,{style:n.loadingDots})),!r&&s()(At.Z,{style:n.lightweightButton,onClick:o},void 0,s()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.tryAgain.label",[Et]:"Try again"}),s()("span",{style:n[It]},void 0,s()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.startOver.shortcut",[Et]:"r"}))),s()(At.Z,{style:n.lightweightButton,onClick:t},void 0,s()(w.FormattedMessage,r?{id:"AlternativeCompletionsPopupContent.cancel.label",[Et]:"Cancel"}:{id:"AlternativeCompletionsPopupContent.stop.label",[Et]:"Stop"}),s()("span",{style:n[It]},void 0,s()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.shortcut",[Et]:"esc"}))))}var Zt=o(96486),_t=o.n(Zt),Tt=o(61134),Rt=o(18647),Dt=o(17748);const Ft=o(85).D7I,Lt=o(85).kUS,Bt=o(85).pkR;function Ot(e){window.__c={n:"CompletionPreview"};const{temporaryListStore:t,isLoading:o}=e,n=(0,d.O7)(),i=(0,a.useRef)(null),r=null==i?void 0:i.current,l=null==r?void 0:r.getStore(),c=(0,p.VK)((()=>n.device.isPhone),[n]),u=(0,_e.jq)({resetWhenScrolledToBottom:!0,areWeLoading:o,scrollerStore:l});(0,a.useEffect)((()=>{r&&(u?Kt.cancel():Kt(r))}),[r,t,u]);const m={scroller:{maxHeight:c?"min(15vh, 200px)":"min(40vh, 320px)",width:"100%"}};return s()(a.Fragment,{},void 0,a[Ft](Rt.Z,{type:Rt.Z.OverflowType.Y,style:m.scroller,ref:i},s()(Tt.O,{[Lt]:"CompletionPopupContent",[Bt]:!0},void 0,s()(Dt.Z,{store:t,[Bt]:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}))))}const Kt=_t().debounce((e=>{e.scrollToBottom({animate:!0})}),60);var Ht=o(63594),Vt=o(42402);const Ut=o(85).nx5;function zt(){window.__c={n:"AiWarningNotice"};const e=(0,a.useCallback)((()=>{window.open("/help/guides/using-notion-ai#what-are-the-current-limitations-of-notion-ai")}),[]),t=(0,m.yK)((e=>({icon:{width:12,height:12,fill:e.lightIconColor,marginLeft:2},link:{color:e.lightTextColor,fontWeight:500}})),[]);return a.createElement(a.Fragment,null,D.Z.warning(t.icon),s()(te.Z,{isSecondaryColor:!0,isSmall:!0},void 0,s()(w.FormattedMessage,{id:"completions.AiWarning.warning",[Ut]:"AI responses can be inaccurate or misleading."})),s()(te.Z,{isSmall:!0},void 0,s()(Vt.Z,{onClick:e,style:t.link,disableHover:!0,disableUnderline:!0},void 0,s()(w.FormattedMessage,{id:"completions.AiWarning.learnMore",[Ut]:"Learn more"}))))}var $t=o(935),Jt=o(99498),Gt=o(93678),Nt=o(21115),Wt=o(8323),jt=o(78291);const qt=o(85).tBn,Yt=o(85).D7I,Qt=o(85).nx5;function Xt(){window.__c={n:"UpsellNotice"};const e=(0,d.O7)(),t=(0,p.VK)((()=>e.device.isMobile),[e]),o=(0,p.VK)((()=>{const e=jt.default.state.data;return Nt.isAdmin(e)}),[]),n=(0,a.useCallback)((()=>{t?Jt.showAddOnUpgradeModal():Gt.y(e,{from:"ai_upsell_notice",for:(0,Wt.getSubscriptionTier)(),addOnFeature:"ai"})}),[e,t]),i=(0,m.yK)((e=>({upsellIcon:{width:14,height:14,fill:e.lightIconColor},upsellLink:{color:e.blueColor,fontWeight:500}})),[]);return a[Yt](a[qt],null,D.Z.giftOutline(i.upsellIcon),s()(te.Z,{isSecondaryColor:!0,isSmall:!0},void 0,s()(w.FormattedMessage,{id:"UpsellNotice.label",[Qt]:"All free AI responses have been used for this workspace."}),!o&&a[Yt](a[qt],null," ",s()(w.FormattedMessage,{id:"UpsellNotice.contactWorkspaceOwner.label",[Qt]:"Contact your workspace owner to add Notion AI."}))),o&&a[Yt](a[qt],null,s()(te.Z,{isSmall:!0},void 0,s()(Vt.Z,{onClick:n,style:i.upsellLink,disableHover:!0,disableUnderline:!0},void 0,s()(w.FormattedMessage,{id:"UpsellNotice.link.label",[Qt]:"Go unlimited"})))))}const eo=o(85).jkI,to=o(85).H1U,oo=o(85).ewQ;function no(e){window.__c={n:"MainPopupFooter"};const{state:t}=e,o=(0,d.O7)(),n=(0,p.VK)((()=>o.device.isPhone),[o]),i=(0,m.yK)((e=>({wrapper:{background:"dark"===e.mode?e[oo].gray[100]:e[oo].gray[30],display:"flex",justifyContent:"space-between",[to]:eo,padding:"0 12px",borderTop:`1px solid ${e.lightDividerColor}`,gap:8,color:e.lightTextColor,fontSize:12,minHeight:36},noticeContent:{display:"flex",[to]:eo,gap:8},actionContent:{display:"flex",[to]:eo}})),[]),r=(0,p.VK)((()=>!Ht.Z.state),[]);if(n)return null;let a,l;return r&&(a=s()(Xt,{})),"results"!==t.stage||t.loading||(a=a??s()(zt,{}),l=s()($t.u,{revision:(0,I.xM)(t)})),a?s()("div",{style:i.wrapper},void 0,s()("div",{style:i.noticeContent},void 0,a),l&&s()("div",{style:i.actionContent},void 0,l)):null}const io=o(85).Yzm,ro=o(85).di,so=o(85).fBu,ao=o(85).W3n,lo=o(85).sbu,co=o(85).D7I,uo=o(85).L$z,po=o(85).jkI,mo=o(85).EMU,fo=o(85).sM5,vo=o(85).gGi,go=o(85).ewQ,yo=o(85).A7E,ho=o(85).wJk,wo=o(85).nx5,ko=(0,w.defineMessages)({writeInputPlaceholder:{[wo]:"Ask AI to write anything…",id:"completions.PromptMenu.alternativeUiWriteInputPlaceholder"},editInputPlaceholder:{[wo]:"Ask AI to edit or generate…",id:"completions.PromptMenu.alternativeUiEditInputPlaceholder"}});function bo(e){window.__c={n:"MainPopupContent"};const{state:t,[ho]:o,onCompletionRetry:n,onCompletionStop:r,temporaryListStore:l,favoriteEditingState:c}=e,u=(0,a.useRef)(null);(0,a.useEffect)((()=>{Ue.deactivateMenu()}),[]);const f=(0,d.O7)(),v=(0,p.VK)((()=>f.device.isPhone),[f]),g=(0,p.VK)((()=>ie.default.state.currentSpaceStore),[]),y=(0,p.VK)((()=>{if(!(0,I.E8)(f.device))return;const e=$e.XN.state;return e?e[yo].filter((e=>"assistantChat"===e.type||"assistantLoadPage"===e.type||"assistantSearch"===e.type)):void 0}),[f],{useDeepEqual:!0}),h=(0,m.yK)((e=>({icon:{height:18,width:18,paddingLeft:v?0:4,marginLeft:v?-4:void 0,fill:"dark"===e.mode?e[go].purple[600]:e[go].purple[300]},outer:{width:vo,minHeight:v?44:36,padding:v?"2px 16px 2px 16px":"2px 12px 2px 8px",[fo]:mo,flexDirection:"column",justifyContent:po,gap:2,fontSize:v?16:14}})),[v]),w=s()("div",{style:{height:36,alignItems:po,[fo]:mo}},void 0,D.Z.sparkles(h.icon));if("active"===c.type)return a[co]("div",{style:h.outer,ref:u},s()("div",{style:{[fo]:mo,gap:8,width:vo}},void 0,w,s()(st,{state:c,inputRef:e.inputRef,[uo]:t[uo]})));const k=a[co]("div",{style:h.outer,ref:u},l&&s()(Ot,{temporaryListStore:l,isLoading:"results"===t[lo]&&t[ao]}),y&&g&&a[co](a.Fragment,null,y.map(((e,t)=>s()(ze.qS,{clientStep:e,[so]:g,[ro]:g.id},t)))),s()("div",{style:{[fo]:mo,gap:8,width:vo}},void 0,w,"initialPrompt"===t[lo]||"initialPromptForAIBlock"===t[lo]?a[co](Co,i()({},e,{paletteMode:(0,_e.rR)(t)})):t[ao]?s()(Mt,{[ho]:o,state:t,onRetry:n,onStop:r}):a[co](xt,e)));return a[co](a.Fragment,null,k,s()(no,{state:t}))}function Co(e){window.__c={n:"MainPopupInitialPromptContent"};const{query:t,onSubmit:o,paletteMode:n}=e,r=(0,_e.bJ)(),l=(0,w.useIntl)(),c="edit"===n?l[io](ko.editInputPlaceholder):l[io](ko.writeInputPlaceholder),u=t.trim().length>0;return a[co](mt,i()({},e,{inputPlaceholder:c}),s()("div",{style:r.inputActions},void 0,s()(wt,{onSubmit:o,canSend:u})))}var So=o(8848),xo=o(68204),Ao=o(36769),Po=o(37181),Io=o(30793);const Eo=o(85).Ubh,Mo=o(85).D7I,Zo=o(85).Joh,_o=o(85).nQu,To=o(85).bSA,Ro=o(85).wgE,Do=o(85).Drs,Fo=o(85).JJj,Lo=o(85).nxm,Bo=o(85).Yzm,Oo=o(85).Ws3,Ko=o(85).nAm,Ho=o(85).ij9,Vo=o(85).NJt,Uo=o(85).L$z,zo=o(85).nx5,$o="recent-actions",Jo=(0,w.defineMessages)({recentActions:{[zo]:"Recents",id:"commandPalette.recentActions.title"},more:{[zo]:"See more",id:"commandPalette.recentActions.more"},removeFromMenu:{[zo]:"Remove this action from the menu",id:"commandPalette.recentActions.removeFromMenu"},addToFavorites:{[zo]:"Add to favorites",id:"commandPalette.recentActions.addToFavorites"}});function Go(e){window.__c={n:"FavoriteButton"};const{focused:t,recentAction:o,state:n,intl:i,[Uo]:r}=e,a=(0,d.O7)();return s()(Y.Z,{style:{[Vo]:t?Ho:Ko,width:18,height:18},onClick:()=>{b[Oo](a,{type:"create_from_recent",session_id:r,gtm_favorite_id:void 0}),n.set((0,re.kg)(o))},icon:D.Z.star,ariaLabel:i[Bo](Jo.addToFavorites)})}function No(){window.__c={n:"MoreIcon"};const e=(0,m.Fg)();return D.Z.dots({width:12,fill:e.mediumIconColor,marginLeft:2,marginRight:2})}(0,Ao.exposeDebugEnvironmentValue)("resetRecentAndFavoriteAIActions",(e=>()=>{const{[Eo]:t}=ie.default.state;if(!t)throw new Error("currentUserSettingsStore not found");x[Fo]({[Do]:"recentActions.debugging.resetRecentAndFavoriteAIActions",[Ro]:e,perform(e){Po.updateUserSettings({userSettingsStore:t,transaction:e,data:{recent_ai_actions:[],favorite_ai_actions:[]}})}})}));const Wo=o(85).j$N,jo=o(85).Ubh,qo=o(85).QAO,Yo=o(85).vfI,Qo=o(85).Ws3,Xo=o(85).BCA,en=o(85).X5t,tn=o(85).Ezy,on=o(85).SAR,nn=o(85).kUS,rn=o(85).bSA,sn=o(85).Ijy,an=o(85).DKU,ln=o(85).S6b,cn=o(85).oF7,un=o(85).Yzm,dn=o(85).qnf,pn=o(85).D7I,mn=o(85).Lhq,fn=o(85).u1y,vn=o(85).wgE,gn=o(85).Gm5,yn=o(85).nQu,hn=o(85).nx5;function wn(e){if("completionPopup"!==e.type||"results"!==e.stage)return;const t=(0,I.xM)(e);return"initial"===t.type?t:void 0}const kn="This string should never show up in analytics",bn=(0,w.defineMessages)({clickToEditAndRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToEditAndRetry",[hn]:"Click to edit prompt and retry"},clickToRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToRetry",[hn]:"Click to retry"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",[hn]:"Try again"},delete:{id:"completions.CompletionMenuActionBar.delete",[hn]:"Discard"},close:{id:"completions.CompletionMenuActionBar.close",[hn]:"Close"},keep:{id:"completions.CompletionMenuActionBar.done",[hn]:"Done"},replace:{id:"completions.CompletionMenuActionBar.replace",[hn]:"Replace selection"},insert:{id:"completions.CompletionMenuActionBar.insert",[hn]:"Insert below"},addToFavorites:{id:"completions.CompletionMenuActionBar.addToFavorites",[hn]:"Add to favorites"}});function Cn(e){const{filter:t,state:o,from:n,favoriteEditingState:i,[yn]:r,onImprove:l,[gn]:c,intl:u,[vn]:d,completionResultInfo:p}=e,m=(0,I.E8)(d.device);let f;switch(o.stage){case"initialPrompt":case fn:f=function(e){const{state:t,[vn]:o,intl:n,filter:i,from:r,[yn]:l,favoriteEditingState:c,type:u}=e,{[jo]:d}=ie.default.state;if((0,I.E8)(o.device))return[];const p=d?function(e,t,o,n,i){const r=i.filterOut[Lo]().trim(),l=(0,Io.pz)(o),c=[];let u=0;for(const a of l){const l="recentAction."+u++,d=r=>s()("div",{style:{display:"flex"}},void 0,s()(Y.Z,{style:{[Vo]:r.focused?Ho:Ko,width:18,height:18},onClick:()=>x[Fo]({[Do]:"ai.recentActions.renderRemoveButton",[Ro]:n,perform(e){(0,Io.lG)(a,o,e)}}),icon:D.Z.closeSmall,ariaLabel:t[Bo](Jo.removeFromMenu)}),"inactive"===i.favoriteEditingState.type?s()(Go,{[Uo]:e[Uo],state:i.favoriteEditingState,focused:r.focused,recentAction:a,intl:t}):s()(k.xj,{type:"updatePrompt",focused:r.focused}));let p;if(a.prompt[Lo]().trim()!==r){switch(a.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(p=(0,k.cK)({key:l,name:a.prompt,[To]:"recentAction",right:d,[_o]:i[_o],[Zo]:j.zz}));break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(p=(0,k.cK)({key:l,name:a.prompt,[To]:"recentAction",right:d,[_o]:i[_o],[Zo]:j.zz}));break;default:(0,h.unreachable)(a)}p&&c.push(p)}}const d=c.slice(0,3),p=c.slice(3);if(p.length){const e=(0,j.$J)({key:"more recent actions",render:e=>a[Mo](K.Z,e),actions:p}),t=(0,j.MV)({key:"more recent actions extension",displayName:Jo.more,[To]:"Completions - more",validators:[],svg:()=>s()(No,{}),subActions:()=>[e],collapseSubActionsIntoParent:!0,width:400});d.push(t)}return[(0,j.$J)({key:$o,title:Jo.recentActions,render:e=>a[Mo](K.Z,e),actions:d})]}(t,n,d,o,{[yn]:l,favoriteEditingState:c,filterOut:i}):[],m=[...d&&"disabled"!==c.type?(0,W.Mi)(o,t,n,d,{[yn]:l,favoriteEditingState:c,filterOut:i}):[]];"initialPromptForAIBlock"===t.stage?m.push((0,k.xI)({store:t.store,from:r})):"aiBlock"!==u&&m.push(...(0,k.LK)({from:r,type:u,[yn]:l}));return m.push(...p),m}({state:o,[vn]:d,intl:u,filter:t,from:n,[gn]:c,favoriteEditingState:i,[yn]:r,type:(0,_e.VZ)(o)});break;case"results":f=o.loading?[]:function(e){const{[vn]:t,state:o,defaultAction:n,isAssistant:i,closeOrDiscard:r,favoriteEditingState:l}=e,c={key:"insert",[rn]:kn,[nn]:bn.insert,[on]:[],[tn]:!0,svg:D.Z.insertDown,[en](){e.onInsert()}},u={key:"delete",[rn]:kn,[nn]:bn.delete,[on]:[],[tn]:!0,svg:D.Z.trash,[en](){e.onCancel()}},d=function(e){const{state:t,onRetry:o}=e;if("results"!==t.stage)return;return{key:"tryAgain",[rn]:kn,[nn]:bn.tryAgain,[on]:[],[tn]:!0,svg:D.Z.undo,renderTooltip:()=>s()(xn,{state:t}),[en](){o()}}}({...e}),p=[],m=D.Z.thinCheck;if(i)return[(0,j.$J)({key:"main",render:e=>a[pn](K.Z,e),[mn]:[(0,j.PH)({key:"keep",[rn]:kn,[nn]:bn.keep,[on]:[],[tn]:!0,svg:m,[en](){e[Xo]({exitType:"accept"})}})]})];"accept"===n?p.push((0,j.PH)({key:"keep",[rn]:kn,[nn]:bn.keep,[on]:[],[tn]:!0,svg:m,[en](){e[Xo]({exitType:"accept"})}})):"replace"===n?p.push((0,j.PH)({key:"replace",[rn]:kn,[nn]:bn.replace,[on]:[],[tn]:!0,svg:m,[en](){e.onReplace()}}),(0,j.PH)(c)):"insert"===n?p.push((0,j.PH)({...c,svg:m})):(0,h.unreachable)(n);p.push((0,j.PH)({key:dn,[rn]:kn,[nn]:I.Dr[dn],[on]:[],[tn]:!0,svg:An(D.Z.pencil),[en](){e.onImprove({type:dn})}}),(0,j.PH)({key:cn,[rn]:kn,[nn]:I.Dr[cn],[on]:[],[tn]:!0,svg:An(D.Z.aiMakeLonger),[en](){e.onImprove({type:cn})}}),(0,j.PH)({key:"addToFavorites",[rn]:kn,[nn]:bn.addToFavorites,[on]:[()=>Boolean(Pn(o,l))],[tn]:!0,svg:An(D.Z.star),[en](){const e=Pn(o,l);if(!e)return;const n=(0,re.kg)(e.recentAction);e.favoriteEditingState.set(n),b[Qo](t,{type:"create_from_completion",session_id:o.sessionId,gtm_favorite_id:void 0})}}),(0,j.PH)({key:"convertToAiBlock",[rn]:kn,[nn]:I.Dr.insertAIBlock,[on]:[()=>{if("completionPopup"!==o.type||"results"!==o.stage||"cursor"!==o[gn].type)return!1;const e=wn(o);return!!e&&Boolean(I.Xi[e[sn].key])}],[tn]:!0,svg:An(D.Z.sparkles),[en](){e[Xo]({exitType:Yo})}}));const f=[d?(0,j.PH)(d):void 0,"discard"===r?(0,j.PH)(u):(0,j.PH)({key:"close",[rn]:kn,[nn]:bn.close,[on]:[],[tn]:!0,svg:D.Z.close,shortcuts:["esc"],[en](){e[Xo]({exitType:qo,selectInsertion:!0})}})],v=(0,j.$J)({key:"main",render:e=>a[pn](K.Z,e),[mn]:p}),g=(0,j.$J)({key:"final",render:e=>a[pn](K.Z,e),[mn]:f.filter(h.isDefined)});return[v,g]}({[vn]:d,state:o,onImprove:l,closeOrDiscard:"cursor"===o[gn].type?"close":"discard",isAssistant:m,favoriteEditingState:i,...p});break;default:(0,h.unreachable)(o)}let v=(0,xo.fuzzyMatchActions)({sections:f,[gn]:c,query:t});if(1===v.length&&v[0].key===$o){const e=v[0][mn].slice();(0,I.LN)(t,u)||e.unshift((0,k.sH)({customPrompt:t,execute:p.onSubmit})),v=[(0,j.$J)({key:mn,render:e=>a[pn](K.Z,e),[mn]:e})]}else(function(e){let t=!1;for(const o of e)if(o.key===W.YX)t=!0;else if(o.key!==$o)return!1;return t})(v)&&v.push((0,j.$J)({key:"literal-actions",render:e=>a[pn](K.Z,e),[mn]:[(0,k.sH)({customPrompt:t,execute:p.onSubmit})]}));return v}function Sn(e,t){switch(t.type){case dn:return e[un](I.Dr[dn]);case cn:return e[un](I.Dr[cn]);case"helpMeEdit":return t.prompt}}function xn(e){window.__c={n:"TryAgainTooltip"};const{state:t}=e,o=(0,m.yK)((e=>({hint:{color:e[ln]}})),[]),n=(0,I.xM)(t),i=(0,w.useIntl)();let r,l=bn.clickToEditAndRetry;if("initial"===n.type)if(S[an](n))r=(0,I.gY)(n);else{l=bn.clickToRetry;const e=n[sn].name;r="string"==typeof e?e:i[un](e)}else"followup"===n.type?r=Sn(i,n.improvement):(0,h.unreachable)(n);return a[pn](a.Fragment,null,s()("div",{},void 0,r),s()("div",{style:o.hint},void 0,i[un](l)))}function An(e){return()=>s()(k.lA,{svg:e,svgFill:So.FN.light.purple[400]})}function Pn(e,t){if("disabled"===t.type)return;const o=wn(e);if(!o)return;const{[jo]:n}=ie.default.state;if(!n)return;const i=(0,Io.BG)({[sn]:o[sn],[Wo]:o[Wo],promptTitle:o.promptTitle});return i&&!(0,re.Gl)(n,i)?{currentInitialRevision:o,recentAction:i,favoriteEditingState:t,[jo]:n}:void 0}const In=o(85).P0G;function En(e){window.__c={n:"MenuPopupContent"};const{sections:t,onCloseParentMenu:o,context:n,[In]:i}=e,r=(0,a.useCallback)((e=>{e.closeParentMenu&&o()}),[o]),l=(0,d.O7)(),c=(0,p.VK)((()=>l.device.isPhone),[l]);return s()(X.Z,{menuType:c?ne.og.ActionSheet:ne.og.Popup,width:"100%",maxHeight:c?"min(17vh, 160px)":"min(40vh, 320px)",maxWidth:"100%"},void 0,s()(q.Z,{[In]:i,sections:t,onAccept:r,initialFocus:0,context:n}))}var Mn=o(51454),Zn=o(69454),_n=o(77794),Tn=o(21199),Rn=o(45010),Dn=o(39098);const Fn=o(85).tw8,Ln=o(85).D7I,Bn=o(85).k_9;function On(e){window.__c={n:"PopupPositioner"};const{[Bn]:t,openState:o,children:n}=e,[r,l]=(0,a.useState)(Date.now()),c=(0,a.useCallback)((()=>l(Date.now())),[]),u=(0,a.useRef)(null),[d,f]=(0,a.useState)(void 0),[v,g]=(0,a.useState)(void 0),y=(0,p.VK)((()=>{const e=(0,_e.$b)(o);if(!e)return;const n=(0,I.wA)(e);if(!n)return;const{origin:i}=e;"results"!==o.stage&&n&&i instanceof Dn.G&&("spacebar"===o.from||i.isEmptyEditableBlock())&&(n.height=0);const r=t.state,s=r.clientRect??new DOMRect,a=r.scrollTop;return function(e){const{openState:t,originRect:o,scrollerRect:n,scrollerScrollTop:i,popupRect:r}=e,s=(null==r?void 0:r.height)??0,a=(null==r?void 0:r.width)??0,l=Math.min(Math.max(o.width,500),730);let c;const u=o[Fn]-n.top+i+Hn.top;o[Fn]+s+Hn.top+Hn[Fn]>n[Fn]&&(c=u-(n.height-s-Hn[Fn]+i));let d;a+Hn.left+Hn.right>n.width?d=Hn.left:o.left+a>n.right?d=n.width-a-Hn.right:(d=o.left-n.left,"initialPromptForAIBlock"===t.stage&&(d-=a-o.width));return{top:u,left:d,width:l,scrollTopIntoView:c}}({openState:o,originRect:n,scrollerRect:s,scrollerScrollTop:a,popupRect:d})}),[t,d,o]);(0,a.useEffect)((()=>{y&&g(y)}),[y]);const h=y??v;(0,a.useEffect)((()=>{if(Date.now()-r>500)return;const e=null==h?void 0:h.scrollTopIntoView;if(!e)return;const o=Vn(t);o&&Kn(e,o)}),[null==h?void 0:h.scrollTopIntoView,t,r]);const w=(0,m.yK)((e=>({wrap:{position:"absolute",left:null==h?void 0:h.left,top:null==h?void 0:h.top,width:null==h?void 0:h.width,zIndex:Mn.completionPopup}})),[h]);(0,a.useEffect)((()=>{const e=new _n.E;if(!u.current)throw new Error("ref.current is null");return e.observe(u.current),e.rect.addListener((e=>{f(e.state)})),()=>{e.destroy()}}),[]);const k="results"===o.stage&&!o.loading;(0,a.useEffect)((()=>{k&&c()}),[k,c]);const b="results"===o.stage&&o.loading,C=(0,_e.jq)({resetWhenScrolledToBottom:!1,areWeLoading:b,[Bn]:t}),S="results"===o.stage&&"cursor"===o.context.type,[x,A]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{!b||!S&&x||(C?Kn.cancel():null!=h&&h.scrollTopIntoView&&(c(),A(!0)))}),[C,x,S,b,h,c]),s()(Tn.Z,{capture:!0,render:e=>s()(Ge.Z,{capture:!0,allowMenuList:!0,allowEsc:!0},void 0,a[Ln]("div",i()({style:w.wrap,ref:u},e),h&&n))})}const Kn=_t().debounce(((e,t)=>{t.scrollByOffset(e,0,{animate:!0}),Rn.Z.MenuScroller&&Rn.Z.MenuScroller.scrollToTop()}),60),Hn={top:4,[Fn]:6,left:6,right:16};function Vn(e){var t,o;return e===(null===(t=Rn.Z.PageScroller)||void 0===t?void 0:t.stores.store)?Rn.Z.PageScroller:e===(null===(o=Rn.Z.PeekViewScroller)||void 0===o?void 0:o.stores.store)?Rn.Z.PeekViewScroller:void 0}const Un=o(85).$SM,zn=o(85).Omf;function $n(e){window.__c={n:"MobilePopupPositioner"};const{children:t,scrollerStore:o,openState:n}=e,[i,r]=(0,a.useState)(Date.now()),s=(0,a.useRef)(null),[l,c]=(0,a.useState)(void 0),u=(0,a.useCallback)((()=>r(Date.now())),[]),{WindowSizeStore:m}=(0,d.O7)();(0,a.useEffect)((()=>{const e=new _n.E,t=s.current;if(!t)throw new Error("ref.current is null");e.observe(t);let o=t[zn]().top;e.rect.addListener((e=>{o=e.state.top,c(e.state)}));const n=setInterval((()=>{const n=t[zn]().top;n!==o&&(o=n,e.recompute())}),50);return()=>{e.destroy(),clearInterval(n)}}),[]);const f="results"===n.stage&&!n.loading,g=("results"===n.stage||"initialPrompt"===n.stage)&&"cursor"===n.context.type,y=(0,p.VK)((()=>{const e=(0,_e.$b)(n);if(!e)return;const t=(0,I.wA)(e);if(!t)return;if(!l)return;const o=t.bottom-l.top;return o>0?o:void 0}),[n,l]);(0,a.useEffect)((()=>{if(Date.now()-i>500)return;if(!y)return;const e=Vn(o);e&&Kn(y,e)}),[y,o,i]),(0,a.useEffect)((()=>{f&&g&&u()}),[f,g,u]);const h="results"===n.stage&&n.loading,w=(0,v.D9)(h),[k,b]=(0,a.useState)();(0,a.useEffect)((()=>{w&&!h&&b(Date.now())}),[h,w]),(0,a.useEffect)((()=>{const e=!!k&&Date.now()-k<1e3;(h||e)&&g&&y&&u()}),[g,h,u,y,k]);const C=(0,p.VK)((()=>{const e=Zn.Z.state.phase===Zn.i.hidden||Zn.Z.state.phase===Zn.i.willHide,t=Zn.Z[Un]()+Hn.bottom;return e?m.getSafePaddingBottomPx(t):t}),[m]);return a.createElement("div",{ref:s,style:{position:"absolute",bottom:C,left:Hn.left,right:Hn.left,zIndex:Mn.hoverMenuOverlay}},t)}const Jn=o(85).Gm5,Gn=o(85).LCr,Nn=o(85).Drs,Wn=o(85).JJj,jn=o(85).RmD,qn=o(85).Fn3,Yn=o(85).wCc,Qn=o(85).xPf,Xn=o(85).wgE;const ei=o(85).voC,ti=o(85).P0G,oi=o(85).lGm,ni=o(85).D7I,ii=o(85).u3c,ri=o(85).Je3,si=o(85).p06,ai=o(85).yrh,li=o(85).Z97,ci=o(85).EmK,ui=o(85).W7Q,di=o(85).QAO,pi=o(85).xPf,mi=o(85).Fn3,fi=o(85).RmD,vi=o(85).DKU,gi=o(85).J$i,yi=o(85).Gm5,hi=o(85).Xss,wi=o(85).iDK,ki=o(85).L$z,bi=o(85).wCc,Ci=o(85).wgE,Si=o(85).zW6,xi=o(85).u1y,Ai=o(85).Ttb,Pi=o(85).sbu,Ii=o(85).k_9,Ei="notion-alternate-ai-ui";function Mi(e){window.__c={n:"CompletionPopup"};const{[Ii]:t}=e,o=(0,d.O7)(),n=(0,p.VK)((()=>M.default.state),[]);(0,_.w9)(n);const i=(0,a.useMemo)((()=>(0,_e.RR)(n)),[n]),r=(0,p.VK)((()=>i&&(0,_e.$b)(i)),[i]),l=(0,p.VK)((()=>o.device.isPhone),[o]);return i?t!==(null==r?void 0:r[Ii])?null:l?s()($n,{[Ii]:t,openState:i},void 0,s()(Zi,{openState:i})):s()(On,{[Ii]:t,openState:i},void 0,s()(Zi,{openState:i})):null}function Zi(e){window.__c={n:"PopupContent"};const{openState:t}=e,o=(0,d.O7)(),n=(0,w.useIntl)(),r=(0,a.useState)(function(e){switch(e[Pi]){case Ai:return"";case xi:return e.prompt??e.prefilledValue;case Si:return e.prefilledValue}}(t))[0],[D,F]=function(e){const t=(0,w.useIntl)(),[o,n]=(0,a.useState)("");return[(0,p.VK)((()=>{if("initialPromptForAIBlock"!==e[Pi]||!(0,I.dU)())return o;const n=e.store.getTitleValue();return(0,y.renderTextAsString)({intl:t,textValue:n,[ei]:e.store[ei],userTimeZone:(0,f.r)()})}),[o,t,e]),n]}(t),[L,B]=(0,a.useState)(!1),[O,K]=(0,a.useState)(!1),[H,V]=(0,a.useState)(""),U=(0,W.mY)(),z=(0,a.useRef)(null),$=(0,_e.rR)(t),J=(0,a.useMemo)((()=>({[Ci]:o,blocks:[],publicEditMode:void 0})),[o]);(0,_.lZ)(t);const N=(0,a.useCallback)((e=>{b.trackAICompletionPopupUpdatePromptText(o,{[bi]:t[ki],type:e.analyticsName,gtm_favorite_id:e.gtmFavoriteId}),F(e.insertText),S.maybeSetPromptForCurrentAiBlock(o,e.insertText),e.executeImmediately&&B(!0),z[wi]&&z[wi][hi]()}),[t[ki],o,F]),j="results"===t[Pi]?(0,I.xM)(t).completion:void 0,q=(0,v.Z_)(j,S.COMPLETION_THROTTLE,g.Z),Y="results"===t[Pi]?t:void 0,Q=(0,a.useMemo)((()=>{if(!Y||"textSelection"!==Y[yi].type&&"blockSelection"!==Y[yi].type)return;const{userSearchCache:e}=(0,I.xM)(Y);return q?l.Z.withListenerIgnored((()=>{const t=new c.Z({name:"CompletionPopup.PopupContent",isTemporaryData:!0}),n=x.createAndCommit({userAction:"CompletionPopup.temporarymarkdownToBlocks",[Ci]:o,canUndo:!1,perform:n=>{const i=C.markdownToBlocks({[Ci]:o,text:q,[gi]:t,transaction:n,markdownOptions:(0,E.N9)(e)});if(i)return S.postProcessAICreatedStores(o,i),C.wrapTemporaryBlocksInList({[Ci]:o,stores:i,[gi]:t,transaction:n})}}).performResult;return t.addCacheFallback(o.defaultRecordCache[gi]),n})):void 0}),[Y,q,o]),X=(0,p.VK)((()=>{if(!Q||!Y||"completionPopup"!==Y.type||"results"!==Y[Pi]||"textSelection"!==Y[yi].type&&"blockSelection"!==Y[yi].type)return;return Y[yi].stores.every((e=>{const t=e.getType();return!!t&&("blockSelection"===Y[yi].type?Boolean(I.d5[t]):"textSelection"===Y[yi].type&&Boolean(I.DD[t]))}))}),[Y,Q]);let ee=!0,te=!1;switch(t[Pi]){case Si:if(t.futureRevisions.length>0)break;case xi:ee=!1;break;case Ai:t.loading||"cursor"!==t[yi].type||""!==D||(te=!0);break;default:(0,h.unreachable)(t)}const oe=function(e){const{[Xn]:t,sessionId:o}=e,n=(0,a.useCallback)((e=>{let{exitType:n,selectInsertion:i}=e;const r=M.default.state;"completionPopup"!==r.type||"results"!==r.stage||r.loading||(b[Qn](t,{[Yn]:o,[qn]:(0,I.xM)(r)[jn],exit_type:n}),x[Wn]({[Nn]:"CompletionPopup.handleAccept",[Xn]:t,perform:e=>{S.acceptCursorCompletion({[Xn]:t,[Gn]:e,selectInsertion:i,exitType:n})}}))}),[t,o]),i=(0,a.useCallback)((()=>{const e=M.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||((0,_e.Tq)(t),b[Qn](t,{[Yn]:o,[qn]:(0,I.xM)(e)[jn],exit_type:"insert"}),"textSelection"===e[Jn].type?x[Wn]({[Nn]:"CompletionPopup.handleInsert",[Xn]:t,perform:e=>{S.insertTextSelectionCompletion({[Xn]:t,[Gn]:e})}}):"blockSelection"===e[Jn].type&&x[Wn]({[Nn]:"CompletionPopup.handleInsert",[Xn]:t,perform:e=>{S.insertBlockSelectionCompletion({[Xn]:t,[Gn]:e,replace:!1})}}))}),[t,o]),r=(0,a.useCallback)((()=>{const e=M.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||"textSelection"!==e[Jn].type&&"blockSelection"!==e[Jn].type||((0,_e.Tq)(t),b[Qn](t,{[Yn]:o,[qn]:(0,I.xM)(e)[jn],exit_type:"replace"}),"textSelection"===e[Jn].type?x[Wn]({[Nn]:"CompletionPopup.handleReplace",[Xn]:t,perform:e=>{S.replaceTextSelectionCompletion({[Xn]:t,[Gn]:e})}}):"blockSelection"===e[Jn].type&&x[Wn]({[Nn]:"CompletionPopup.handleReplace",[Xn]:t,perform:e=>{S.insertBlockSelectionCompletion({[Xn]:t,[Gn]:e,replace:!0})}}))}),[t,o]);return(0,a.useMemo)((()=>({onAccept:n,onInsert:i,onReplace:r})),[n,i,r])}({[Ci]:o,[ki]:t[ki]});(0,a.useEffect)((()=>{F(r),z[wi]&&z[wi][hi]()}),[r,F]);const ne="results"===t[Pi]&&t.hasErrored,ie=(0,v.D9)(ne),re=ne&&!ie,se=(0,a.useCallback)((e=>{const{purgeFromHistory:t}=e,i=S.revertCurrentCompletionRevision({[Ci]:o,purgeFromHistory:t});i&&"followup"===i.type&&(F(Sn(n,i.improvement)),z[wi]&&z[wi][hi]())}),[o,n,F]),ae=(0,a.useCallback)((()=>{"results"===t[Pi]&&(S.revertCurrentCompletionRevision({[Ci]:o,purgeFromHistory:!1}),z[wi]&&z[wi][hi]())}),[t,o]),le=(0,a.useCallback)((()=>{"results"===t[Pi]&&(S.redoCompletionRevision(o),z[wi]&&z[wi][hi]())}),[o,t]);(0,a.useEffect)((()=>{if(!re||"results"!==t[Pi])return;const{[ki]:e}=t;if((0,I.sr)(t))return void se({purgeFromHistory:!0});const n=(0,I.Iz)(t);S[vi](n)?(F(H),(0,R.jn)({[Ci]:o})):S.cancelCompletion({[Ci]:o,[ki]:e,[fi]:n[fi],exitType:"error_modal"})}),[o,re,t,H,se,F]);const ce=(0,a.useCallback)((()=>{if("results"!==t[Pi])return;const{[ki]:e}=t,n=(0,I.xM)(t);if((0,I.sr)(t))return b.trackAICompletionPopupRetry(o,{[bi]:e,[mi]:n[fi],is_reverting_follow_up_improvement:!0}),void se({purgeFromHistory:!1});b.trackAICompletionPopupRetry(o,{[bi]:e,[mi]:n[fi],is_reverting_follow_up_improvement:!1});const i=(0,I.Iz)(t);S[vi](i)?(F((0,I.gY)(i)),(0,R.jn)({[Ci]:o})):S.handleCompletionPopupRetry({[Ci]:o})}),[o,t,se,F]),ue=(0,a.useCallback)((()=>{if("results"!==t[Pi])return;if(!(0,I.xM)(t).completion)return(0,I.sr)(t)?void se({purgeFromHistory:!0}):(F(H),void(0,R.jn)({[Ci]:o}));S.stopCompletion(o)}),[t,o,se,H,F]),de=(0,a.useCallback)((()=>{K(!1),u.default.afterNextFlush((()=>{z[wi]&&z[wi][hi]()}))}),[]),pe=(0,a.useCallback)((()=>{switch(t[Pi]){case xi:b[pi](o,{[bi]:t[ki],[mi]:void 0,exit_type:"accept"}),(0,R.fz)();break;case Si:F(""),(0,R.sj)();break;case Ai:break;default:(0,h.unreachable)(t)}}),[t,o,F]),me=(0,a.useCallback)((e=>{switch((0,_e.Tq)(o),K(!1),t[Pi]){case Si:case xi:b[pi](o,{[bi]:t[ki],[mi]:void 0,exit_type:e}),(0,R.fz)();break;case Ai:S.cancelCompletion({[Ci]:o,[ki]:t[ki],[fi]:(0,I.xM)(t)[fi],exitType:e});break;default:(0,h.unreachable)(t)}}),[t,o]),fe=(0,a.useCallback)((()=>me("cancel")),[me]),ve=(0,a.useCallback)((()=>{"active"!==U.type?te?oe.onAccept({exitType:di,selectInsertion:!0}):ee?K(!0):me(ui):(0,W.bi)({state:U})}),[U,te,oe,me,ee]),ge=(0,p.VK)((()=>(0,I.dU)()),[]);(0,a.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${Ei}`)||e.closest(`.${P.defaultOverlayContainer}`)||e.closest(`.${P.link}`)||e.closest(`.${P.aiBlock}`)))}function t(t){ge||!e(t.target)&&e(t.relatedTarget)&&t.relatedTarget instanceof HTMLElement&&t.relatedTarget.focus()}function o(t){e(t.target)||("click"!==t.type&&"contextmenu"!==t.type||ve(),ge||(t.preventDefault(),t.stopPropagation()))}if(!O)return window[ci]("focus",t,!0),window[ci]("click",o,!0),window[ci]("contextmenu",o,!0),window[ci](li,o,!0),window[ci]("mouseup",o,!0),window[ci]("mouseover",o,!0),window[ci]("mouseout",o,!0),window[ci]("mouseenter",o,!0),window[ci]("mouseleave",o,!0),window[ci](ai,o,!0),()=>{window[si]("focus",t,!0),window[si]("click",o,!0),window[si]("contextmenu",o,!0),window[si](li,o,!0),window[si]("mouseup",o,!0),window[si]("mouseover",o,!0),window[si]("mouseout",o,!0),window[si]("mouseenter",o,!0),window[si]("mouseleave",o,!0),window[si](ai,o,!0)}}),[ve,O,ge]);const ye=(0,a.useCallback)((e=>{V(D),F(""),S.improveCompletion(o,e)}),[o,D,F]),he=(0,a.useCallback)((()=>{switch(t[Pi]){case Si:(0,R.sj)(),V(D),F(""),(0,k.Hh)({[Ci]:o,inputValue:D,from:t.from,mode:$});break;case xi:b[pi](o,{[bi]:t[ki],[mi]:void 0,exit_type:"accept"}),(0,R.fz)(),V(D),F(""),(0,k.F0)({[Ci]:o,inputValue:D,store:t.store});break;case Ai:ye({type:"helpMeEdit",prompt:D});break;default:(0,h.unreachable)(t)}}),[D,$,t,o,ye,F]);(0,a.useEffect)((()=>{L&&(B(!1),he())}),[L,he]);let we="insert";"results"===t[Pi]&&"cursor"===t[yi].type?we="accept":X&&(we="replace");const ke=(0,p.VK)((()=>t?Cn({[Ci]:o,intl:n,filter:D,state:t,from:t.from,favoriteEditingState:U,onUpdatePromptState:N,onImprove:ye,[yi]:J,completionResultInfo:{...oe,onRetry:ce,onSubmit:he,onCancel:fe,defaultAction:we}}):[]),[U,J,o,N,he,ye,D,n,t,oe,ce,fe,we]),be=ke.length>0,Ce=(0,a.useMemo)((()=>new Z.Z),[]);(0,a.useEffect)((()=>{Ce.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[D,Ce]);const Se=(0,p.VK)((()=>o.device.isPhone),[o]),xe=(0,m.yK)((e=>({mainPopup:{borderRadius:6,background:e[ri],boxShadow:e[ii],overflow:"hidden",isolation:"isolate"},menuPopup:{marginTop:4,marginBottom:4,borderRadius:6,background:e[ri],boxShadow:e[ii],width:Se?"100%":320,overflow:"hidden",isolation:"isolate"}})),[Se]),Ae=(0,a.useRef)(null);let Pe;"active"===U.type?Pe=a[ni]("div",{style:xe.menuPopup,ref:Ae,[oi]:Ei},s()(Ze,{[ki]:t[ki],state:U,[yi]:J})):be&&(Pe=a[ni](a.Fragment,null,a[ni]("div",{style:xe.menuPopup,ref:Ae,[oi]:Ei},s()(En,{sections:ke,onCloseParentMenu:pe,[yi]:J,[ti]:Ce})),s()(T.gl,{originRef:Ae,openState:t,isInputEmpty:!D})));const Ie=(0,a.useRef)(null),Ee=function(e){const{openState:t,undoRevision:o,redoRevision:n}=e,i=(0,d.O7)(),r=(0,w.useIntl)(),s=(0,p.VK)((()=>Te.default.checkGate("ai_multi_level_undo")),[]),l=(0,a.useCallback)((()=>{o(),Ve(i,"undo")}),[i,o]),c=(0,a.useCallback)((()=>{n(),Ve(i,"redo")}),[i,n]);if("results"!==t.stage||!s)return He;const u=t.revisions.length,m=t.futureRevisions.length,f=u+m,v=u;return 1===f?He:{onUndo:u>1?l:void 0,onRedo:m>0?c:void 0,historyLabel:r[De](Le.historyLabel,{currentRevision:v.toString(),totalRevisions:f.toString()})}}({openState:t,undoRevision:ae,redoRevision:le});return ge?a[ni](a.Fragment,null,s()(A.Z,{capture:!0,onEsc:ve}),Pe):a[ni](a.Fragment,null,s()(A.Z,{capture:!0,onEsc:ve}),Se&&Pe,s()(T.RD,{originRef:Ie,openState:t}),a[ni]("div",{ref:Ie,[oi]:Ei,style:xe.mainPopup},a[ni](bo,i()({state:t,onDismiss:ve,onCompletionRetry:ce,onCompletionStop:ue,query:D,setQuery:F,onSubmit:he,submitOnEnter:!be&&!O,inputRef:z,temporaryListStore:Q,favoriteEditingState:U},Ee))),!Se&&Pe,s()(G,{open:O,onConfirmExit:fe,onCancelExit:de}))}},91839:(e,t,o)=>{o.d(t,{Z:()=>c});var n=o(77094),i=o.n(n),r=(o(67294),o(5366));const s=o(85).lGm,a=o(85).nx5,l=o(85).Yzm;const c=function(e){let{style:t}=e;window.__c={n:"LoadingDots"};const o=(0,r.useIntl)();return i()("div",{"aria-valuetext":o[l]({id:"loadingDots.label",[a]:"Loading..."}),role:"progressbar",[s]:"loading-dots"},void 0,i()("div",{[s]:"loading-dot",style:{...t}}),i()("div",{[s]:"loading-dot",style:{...t}}),i()("div",{[s]:"loading-dot",style:{...t}}))}}}]);