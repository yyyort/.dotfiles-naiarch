"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8721],{8336:(e,t,n)=>{n.r(t),n.d(t,{AssistantChatStep:()=>i.H,AssistantLabelerBar:()=>ae,TopbarAssistantButton:()=>pe,UpdateSidebarTabAssistant:()=>ve.m,assistantActions:()=>a});var a=n(37507),i=n(54749),o=n(97464),l=n.n(o),r=n(77094),s=n.n(r),u=n(96486),c=n.n(u),d=n(67294),p=n(480),v=n(81954),f=n(24405),m=n(94568),h=n(42875),g=n(59054),y=n(21202),b=n(70203),w=n(82990),k=n(54642),S=n(98104),C=n(52275),V=n(88359),_=n(1743),A=n(74194),Z=n(84076),x=n(68785),T=n(63296),E=n(44532),K=n(14871),I=n(95477),P=n(5737),B=n(82375),q=n(39098),R=n(24666);const D=n(85).v1$,F=n(85).tBn,N=n(85).D7I,O=n(85).Dd5,H=n(85).pkR,L=n(85).PXg,M=n(85).BQ6,Q=n(85).PG2,U=n(85).v8Q,j=n(85).oAh,z=n(85).wgE,G=n(85).H90,W=n(85).v5U,X=n(85).JFE,$=n(85).mgi,Y=n(85).vYi,J=n(85).TtP,ee=n(85).dR6,te=n(85).Exd,ne=n(85).g7N;function ae(){window.__c={n:"AssistantLabelerBar"};const e=(0,p.O7)(),t=(0,f.yK)((e=>({wrap:{padding:8,backgroundColor:e.contentBackground,width:400},samplingPicker:{display:"flex",alignItems:"center",[ne]:8,gap:4},error:{[te]:14,color:e.accentColors.red[600],maxHeight:150,overflow:"scroll"},[ee]:{[te]:14,maxHeight:150,overflow:"scroll"},tooltip:{width:500,whiteSpace:"pre-wrap",fontFamily:w.Z.baseFontFamily.mono},input:{marginTop:5,[ne]:5,fontFamily:w.Z.baseFontFamily.githubMono,[te]:12},inputInner:{height:100}})),[]),n=(0,v.VK)((()=>B.Hl.state),[]),i=(0,v.VK)((()=>B.XN.state),[]),o=(0,v.VK)((()=>P.N.state),[]),l=(0,v.VK)((()=>Boolean(i&&i[Y][J]>0)),[i]),r=(0,v.VK)((()=>Boolean(o&&(o.sampling||o.evaluating))),[o]),u=(0,v.VK)((()=>null==i?void 0:i[$]),[i]),c=(0,v.VK)((()=>{const e=null==i?void 0:i[$];var t;if("number"==typeof e)return null==i||null===(t=i[Y])||void 0===t?void 0:t[e]}),[i],{[X]:!0}),m=(0,v.VK)((()=>(null==i?void 0:i[W])||[]),[i],{[X]:!0}),h=m.filter((e=>"error"===e[G])),g=m.filter((e=>"error"!==e[G])),y=(0,d.useCallback)((()=>{a.cancelPreviewStep()}),[]),b=(0,d.useCallback)((async t=>{if(!c||!i)return;const n={...c,value:t.target.value};(0,B.zZ)({store:B.XN,step:n}),await a.simulateOrCommitStep({[z]:e,step:n,commit:!1,isStreaming:!1,preventSelection:!0})}),[e,c,i]),k=(0,d.useCallback)((async t=>{i&&await a.simulateOrCommitStep({[z]:e,step:i[Y][t],commit:!1,isStreaming:!1})}),[e,i]),C=(0,d.useCallback)((async()=>{if(!i)return;const t=i[W][J]>0;await a[j]({[z]:e}),t||await a.applyUncommittedOperations({[z]:e})}),[e,i]),V=(0,d.useCallback)((async()=>{await a.retryNextAssistantSteps({[z]:e})}),[e]),Z=(0,v.VK)((()=>({top:20,left:0,right:0,bottom:0,width:e.WindowSizeStore.state.width,height:0})),[e],{[X]:!0}),[K,q]=(0,d.useState)(!1),D=(0,d.useCallback)((()=>{R.default.hasSelection()&&S.clear(e),q(!0)}),[e,q]),ae=(0,d.useCallback)((()=>{q(!1)}),[q]),oe=I.default.isLocalhost||"local"===I.default.env||"development"===I.default.env;return s()(E.ZP,{popupType:E.kQ.Popup,open:!0,originRect:Z,originGap:6,disableMouseCapture:!0,render:()=>s()(_.Z,{capture:K},void 0,s()("div",{[M]:t.wrap},void 0,s()(ie,{}),l&&d[N](d[F],null,s()("div",{[M]:t.samplingPicker},void 0,s()(T.Z,{[U]:void 0===u||void 0,[Q]:y},void 0,"Original"),s()(T.Z,{[U]:0===u||void 0,[Q]:()=>k(0)},void 0,"A"),s()(T.Z,{[U]:1===u||void 0,[Q]:()=>k(1)},void 0,"B"),s()("div",{[M]:{flexGrow:1}}),r&&s()(x.Z,{[M]:{[L]:4}}),s()(T.Z,{[H]:!oe&&(void 0===u||r||!n),disabledFeedback:!0,[Q]:V},void 0,"Retry"),s()(T.Z,{[H]:!oe&&(void 0===u||r||!n),disabledFeedback:!0,[Q]:C,isBlue:!0},void 0,"Accept")),c&&s()(A.Z,{[M]:t.input,inputStyle:t.inputInner,value:c.value,[O]:b,onFocus:D,onBlur:ae,textarea:!0,spellCheck:!1}),h[J]>0&&!r&&s()("div",{[M]:t.error},void 0,h.map((e=>e.value)).join("\n")),g[J]>0&&!r&&s()("div",{[M]:t[ee]},void 0,"Results: ",g.map((e=>e.value)).join("\n")))))})}function ie(e){var t;window.__c={n:"TaskPicker"};const n=(0,p.O7)(),a=(0,v.VK)((()=>B.Hl.state),[]),[i]=(0,g.r5)((async()=>{const e="results",t={type:"reducer",filter:{operator:"and",filters:[{property:"ouFf",filter:{operator:"status_is",value:{type:"is_group",value:"In progress"}}}]},sort:[],userId:n.currentUser.id,userTimeZone:(0,h.r)(),searchQuery:void 0,reducers:{[e]:{type:"results",limit:100}}},a=await k.queryCollection(n,{source:{type:"collection",id:"f704a995-6417-457a-8038-ca9e1cb2c65f",spaceId:m.vj},collectionView:{id:"1dee420b-aa96-4e48-8eba-c2a0613e179e",spaceId:m.vj},loader:t},void 0,{src:"queryCollectionAction"});if("failed"===a.type)return;const i=a.data.result.reducerResults.results;if(!i||"results"!==i.type)return;const{blockIds:o}=i;let l=c().compact(o.map((e=>new q.G(n,{table:y.iU,id:e}).getValue()))).map((e=>{var t,n,a;return{id:e.id,name:(0,b.getText)(null==e||null===(t=e[D])||void 0===t?void 0:t.title),url:(0,b.getText)(null==e||null===(n=e[D])||void 0===n?void 0:n["}v_K"]),type:(0,b.getText)(null==e||null===(a=e[D])||void 0===a?void 0:a.pdfW)}}));return l=c().sortBy(l,(e=>e.name.toLowerCase())),l}),[n]),o=(0,d.useCallback)((e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e));n&&B.Hl.setState(n)}),[i]),r={menuTitle:"",items:(null===(t=i.value)||void 0===t?void 0:t.map((e=>e.id)))??[],getKey:e=>e,selectedItem:null==a?void 0:a.id,onSelect:o,renderItem:e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e.value));return d[N](C.Z,l()({},e,{title:null==n?void 0:n.name}))},renderOrigin:e=>d[N](V.Z,l()({focused:!1,title:"",right:(null==a?void 0:a.name)||s()("span",{[M]:{color:"red"}},void 0,"Please select a task")},e)),width:300},u=(0,f.yK)((e=>({wrap:{[ne]:8},inner:{display:"flex",alignItems:"center",[ne]:4,gap:4},label:{[te]:14,flexShrink:0},link:{[te]:14,textDecoration:"underline"}})),[]);return s()("div",{[M]:u.wrap},void 0,s()("div",{[M]:u.inner},void 0,s()("div",{[M]:u.label},void 0,"Current task:"),d[N](K.Z,r)),a&&s()(Z.Z,{[M]:u.link,href:a.url,external:!0},void 0,"Instructions for task"))}var oe=n(3909),le=n(74647),re=n(73063),se=n(43250),ue=n(34700),ce=n(45094),de=n(7011);function pe(e){window.__c={n:"TopbarAssistantButton"};const{blockStore:t}=e,n=(0,p.O7)(),{isElectronMac:a}=n.device,i=(0,f.yK)((e=>({icon:{height:20,width:20,fill:e.aiPurpleColor},button:{...(0,ue.X)(a,!1),width:33,height:28,marginRight:2}})),[a]),o=(0,d.useCallback)((()=>{le.handleSidebarButtonClick(n,t,de.gY.Assistant,"topbar")}),[n,t]),l=(0,v.VK)((()=>(0,ce.updateSidebarIsExpanded)(n)&&de.ZP.state.currentTab===de.gY.Assistant),[n]);return s()(re.Z,{icon:oe.Z.sparkles,iconStyle:i.icon,style:i.button,ariaLabel:"Assistant",className:se.topbarAssistantButton,onClick:o,hovered:l})}var ve=n(2122)},47240:(e,t,n)=>{n.d(t,{Z:()=>M});var a=n(77094),i=n.n(a),o=n(67294),l=n(81954),r=n(24405),s=n(80951),u=n(14215),c=n(67266),d=n.n(c),p=n(96486),v=n.n(p),f=n(5242),m=n.n(f),h=n(15095),g=n(70203),y=n(97880);const b=n(85).vcv,w=n(85).n9p,k=n(85).sNz,S=n(85).upK,C=n(85).R_r,V=n(85).gl5,_=n(85)._S$,A=n(85).z5A;let Z;function x(e){const{before:t,after:n}=e,a={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},i=e=>{const t=a.encoding[e];if(t)return t;{const t=String[A](a.count);return a.count++,a.encoding[e]=t,a.decoding[t]=e,t}},o=e=>{const t=d()(e),n=a.annotationEncoding[t];if(n)return n;{const n=String[A](a.count);return a.count++,a.annotationEncoding[t]=n,a.annotationDecoding[n]=e,n}},l=e=>v().flatten(g.getTokens(e).map((e=>{const t=h[_](e[0]).map(i);if(g.isMentionToken(e)){const n=g[V](e),a=g.findMentionAnnotation(n);a&&(t[0]=o({type:"mention",value:a}),n.forEach((e=>{g[C](e)||g.isEquationAnnotation(e)||g[S](e)||(t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e})))})))}else if(g.isEquationToken(e)){const n=g[V](e),a=g.findEquationAnnotation(n);if(a){t[0]=o({type:"equation",value:a});for(const e of n)g[C](e)||g.isEquationAnnotation(e)||g[S](e)||(t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e})))}}else if(g.isAnnotatedTextToken(e)){g[V](e).forEach((e=>{t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e}))}))}return t}))).join("");if(a.count>65535)throw new Error("This string has way too many different characters.");const r=function(e,t){const n=new(m())({timeout:2,editCost:6}),a=n.main(t,e);return n.cleanupSemantic(a),a}(l(n),l(t)),s=[];let u=[];return r.forEach((e=>{let[t,n]=e;n.split("").forEach((e=>{if(a.decoding[e]){const n=a.decoding[e];t===Z.added?s.push([n,[...u,["+"]]]):t===Z.removed?s.push([n,[...u,["-"]]]):t===Z.same&&s.push([n,u])}else{const n=a.annotationDecoding[e];if(t===Z.added)if("mention"===n.type)s.push([g[k],[...u,["+"],n.value]]);else if("start"===n.type)u=[...u,n.value];else if("end"===n.type)u=u.filter((e=>!v().isEqual(e,n.value)));else if("equation"===n.type){const e=g[w](n.value),t=g[b](e,[...u,["+"]]);s.push(t)}else(0,y.unreachable)(n);else if(t===Z.removed){if("mention"===n.type)s.push([g[k],[...u,["-"],n.value]]);else if("equation"===n.type){const e=g[w](n.value),t=g[b](e,[...u,["-"]]);s.push(t)}}else if(t===Z.same)if("mention"===n.type)s.push([g[k],[...u,n.value]]);else if("start"===n.type)u=[...u,n.value];else if("end"===n.type)u=u.filter((e=>!v().isEqual(e,n.value)));else if("equation"===n.type){const e=g[w](n.value),t=g[b](e,u);s.push(t)}else(0,y.unreachable)(n)}}))})),g.normalizeTextValue(s)}!function(e){e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same"}(Z||(Z={}));var T=n(3909),E=n(21202),K=n(39098),I=n(63867);const P=n(85).L_E,B=n(85).nSw,q=n(85).aqg,R=n(85).lsv,D=n(85).Ql2,F=n(85).CNJ,N=n(85).biQ,O=n(85).xa7,H=n(85).D7I,L=n(85).OBh;function M(e){const t=e[L].type;switch(t){case"title":case"text":return o[H](Q,e);case"relation":return i()(U,{[L]:e[L],beforeValue:e.beforeValue,afterValue:e.afterValue,[O]:e[O]});case"checkbox":case"number":case"person":case"file":case"url":case"email":case"phone_number":case"created_time":case"created_by":case"last_edited_time":case"last_edited_by":case N:case"formula":case"rollup":case"select":case"multi_select":case"date":case"button":case"status":case F:case"location":case"verification":return o[H](j,e);default:(0,y.unreachable)(t)}}function Q(e){const t={value:x({before:e.beforeValue.value,after:e.afterValue.value}),[D]:e.beforeValue[D]};return i()(I.Z,{value:t,[L]:e[L],[O]:e[O]})}function U(e){window.__c={n:"RelationPropertyDiff"};const{beforeValue:t,afterValue:n,[L]:a,[O]:o}=e,r=(0,l.VK)((()=>{const e=(0,s.toRelationValueAsPointers)(t.value),i=(0,s.toRelationValueAsPointers)(n.value),l=(0,u.N)(e,i,(e=>`${e.id}${e.table}`)),r=new Set(s[R]({[q]:l.created,[B]:o[B],[L]:a})),c=new Set(s[R]({[q]:l.deleted,[B]:o[B],[L]:a})),d=[...r,...c];return d.flatMap(((e,t)=>{const n=K.G.createChildStore(o,{table:E.iU,id:e.id}).getPropertyValue("title")||[],a=[],i=g.getTokens(n);for(const o of i)if(g.isStringToken(o)){const t=r.has(e)?"+":"-",n=[o[0],[[t]]];a.push(n)}else a.push(o);return t<d.length-1&&a.push(g.createToken("\n")),a}))}),[t,n,a,o]);return i()(I.Z,{value:{value:r,[D]:t[D]},[L]:{type:"title",name:"Title"},[O]:o})}function j(e){window.__c={n:"ArrowPropertyDiff"};const t=(0,r.yK)((()=>({arrowDiffWrap:{display:"inline-flex",alignItems:"center"}})),[]);return i()("div",{style:t.arrowDiffWrap},void 0,i()(I.Z,{value:e.beforeValue,[L]:e[L],[O]:e[O]}),i()(z,{}),i()(I.Z,{value:e.afterValue,[L]:e[L],[O]:e[O]}))}function z(){window.__c={n:"Arrow"};const e=(0,r.yK)((e=>({[P]:{padding:"0px 8px"},icon:{width:15,height:15,fill:e.mediumIconColor}})),[]);return i()("div",{style:e[P]},void 0,T.Z.arrowRightSmaller(e.icon))}}}]);