(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3878],{98025:(e,r,n)=>{"use strict";n.r(r),n.d(r,{formulaToString:()=>p});var t=n(81602),o=n(82293),i=n(63143),a=n(91905);const s=n(85).XU;function p(e,r){if(!e)return"";const n=d(e,r);if(!n)return"";const t=n.toString({parenthesis:"auto"});return t.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\t/g,"\\t")}const u=t.U(o.$),c=(0,i.mapValues)(a._G,(e=>e.value)),l=(0,i.mapValues)(a.Gn,(e=>e.apply)),f=(0,i.mapValues)(a.wk,(e=>e.apply));function d(e,r){if(!e)return u[s];if("conditional"===e.type)return new u.ConditionalNode(d(e.condition,r),d(e.true,r),d(e.false,r));if("constant"===e.type){const r="number"===e.value_type?parseFloat(e.value):"boolean"===e.value_type?e.value||"true"===e.value:e.value;return new u.ConstantNode(r)}if("function"===e.type)return new u.FunctionNode(new u.SymbolNode(e.name),(e.args||[]).map((e=>d(e,r))).filter((e=>void 0!==e)));if("operator"===e.type)return new u.OperatorNode(e.operator,e.name,(e.args||[]).map((e=>d(e,r))).filter((e=>void 0!==e)));if("property"===e.type){const n=r[e.id],t=n?n.name:e.name;return new u.FunctionNode("prop",[new u.ConstantNode(t)])}return"symbol"===e.type?new u.SymbolNode(e.name):u[s]}u.import(c,{override:!0}),u.import(l,{override:!0}),u.import(f,{override:!0})},63235:(e,r,n)=>{"use strict";n.r(r),n.d(r,{stringToFormula:()=>E});var t=n(96486),o=n.n(t),i=n(81602),a=n(82293),s=n(99036),p=n(7406);const u=n(85).nx5,c=n(85).Yzm,l=n(85).cRc,f=/(.+) \(char (\d+)\)/,d=[{regex:/Syntax error in part (.+)$/,[l]:(e,r)=>e[c]({id:"mathParseHelpers.syntax.error",[u]:"Syntax error in part {token}"},{token:r})},{regex:/End of (?:matrix|string) ([\]\"\']) expected/,[l]:(e,r)=>e[c]({id:"mathParseHelpers.tokenExpected.error",[u]:"{token} expected"},{token:r})},{regex:/Parenthesis ([\)\]]) expected/,[l]:(e,r)=>e[c]({id:"mathParseHelpers.tokenExpected.error",[u]:"{token} expected"},{token:r})},{regex:/Unexpected (?:operator|part) (.+)$/,[l]:(e,r)=>e[c]({id:"mathParseHelpers.unexpected.error",[u]:"Unexpected {token}"},{token:r})},{regex:/Unexpected end of expression$/,[l]:(e,r)=>e[c]({id:"mathParseHelpers.unexpectedEndOfExpression.error",[u]:"Unexpected end of expression"})}];var m=n(18955),y=n(91905),g=n(98025);const N=n(85).dPh,x=n(85).aUQ,h=n(85).bEF,v=n(85).bcz,z=n(85).TtP,P=n(85).bF2,H=n(85).nx5,S=n(85).Yzm,T=n(85).o8N,b=n(85).MWD,k=n(85).SPm,A=n(85).Kiu,F=n(85).ffk,D=i.U(a.$);function E(e){const{str:r,[F]:n,[A]:t,intl:o,propertyTypeDisplayName:i}=e;if(""===r.trim())return;let a;try{a=D.parse(r)}catch(s){const{[k]:e}=(0,p.tg)(s),r=function(e,r){const n=f.exec(r);if(!n)return r;let t=n[1];const o=n[2],i=o?e[c]({id:"mathParseHelpers.errorPosition.message",[u]:"char {position}"},{position:o}):"";return d.forEach((r=>{let{regex:n,[l]:o}=r;if(t.match(n)){const r=n.exec(t);if(r){const n=r[1];t=o(e,n)}}})),e[c]({id:"mathParseHelpers.fullError.message",[u]:"{errorBody} ({postfix})"},{errorBody:t,postfix:i})}(o,e);return{[b]:T,[k]:r,size:1}}return U(o,a,n,t,i)}function U(e,r,n,t,i){if(r){if("AccessorNode"===r[b]||"ArrayNode"===r[b]||"AssignmentNode"===r[b]||"BlockNode"===r[b]||"FunctionAssignmentNode"===r[b]||"IndexNode"===r[b]||"ObjectNode"===r[b]||"RangeNode"===r[b])return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.invalidSyntax",[H]:"Invalid syntax: {input}"},{input:r.toString()})};if("ConditionalNode"===r[b]){const o=U(e,r.condition,n,t,i),a=U(e,r.trueExpr,n,t,i),s=U(e,r.falseExpr,n,t,i);if(!o)return;if("error"===o[b])return o;if(a&&"error"===a[b])return a;if(s&&"error"===s[b])return s;if(a&&s)return a[P]!==s[P]?{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.branchCondition",[H]:"Each branch of a condition must be of the same type: {input}"},{input:r.toString()})}:{[b]:"conditional",[P]:a[P],condition:o,true:a,false:s}}else{if("ConstantNode"===r[b]){const{value:n}=r,t=typeof n,o={string:"text",number:"number",boolean:"checkbox"};return t in o?{[b]:"constant",[P]:o[t],value:n,value_type:t}:{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.illegalConstant",[H]:"Illegal constant: {value}"},{value:n})}}if("FunctionNode"===r[b]){const{fn:a,args:p}=r;if("prop"===a.name){if(1!==p[z])return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.tooManyArgumentsInProp",[H]:"Too many arguments passed to prop()."})};const r=p[0];if("ConstantNode"!==r[b])return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.invalidPropertyReference",[H]:"Invalid property reference: {input}"},{input:r.toString()})};const o=r.value,i=Object.keys(t).find((e=>{const r=t[e];return Boolean(r&&r.name===o)})),a=i&&t[i];if(!i||!a)return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.propertyNotFound",[H]:"Property not found: prop({input})"},{input:o})};if(s.UNSUPPORTED_FORMULA_PROPERTY_TYPES.includes(a[b]))return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.propertyNotSupported",[H]:"Property not supported: prop({propertySchemaName})"},{propertySchemaName:a.name})};if("formula"===a[b]){const{formula:r}=a;if(!r||!r[P])return;return(0,m.ks)(r).includes(n)?{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.circularDependency",[H]:"Property {propertySchemaName} creates a circular dependency."},{propertySchemaName:a.name})}:{[b]:F,[P]:(0,m.z6)(a),name:o,id:i}}return{[b]:F,[P]:(0,m.z6)(a),name:o,id:i}}const u=y.uf(a.name)||y.aV(a.name);if(!u)return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.undefinedFunction",[H]:"Undefined function: {functionName}"},{[v]:a.name})};const c=o().compact((p||[]).map((r=>U(e,r,n,t,i)))),l=w({intl:e,[v]:a.name,functionArgs:c,[h]:u[h],[A]:t,propertyTypeDisplayName:i});if(l[T])return l[T];const f=l.value;return{[b]:"function",[P]:f[x],name:a.name,args:c}}if("OperatorNode"===r[b]){const{op:a,fn:s,args:p}=r,u=y.aV(s);if(!u)return{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.undefinedOperator",[H]:"Undefined operator: {operator}"},{operator:a})};const c=o().compact((p||[]).map((r=>U(e,r,n,t,i)))),l=w({intl:e,[v]:s,functionArgs:c,[h]:u[h],[A]:t,propertyTypeDisplayName:i});if(l[T])return l[T];const f=l.value;return{[b]:"operator",[P]:f[x],operator:a,name:s,args:c}}if("ParenthesisNode"===r[b])return U(e,r.content,n,t,i);if("SymbolNode"===r[b]){const{name:n}=r;return n in y._G?{[b]:"symbol",[P]:y._G[n][x],name:n}:{[b]:T,size:1,[k]:e[S]({id:"formulaHelpers.error.undefinedConstant",[H]:"Undefined constant: {constantName}"},{constantName:n})}}}}}function w(e){const{intl:r,[v]:n,functionArgs:t,[h]:i,[A]:a,propertyTypeDisplayName:s}=e;return i.reduce(((e,i)=>{if(!e[T])return e;const p=function(e){const{intl:r,[v]:n,functionArgs:t,signature:i,[A]:a,propertyTypeDisplayName:s}=e,{arity:p,variadic:u}=i;if(u){if(!(t[z]>0))return{[b]:T,size:1,[k]:r[S]({id:"formulaHelpers.error.tooFewArgumentsVariadic",[H]:N},{[v]:n})};{const e=o().compact(t.map((e=>C({intl:r,[x]:u,functionArg:e,[A]:a,propertyTypeDisplayName:s}))));if(e[z]>0)return{...e[0],size:e[z]}}}if(p){if(t[z]<p[z])return{[b]:T,size:1,[k]:r[S]({id:"formulaHelpers.error.tooFewArguments",[H]:N},{[v]:n})};if(t[z]>p[z])return{[b]:T,size:1,[k]:r[S]({id:"formulaHelpers.error.tooManyArguments",[H]:"Too many arguments in function {functionName}"},{[v]:n})};const e=o().compact(t.map(((e,n)=>C({intl:r,[x]:p[n],functionArg:e,[A]:a,propertyTypeDisplayName:s}))));if(e[z]>0)return{...e[0],size:e[z]}}}({intl:r,[v]:n,functionArgs:t,signature:i,[A]:a,propertyTypeDisplayName:s});return p?e[T].size<p.size?e:{[T]:p}:{value:i}}),{[T]:{[b]:T,size:99,[k]:r[S]({id:"formulaHelpers.error.noSignatureForFunction",[H]:"No signatures found for function: {functionName}"},{[v]:n})}})}function C(e){const{intl:r,[x]:n,functionArg:t,[A]:o,propertyTypeDisplayName:i}=e;if("error"===t[b])return t;if(n!==t[P]){const e=(0,g.formulaToString)(t,o);return{[b]:T,size:1,[k]:r[S]({id:"formulaHelpers.error.typeMismatch",[H]:"Type mismatch {nodeString} is not a {localizedPropertyTypeDisplayName}."},{nodeString:e,localizedPropertyTypeDisplayName:n?i[n]:r[S]({id:"formatMessage.error.undefinedResultType",[H]:"undefined"})})}}}},75042:()=>{}}]);