"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[105],{88625:(e,t,o)=>{o.r(t),o.d(t,{SpaceSubscriptionUpdatePaymentMethodModal:()=>W});var i=o(77094),n=o.n(i),r=o(86664),a=o(67294),d=o(480),s=o(81954),p=o(24405),c=o(8848),u=o(59730),l=o(97880),m=o(82990),g=o(5366),b=o(47307),y=o(21325),h=o(16100),f=o(21115),v=o(79315),C=o(45407),S=o(42922),P=o(63296),w=o(64369);const M=o(85).UPJ,B=o(85).FPZ,k=(o(85).Jym,o(85).Q1_),_=o(85).PG2,x=o(85).tuH,U=o(85).BQ6,E=o(85).qpZ,F=o(85).L_E,q=o(85).iG4,R=o(85).IO3,Z=o(85).EKt,T=o(85).tHG,G=o(85).Wqi,O=o(85).wgE,A=o(85).nx5,I=o(85).Kc7,D=o(85).D7I;function W(e){return n()(r.Elements,{stripe:(0,h.getStripe)()},void 0,a[D](K,e))}function K(e){window.__c={n:"SpaceSubscriptionUpdatePaymentMethodModalStripeConsumer"};const[t,o,i]=(0,s.AF)(void 0,C.Z),c=(0,r.useStripe)(),m=(0,r.useElements)(),[y,h]=a.useState(!1),[v,M]=a.useState(void 0),D=(0,d.O7)(),W=(0,g.useIntl)(),K=a.useCallback(((e,n)=>{t.paymentRequest||(o({...t,paymentRequest:e,supportsApplePay:Boolean(n&&n.applePay)}),i.addPaymentOption(I))}),[o,i,t]);a.useEffect((()=>{if(c){const t=c.paymentRequest({country:"US",currency:"usd",total:{label:W.formatMessage({id:"spaceSubscriptionUpdatePaymentMethod.applePay.total.label",[A]:"Notion - You will be charged on a recurring basis"}),amount:0}});t.canMakePayment().then((e=>{e&&K(t,e)})),t.on("token",(t=>{N({[O]:D,[G]:e[G],[T]:t.token.id,[Z]:e[Z],[R]:o=>{t.complete(o?"success":"fail"),e[R]()}})}))}}),[c,e,W,D,K]);const J=f.getPaymentMethodOptions(t[q]),Q=(0,p.yK)(H,[]);return y?n()("div",{[U]:Q[F]},void 0,n()("div",{[U]:Q[E]},void 0,n()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.update.header",[A]:"Update credit card"})),n()("div",{[U]:Q.cardContainer},void 0,n()(r.CardElement,{options:{hidePostalCode:!0}})),v&&n()(w.Z,{isMultiline:!1,[U]:Q.error},void 0,v),n()("div",{[U]:Q.upgradeButtonContainer},void 0,n()(S.Z,{[U]:Q[x],[_]:()=>async function(e){const{stripe:t,elements:o,[O]:i,[G]:n,[Z]:a,[R]:d,setError:s}=e;if(!t||!o)return;const p=o.getElement(r.CardElement);if(!p)return;const c=await t.createToken(p);!c.error&&c.token?await N({[O]:i,[G]:n,[T]:c.token.id,[Z]:a,[R]:d}):c.error&&s(c.error.message)}({stripe:c,elements:m,[O]:D,[G]:e[G],[Z]:e[Z],[R]:e[R],setError:M})},void 0,n()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.updateButton",[A]:"Update"})))):n()("div",{[U]:Q[F]},void 0,n()("div",{[U]:Q[E]},void 0,n()(g.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.update.header",[A]:"Update payment method"})),n()("div",{[U]:Q.optionGroup},void 0,J.map(((o,i)=>{let{type:r,title:a}=o;return n()("div",{[_]:()=>async function(e){const{[Z]:t,newPaymentMethod:o,setCreditCardSelected:i,paymentRequest:r}=e;if("credit_card"===o){if(t.isSubscribed&&"send_invoice"===t.billing){if(!(await b.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{[A]:"Update to automatic billing?",id:"spaceSubscriptionUpdatePaymentMethod.invoiceToCreditCard.confirmMessage"})),description:n()("span",{},void 0,n()(g.FormattedMessage,{[A]:"Your credit card will be charged automatically for future billing events. Invoices will no longer be sent to your billing email, but can be found in the Billing section of your Notion dashboard.",id:"spaceSubscriptionUpdatePaymentMethod.invoiceToCreditCard.confirmDescription"}))})))return}i(!0)}else{if("invoice"===o)throw new u.XV(B,{type:"collection_method_not_allowed"});"native_payment_platform"===o?r&&r.show():(0,l.unreachable)(o)}}({[Z]:e[Z],newPaymentMethod:r,paymentRequest:t.paymentRequest,setCreditCardSelected:h})},r,n()(P.Z,{[U]:{...Q[k],...i!==J.length-1?Q.optionBorder:void 0}},void 0,a))}))))}async function N(e){const{[O]:t,[G]:o,[T]:i,[Z]:n,[R]:r}=e,{currentUserStore:a}=v.default.state,d=null!=a&&a.isDefined()?a.getEmail():void 0,s=n.billingEmail||d;if(!s)throw new Error("No billing email found.");try{await y.updateSubscription({[O]:t,[G]:o,paymentData:{type:T,value:i},billingEmail:s,from:"space_settings-billing_tab-update_credit_card"}),r(!0)}catch{r(!1)}}function H(e){return{[F]:{width:500,background:e.popoverBackground,padding:30,borderRadius:3},optionGroup:{borderRadius:"2px",background:e.groupedFormBackground,border:"1px solid",borderColor:e.groupedFormBorder},[k]:{display:"flex",[M]:"flex-start",border:"none",height:void 0,paddingTop:"15px",paddingBottom:"15px"},optionBorder:{borderBottom:"1px solid",borderBottomColor:e.groupedFormBorder},[E]:{fontSize:18,marginBottom:16,fontWeight:m.Z.fontWeight.medium},cardContainer:{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBackground,padding:"10px",marginTop:"10px",marginBottom:"10px"},upgradeButtonContainer:{width:"100%",[M]:"flex-end",display:"flex"},[x]:{marginTop:"20px"},error:{marginTop:8,color:c.ZP.red}}}},45407:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(96486),n=o.n(i),r=o(49085);const a=o(85).iG4;class d extends r.default{getInitialState(){return{[a]:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state[a].includes(e)}addPaymentOption(e){const t=n().uniq([...this.state[a],e]);this.setState({...this.state,[a]:t})}}const s=d}}]);