"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6550],{43568:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(77094),i=a.n(n),o=a(67294),r=a(24405),d=a(36596);const l=a(85).vvq,s=a(85).XEN;function p(e){let{paragraphs:t}=e;window.__c={n:"LoadingShimmerArray"};const a=(0,r.yK)((e=>({skeletonRect:{borderRadius:3,backgroundColor:e.lightDividerColor}})),[]),n=null==t?void 0:t.map(((e,t)=>{const n={height:e.lineHeight,marginTop:e.lineMargin,marginBottom:e.lineMargin},r={marginTop:e[s],marginBottom:e[s]},p=[...Array(e.repeat||1)].map(((t,o)=>i()("div",{style:r},o,e[l].map(((e,t)=>i()(d.Z,{style:{...a.skeletonRect,...n,width:`${e}%`}},t))))));return i()(o.Fragment,{},t," ",p," ")}));return o.createElement(o.Fragment,null," ",n," ")}},69832:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Vt});var n={};a.r(n),a.d(n,{closeModal:()=>te,handleClaimAndUpgrade:()=>ae,handleNonNativeUpgrade:()=>ne,handleUpgradeClick:()=>ie,optionalPaymentMethodIdGivenPaymentData:()=>ee,optionalStripeTokenGivenPaymentData:()=>X,showClaimAndUpgradeToast:()=>de,updateCostForSpaceUpgradeToEnterprise:()=>oe,updateCosts:()=>re,validateAddress:()=>le});var i=a(77094),o=a.n(i),r=a(86664),d=a(67294),l=a(480),s=a(81954),p=a(24405),c=a(8848),u=a(3909),m=a(5366),g=a(50906),y=a(19234),v=a(65917),h=a(52692),S=a(16100),f=a(62216),b=a(21115),C=a(52975),w=a(54642),Z=a(47307),I=a(92625),A=a(64964),M=a(65544);const x=a(85).P0O,U=a(85).xe$,_=a(85).lc,k=a(85).pvH,O=a(85).HNo,D=a(85).JRG,F=a(85).LCb,E=a(85).cBF,B=a(85).BjC,N=a(85).Yzm,T=a(85).Wp_,P=a(85).yBN,q=a(85).t3R,L=a(85).eoM,V=a(85).mHq,W=a(85).o8N,z=a(85).aTq,H=a(85).jp1,K=a(85).bIZ,G=a(85).Ww0,R=a(85).D08,$=a(85).d9C,j=a(85).IE_,Q=a(85).wgE,Y=a(85).nx5,J=(0,m.defineMessages)({loading:{[Y]:"Claiming and upgrading workspace...",id:"spaceSubscriptionUpgradeModal.upgradeTargetSpace.loading"}});function X(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function ee(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}function te(e){const{[Q]:t}=e;C.Z.reset(),g.trackSubscriptionUpgradeModalDismissed(t)}async function ae(e){const{[Q]:t,data:a,requestingSpaceId:n,paymentData:i}=e,o=C.Z.state;if(!o.open)return;const r=o.targetPlan;if(!r)return;const d=o[j];I.display({message:J.loading});const l=o[$].id,s=await w.claimAndUpgradeSpace(t,{requestingSpaceId:n,targetSpaceId:l,targetPlan:r,stripeToken:X(i),[R]:ee(i),customerName:d.name,businessName:d.businessName,addressLine1:d.addressLine1,addressCity:d.city,addressZip:d.zipCode,addressState:d.state,addressCountry:d.country,vatId:o.vatApplicable?o.temporaryVatCode:void 0});var p,c,u;(I.close(),"success"===s.type)?(C.Z.closeWithSuccess(),de(o[$].name),g.trackSpaceClaimUpgradeCompleted(t,{previousOwners:o[$].admins.map((e=>e.id)),newOwners:t.currentUser.id?[t.currentUser.id]:[],targetSpaceId:l,verifiedDomain:o[$].creatorEmailDomain,[G]:o[$][G],costForUpgrade:null===(p=o[K])||void 0===p?void 0:p.amount,[H]:null===(c=o[K])||void 0===c?void 0:c[H],currentPlan:null===(u=b[z](a))||void 0===u?void 0:u.plan,targetPlan:r})):(Z.showError(s),te({[Q]:t}))}async function ne(e){const{[Q]:t,state:a,data:n,requestingSpaceId:i,stripe:o,elements:r,intl:d}=e;if(!r||!o)return void v.log({level:W,from:V,type:"StripeError",[W]:{miscDataString:L}});let l=a.paymentData;if(!l){const{[W]:e}=await r.submit();if(e)return g[q](t,{[W]:"could not submit form",error_type:P}),void C.Z[T]({...a,[W]:d[N]({id:B,[Y]:E})});const n=await o.createPaymentMethod({elements:r});if(n[W])return g[q](t,{[W]:n[W].message,error_type:P}),void C.Z[T]({...a,[W]:S.translateStripeError(t,d,n[W])});if(!n.paymentMethod)return g[q](t,{[W]:"could not create token",error_type:P}),void C.Z[T]({...a,[W]:d[N]({id:B,[Y]:E})});l={type:R,value:n.paymentMethod.id},C.Z[T]({...a,paymentData:l})}await ae({[Q]:t,data:n,requestingSpaceId:i,paymentData:l})}async function ie(e){const{[Q]:t,state:a,data:n,requestingSpaceId:i,stripe:o,elements:r,intl:d,paymentOptionAvailabilityStore:l}=e,s=a[F];g.trackUpgradeSubscriptionClick(t,{paymentMethod:s});const p=l.state.paymentRequest;if("native_payment_platform"===s&&p)return void p.show();C.Z.update((e=>({...e,[D]:"disabled"})));le({[Q]:t,state:a,intl:d})&&await ne({[Q]:t,state:a,data:n,requestingSpaceId:i,stripe:o,elements:r,intl:d});const c=C.Z.state;c.open&&C.Z[T]({...c,[D]:"enabled"})}async function oe(e){const{requestingSpaceId:t,[Q]:a,state:n}=e;C.Z.update((e=>({...e,[K]:void 0,[D]:"disabled"})));const i=n[$].isActorInSpace?n[$][G]:n[$][G]+1,o=b.getCurrentFormBillingInterval(n[O]),r=await w.getCostForSpaceUpgrade(a,{targetSpaceId:n[$].id,requestingSpaceId:t,subscriptionTier:"enterprise",billingInterval:o,[G]:i});if("failed"===r.type)Z.showError(r),C.Z.close();else{const e=r.data?h.n.fromValue({amount:r.data.totalCost,[H]:r.data[H]}).zeroIfNegative():void 0;C.Z.update((t=>({...t,[K]:e,targetPlan:r.data.targetPlan,[D]:"enabled"})))}}async function re(e){const{[Q]:t,spaceId:a,state:n}=e;await oe({requestingSpaceId:a,[Q]:t,state:n}),await M.l_(t)}function de(e){A.oV({label:o()(m.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.toast",[Y]:"Successfully claimed “{spaceName}“",values:{spaceName:e}})})}function le(e){const{[Q]:t,intl:a,state:n}=e;if(!f.isCheckoutAddressEnabled())return!0;let i;return n[j].country?"address_resolution_failed"!==n.taxCalculationError&&(0,y.A)(n[j])||(i=a[N]({id:U,[Y]:x})):i=a[N]({id:k,[Y]:_}),i&&(C.Z[T]({...n,[W]:i}),g[q](t,{[W]:void 0,error_type:"address"})),void 0===i}var se=a(43250),pe=a(34859),ce=a(79315),ue=a(88632),me=a(45407),ge=a(27242),ye=a(30751),ve=a(36488),he=a(53953),Se=a(18647),fe=a(29683),be=a(10644),Ce=a(26096),we=a(58025),Ze=a(65734),Ie=a(96486),Ae=a(8323),Me=a(38479),xe=a(37030),Ue=a(48209),_e=a(94699);const ke=a(85).nx5,Oe=a(85).num,De=a(85).JRG,Fe=a(85).LCb;function Ee(e){window.__c={n:"ClaimAndUpgradeBillingInfoForm"};const{paymentMethods:t}=e,a=(0,l.O7)(),n=(0,Me.y)(),i=(0,d.useMemo)((()=>(0,Ie.debounce)((async()=>{await M.l_(a)}),3e3)),[a]),[r,p,c,u,g,y,v]=(0,s.VK)((()=>{let e,t,a,n,i=!1;const{state:o}=C.Z;return o.open&&(e=o.temporaryAddress,t=o[Fe],a=o[De],n=o.temporaryVatCode,i=o[Oe]),[(0,Ae.isPlusTierOrAbove)(),e,t,n,a,i,f.getSubscriptionElementsGroup()]}),[]),h=(0,d.useCallback)((async e=>{if(C.Z.state.open&&(C.Z.setAddressField(e),await i(),n)){const t=n.find((t=>t.countryCode===(null==e?void 0:e.country)));t&&C.Z.update((e=>({...e,[Oe]:Boolean(t[Oe])})))}}),[n,i]),S=(0,d.useCallback)((async e=>{C.Z.update((t=>({...t,temporaryVatCode:e}))),await i()}),[i]);return p&&c&&g?o()("div",{},void 0,o()(xe.k,{paymentMethods:t,[Fe]:c,[De]:g,address:p,updateAddress:h}),"control"===v?o()(_e.J,{address:p,availableCountries:n,shouldShowBusinessName:r,updateAddress:h}):null,o()(Ue.n,{onChange:S,disabled:!0,tooltip:o()(m.FormattedMessage,{id:"claimAndUpgradeBillingInfoForm.disabledVatTooltip",[ke]:"You can add a VAT/GST number in the billing tab after upgrading."}),temporaryVatCode:u,[Oe]:y})):null}var Be=a(94919),Ne=a(82990),Te=a(33665),Pe=a(61519),qe=a(43568),Le=a(74523),Ve=a(78952);const We=a(85).XEN,ze=a(85).vvq,He=a(85).OM8,Ke=a(85).SuY,Ge=a(85).AEv,Re=(a(85).Zm1,a(85).NGd,a(85).tBn),$e=a(85).D7I,je=a(85).DQg,Qe=a(85).xU_,Ye=a(85).P3s,Je=a(85).ELX,Xe=a(85).d9C,et=a(85).Ww0,tt=a(85).BQ6,at=a(85).nx5,nt=a(85).SIM,it=a(85).bIZ,ot=a(85).P_$,rt=a(85).g7N,dt=a(85)._Fe,lt=a(85).Exd,st=a(85).L_E,pt=a(85).QmD;function ct(e){var t;window.__c={n:"ClaimAndUpgradeOrderSummary"};const{[pt]:a}=e,n=(0,p.yK)((e=>({[st]:{display:"flex",flexDirection:"column"},header:{[lt]:16,color:e[dt],fontWeight:Ne.Z.fontWeight.semibold,[rt]:10},couponLink:{[lt]:12},helpButton:{marginLeft:0,marginTop:-4,[rt]:12},helpButtonInner:{[lt]:12}})),[]),i=a[ot]||null===(t=h.n.sum(a[it],a[nt]))||void 0===t?void 0:t.zeroIfNegative();return o()("div",{[tt]:n[st]},void 0,o()("label",{[tt]:n.header},void 0,o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.header",[at]:"Order summary"})),void 0!==a[it]?d[$e](d[Re],null,o()(mt,{totalCostForUpgrade:a[it],[et]:a[Xe][et]}),o()(Le.Z,{[tt]:n.helpButton,[Je]:n.helpButtonInner,title:o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.helpButton.label",[at]:"Learn more about prorated charges"}),href:(0,Te.getLocalizedUrl)("guides.billingAndPayment"),[Ye]:"invoices"}),o()(ut,{[pt]:a}),o()(Pe.Z,{size:14}),o()(Ve.n,{showZeroPrice:!0,lineItemData:{[Qe]:i,type:je,name:o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.orderTotal",[at]:"Total"})},priceStyle:{[lt]:20}})):o()(gt,{}))}function ut(e){return d[$e](d[Re],null,o()(Ve.n,{showZeroPrice:!0,lineItemData:{type:je,name:o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.subTotal",[at]:"Subtotal"}),[Qe]:e[pt][it]}}),o()(Ve.n,{lineItemData:{type:e[pt][ot]?"calculating":je,name:o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.tax.title",[at]:"Tax"}),[Qe]:e[pt][nt],[Ge]:e[pt][nt]||0===e[pt][nt]?void 0:o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.tax.subtitle",[at]:"if applicable"})}}))}function mt(e){window.__c={n:"SpaceUpgradeCostOrder"};const{totalCostForUpgrade:t,[et]:a}=e,n=(0,p.yK)((e=>({[st]:{display:"flex",justifyContent:"space-between",[rt]:6},item:{},title:{[lt]:14},[Ge]:{color:e.mediumTextColor,[lt]:12},[Qe]:{[lt]:14,color:e[dt]}})),[]);return o()("div",{[tt]:n[st]},void 0,o()("div",{[tt]:n.item},void 0,o()("div",{[tt]:n.title},void 0,o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.proratedChanges",[at]:"Prorated charges"})),o()("div",{[tt]:n[Ge]},void 0,o()(m.FormattedMessage,{id:"claimAndUpgradeOrderSummary.proratedChangesCaption",[at]:"All charges due to claim and upgrade the workspace ({memberCount, plural, one {{memberCount} member} other {{memberCount} members}}).",values:{[et]:a}}))),o()("div",{[tt]:n[Qe]},void 0,o()(Be.W,{cost:t,trailingZeroDisplay:Ke})))}function gt(){return d[$e](d[Re],null,o()(qe.Z,{paragraphs:[{[He]:18,lineMargin:4,[ze]:[100],repeat:1,[We]:0},{[He]:14,lineMargin:4,[ze]:[100,40],repeat:1,[We]:-2}]}),o()("div",{[tt]:{display:"block",height:27}}),o()(qe.Z,{paragraphs:[{[He]:16,lineMargin:1,[ze]:[100],repeat:2,[We]:4}]}),o()(qe.Z,{paragraphs:[{[He]:14,lineMargin:0,[ze]:[30],repeat:1,[We]:4}]}),o()(Pe.Z,{size:14}),o()(qe.Z,{paragraphs:[{[He]:24,lineMargin:4,[ze]:[100],repeat:1,[We]:1}]}))}const yt=a(85).IE_,vt=a(85).cav,ht=a(85).Ql2,St=a(85).wgE,ft=a(85).e7B,bt=a(85).iG4,Ct=a(85).dz$,wt=a(85).kaW,Zt=a(85).jp1,It=a(85).eam,At=a(85).HNo,Mt=a(85).P_$,xt=a(85).eAn,Ut=a(85).QmD,_t=a(85).Ixx,kt=a(85).Adu,Ot=a(85).Hlp,Dt=a(85).rps,Ft=a(85).$bT,Et=a(85).PdN,Bt=a(85).Scd,Nt=a(85).NF1,Tt=a(85).EMU;function Pt(){return(0,p.yK)((e=>({closeButton:{display:Tt,alignItems:"center",justifyContent:"center",position:"absolute",top:21,right:20,width:22,height:22,padding:0,[Nt]:"50%",border:"none",[Bt]:"light"===e.mode?c.FN.light.gray[75]:c.FN.dark.gray[500],zIndex:10},[Et]:{width:12,height:12,fill:"light"===e.mode?c.FN.light.gray[400]:c.FN.dark.gray[800]},modal:{[Bt]:"dark"===e.mode?"#191919":e.popoverBackground,[Nt]:12,width:750,maxHeight:760,display:Tt},modalContent:{[Tt]:1,maxWidth:"60%",display:Tt,[Ft]:Dt,position:"relative",[Nt]:"12px 0 0 12px"},[Ot]:{padding:"36px 42px 50px 42px",display:Tt,[Ft]:Dt},[kt]:{[Tt]:1,maxWidth:"40%",[Bt]:"dark"===e.mode?"#202020":e[_t],borderLeft:`1px solid ${e.lightDividerColor}`,padding:"20px 29px 50px 27px",display:Tt,[Ft]:Dt}})),[])}function qt(e){window.__c={n:"ModalContentWrapper"};const{[Ut]:t,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:i}=e,{[xt]:d,onlyShowAddOn:l,[Mt]:p,[At]:c,taxAmount:u,[It]:m,coupon:g}=t,y=(0,s.VK)((()=>{var e;return(null===(e=t.totalUpgradeCost)||void 0===e?void 0:e[Zt])??ye.Z[Ut][wt]}),[t]),{payAmount:v}=b.getRenderData({[xt]:d,promo:t.appliedPromo,[Zt]:y,data:a,onlyShowAddOn:l,[Mt]:p,[Ct]:c??"year",taxAmount:null==u?void 0:u.amount,[It]:m,coupon:g}),h=(0,S.useElementsOptions)({type:"subscription",amount:v.amount,currency:v[Zt]});return o()(r.Elements,{stripe:(0,S.getStripe)(),options:h},void 0,o()(Lt,{[Ut]:t,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:i}))}function Lt(e){window.__c={n:"ModalContent"};const{[Ut]:t,data:a,requestingSpaceId:i,paymentOptionAvailabilityStore:p}=e,c=(0,l.O7)(),y=(0,m.useIntl)(),v=Pt(),h=(0,r.useStripe)(),S=(0,r.useElements)(),[f,w]=(0,s.VK)((()=>[ue.Z[Ut].online,p[Ut][bt]]),[p]),[Z,I,A,M]=(0,s.VK)((()=>{const e=C.Z[Ut];return e.open?[e[xt],e[At],e[It],e.coupon]:[]}),[]);if(!t.open||!Z||!I)return null;if(!f)return o()(be.Z,{});const x=b.getVisiblePaymentMethods({[Ut]:t,[bt]:w});return d.createElement(d.Fragment,null,o()("div",{style:v.modalContent},void 0,o()(Se.Z,{type:pe.Z.Y,showScrollToBottomIndicator:!0},void 0,o()("div",{style:v[Ot]},void 0,o()(Ze.Q,{[xt]:t[xt],onlyShowAddOn:t.onlyShowAddOn,[It]:t[It],type:ge.U.TargetSpace}),o()(fe.Z,{[xt]:Z,[Ct]:I,[It]:A,canAddAI:!1,coupon:M,onChangeBillingInterval:e=>{C.Z[ft]((t=>({...t,[At]:e}))),g.trackSubscriptionUpgradeModalBillingIntervalUpdated(c,{[Ct]:e}),re({[St]:c,[ht]:i,[Ut]:C.Z[Ut]})}}),o()(we.g,{[Ut]:t,paymentOptionAvailabilityStore:p}),o()(Ee,{paymentMethods:x})))),o()("div",{style:v[kt]},void 0,o()(Se.Z,{type:pe.Z.Y},void 0,o()(ct,{[Ut]:t}),o()(Ce.f,{[Ut]:t,paymentOptionAvailabilityStore:p,onClickUpgrade:()=>n[vt]({[St]:c,intl:y,[Ut]:t,stripe:h,elements:S,data:a,requestingSpaceId:i,paymentOptionAvailabilityStore:p})}))),o()("button",{style:v.closeButton,onClick:()=>{C.Z.close()}},void 0,u.Z.close(v[Et])))}const Vt=function(e){window.__c={n:"ClaimAndUpgradeModal"};const{data:t,spaceStore:a}=e,n=(0,s.VK)((()=>C.Z[Ut]),[]),i=(0,l.O7)(),r=(0,m.useIntl)(),p=Pt(),c=(0,d.useMemo)((()=>new me.Z),[]);return(0,d.useEffect)((()=>{var e;const{[Ut]:a}=C.Z;if(!a.open)return;const n=null===(e=ce.default[Ut].currentSpaceStore)||void 0===e?void 0:e.id;n&&oe({[St]:i,[Ut]:a,requestingSpaceId:n});const{currentUserStore:o}=ce.default[Ut],d=null!=o&&o.isDefined()?o.getModel():void 0;if(d){const e=d.getDisplayName(r);var l;if(C.Z.setState({...a,[yt]:{...a[yt],name:e}}),"subscribed_admin"===t.type||"unsubscribed_admin"===t.type)C.Z.setState({...a,appliedPromo:null===(l=t.customerData)||void 0===l?void 0:l.stripe.promo})}}),[]),o()(he.Z,{ariaLabelledBy:se.subscriptionCheckoutTitle,ariaDescribedBy:se.subscriptionCheckoutDescription,open:n.open,preventHideChildrenWhileOpening:!0,innerStyle:p.modal,render:()=>o()(ve.Z,{capture:!0,allowEsc:!0,render:()=>n.open?o()(qt,{[Ut]:n,data:t,requestingSpaceId:a.id,paymentOptionAvailabilityStore:c}):null})})}},78952:(e,t,a)=>{a.d(t,{n:()=>m});var n=a(77094),i=a.n(n),o=(a(67294),a(24405)),r=a(94919),d=a(68785);const l=a(85).AEv,s=a(85).SuY,p=a(85).tpU,c=a(85).g4H,u=a(85).wuN;function m(e){window.__c={n:"LineItem"};const{lineItemData:t,nameStyle:a,priceStyle:n,showZeroPrice:m}=e,g=(0,o.yK)((e=>({container:{marginTop:24},itemContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",lineHeight:1,minHeight:18},name:{fontSize:12,color:e[u],...a||void 0},price:{fontSize:12,color:"promotion"===t.type?"#53A83F":e.regularTextColor,...n||void 0},[c]:{fontSize:12,color:e[u]},captionContainer:{display:"flex",flexDirection:"column"}})),[t,a,n]);let y="-";return t.price&&(t.price.amount>0||m)&&(y=i()(r.W,{cost:t.price[p](),trailingZeroDisplay:s})),i()("div",{style:g.itemContainer},void 0,i()("div",{style:g.captionContainer},void 0,i()("span",{style:g.name},void 0,t.name),t[l]&&i()("span",{style:g[c]},void 0,t[l])),"calculating"===t.type?i()(d.Z,{}):i()("span",{style:g.price},void 0,y))}}}]);