"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8324],{74725:(e,t,o)=>{o.d(t,{O:()=>l});var n=o(67294);const i=o(85).p06,s=o(85).Z97,r=o(85).EmK,a=o(85).iDK;function l(e){let{closeHandler:t,ref:o,active:l,excludedSelectors:d,ignoreKeydown:c}=e;const u=(0,n.useRef)(void 0);(0,n.useEffect)((()=>{if(l){const e=e=>{0===e.button&&e.target instanceof Node?u[a]=e.target:u[a]=void 0},n=e=>{const n=o[a],i=e.target,s=u[a];if(u[a]=void 0,n&&i){for(const e of d||[]){const t=document.querySelectorAll(e);for(let e=0;e<t.length;++e){if(t[e].contains(i))return}}s&&(n===s||n.contains(s))||n===i||n.contains(i)||t()}},l=e=>{c||"Esc"!==e.key&&"Escape"!==e.key||t()};return window[r](s,e),window[r]("click",n),window[r]("keydown",l),()=>{window[i](s,e),window[i]("click",n),window[i]("keydown",l)}}}),[t,o,l,d,c])}},67706:(e,t,o)=>{o.d(t,{Z:()=>g});var n=o(77094),i=o.n(n),s=o(97464),r=o.n(s),a=o(67294),l=o(24405),d=o(82990),c=o(44532),u=o(58032);const m=o(85).D7I,p=o(85).L_E;function g(e){let{text:t,tooltipText:o,icon:n}=e;window.__c={n:"InlineTextWithIconTooltip"};const s=(0,l.yK)((e=>({icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor,marginBottom:"0.1em"},tooltip:{background:e.contentBackground,boxShadow:e.lightBoxShadow},[p]:{display:"flex",alignItems:"center",fontWeight:d.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:d.Z.fontSize.UISmall.desktop,textAlign:"center"},text:{display:"inline"}})),[]);return i()(u.Z,{style:s.tooltip,render:e=>a[m]("div",r()({style:s.text},e),t),renderTooltip:()=>i()("div",{style:s[p]},void 0,n(s.icon),i()("div",{},void 0,o)),alignment:c.ZP.Alignment.Start,placement:c.ZP.Placement.Bottom})}},93963:(e,t,o)=>{o.d(t,{z:()=>d});var n=o(77094),i=o.n(n),s=(o(67294),o(24405)),r=o(5366);const a=o(85).nx5,l=o(85).Yzm;function d(e){let{color:t,size:o,style:n}=e;window.__c={n:"StatusDot"};const d=(0,r.useIntl)(),c=(0,s.yK)((e=>({dot:{height:o||8,width:o||8,background:t||e.blueColor,flexShrink:0,borderRadius:"100%",pointerEvents:"none",...n}})),[o,t,n]);return i()("div",{role:"img","aria-label":d[l]({id:"statusDot.ariaLabel",[a]:"New"}),style:c.dot})}},45338:(e,t,o)=>{o.r(t),o.d(t,{default:()=>uo});var n=o(77094),i=o.n(n),s=o(67294),r=o(1302),a=o(480),l=o(6740),d=o(97511),c=o(33125),u=o(81954),m=o(24405),p=o(3909),g=o(27006),f=o(21202),h=o(82990),v=o(5366),w=o(54564),S=o(47307),b=o(96514),y=o(9953),x=o(4083),C=o(61045),k=o(98104),Z=o(12359),D=o(11368),I=o(78089),M=o(65598),R=o(16402),_=o(89574),B=o(61766),T=o(87404),E=o(96049),P=o(39098),A=o(74136),F=o(64369),V=o(42402),L=o(67706),K=o(65085),O=o(65187),N=o(97464),U=o.n(N),W=o(96486),z=o.n(W),H=o(15145),j=o(41432),G=o(19889),$=o(97880),X=o(43132),J=o(95477),q=o(43250),Q=o(87279),Y=o(33665),ee=o(79315),te=o(52275),oe=o(31945),ne=o(73063),ie=o(78140),se=o(32163),re=o(72495),ae=o(58032),le=o(83182),de=o(82899);const ce=o(85).Joh,ue=o(85).PG2,me=o(85).L_E,pe=o(85).P3s,ge=o(85).j7K,fe=o(85).uM3,he=o(85).y79,ve=o(85).X5t,we=o(85).D7I,Se=o(85).nx5,be=o(85).Jkr,ye=o(85).X_m,xe=o(85).rpY,Ce=o(85).ij9,ke=o(85).LtW,Ze=o(85).TtP,De=o(85).rG,Ie=o(85).fKq,Me=o(85).dLQ,Re=o(85).uGP,_e=o(85).voC,Be=o(85).iru,Te=o(85).wgE,Ee=o(85).JJj,Pe=o(85).y6y,Ae=o(85).XtO,Fe=o(85).G3i,Ve=o(85).cS_,Le=o(85).vIB;function Ke(e){window.__c={n:"CommentActionGroup"};const{[Le]:t}=e,o=(0,v.useIntl)(),n=(0,a.O7)(),r=n.device,l=(0,s.useRef)(null),c=(0,d.l)(),m=(0,u.VK)((()=>Boolean(e[Ve].getResolved())),[e[Ve]]),f=(0,u.VK)((()=>e[Ae][Fe]()),[e[Ae]]),h=(0,u.VK)((()=>{var e;return null===(e=ee.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),S=(0,u.VK)((()=>{const t=e[Ae].getCreatedById();return e[Ae].getCreatedByTable()===G.KJ&&h===t}),[h,e[Ae]]),y=(0,u.VK)((()=>{var e;const t=null===(e=ee.default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&g.canAdmin(t)}),[]),x=(0,u.VK)((()=>e.blockStore.getRole()),[e.blockStore]),C=(0,u.VK)((()=>{var e;return null==c||null===(e=c[Pe].state)||void 0===e?void 0:e.permission}),[null==c?void 0:c[Pe]]),k="comment_only"===x||"comment"===C;if(!f||!h)return null;const D=()=>{Z[Ee]({userAction:"Comment.handleReopen",[Te]:n,perform:t=>{b.reopenDiscussion({[Te]:n,[Ve]:e[Ve],transaction:t,[Le]:e[Le]})}})},I=t=>{Z[Ee]({userAction:"Comment.handleResolve",[Te]:n,perform:t=>{b.resolveDiscussion({[Te]:n,[Ve]:e[Ve],transaction:t,[Le]:e[Le]})}}),w.closeBlockDiscussionWhenOpenTabIsEmpty(),null==t||t.stopPropagation()},M=()=>{var t,o;const i=e[Ae][Be]();if(!i||null==i||!i[Fe]())return null;let s=i[Be]();if(null===(t=s)||void 0===t||!t[Fe]())return null;var r;s.getType()===j.Ti.tableRow&&(s=null===(r=s)||void 0===r?void 0:r.getParentBlockStore());if(null===(o=s)||void 0===o||!o[Fe]())return null;const a=s.getModel().getRenderUrl({baseUrl:J.default.domainBaseUrl,[_e]:e[Ae][_e],discussionId:i.id,pageVisitSource:H.tY.CopyLink});X.copyString({[Te]:n,stringValue:a,copiedMessage:X.clipboardMessages[Re]})};if(!n.currentUser.isLoggedIn())return null;const R=x&&g.canReadOnly(x);if(R)return null;const _=e.isFirstComment&&"comment_unfurl"!==t&&!r[Me]&&!k&&!R,B=[];!r[Me]||k||R||(m?B.push("reopen"):B.push(Ie)),S&&B.push("edit"),e.isFirstComment&&B.push("copyLink"),(S||y)&&B.push(De);const T=B[Ze]>0;return T||_||e.canShowReactions?s[we](oe.ZP,{ref:l,popupType:r[Me]?oe.Z4.SlideUp:oe.Z4.Popup,[ke]:e[ke],placementToOrigin:oe.pO.Right,stopClickPropagation:!0,renderOrigin:s=>i()(Oe,{buttonConfig:{[Ie]:{[Ce]:_,resolved:m,onResolve:I,onReopen:D},react:{[Ce]:e.canShowReactions,onReact:()=>{var i;(0,de.openEmojiMenuForReaction)(n,o,e[Ae],(null===(i=l.current)||void 0===i?void 0:i.getAnchor())??null,t,e.handleReaction)}},moreActions:{[Ce]:T}},[Ce]:e[Ce],buttonPopupEvents:s,[Le]:e[Le],[Ae]:e[Ae]}),[xe]:t=>{let o;o=r[Me]?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup};const n=B.map((t=>"reopen"===t?{key:"reopen",[xe]:e=>s[we](te.Z,U()({},e,{icon:p.Z.arrowLeft({[ye]:16,[be]:16}),title:i()(v.FormattedMessage,{id:"comment.reopenDiscussion.button",[Se]:"Re-open discussion"})})),[ve]:D}:"resolve"===t?{key:Ie,[xe]:e=>s[we](te.Z,U()({},e,{icon:p.Z.thinCheck({[ye]:16,[be]:16}),title:i()(v.FormattedMessage,{id:"comment.resolveDiscussion.button",[Se]:"Resolve comments"})})),[ve]:()=>I()}:"edit"===t?{key:"edit",[xe]:e=>s[we](te.Z,U()({},e,{icon:p.Z.pencil({[ye]:16,[be]:16}),title:i()(v.FormattedMessage,{id:"comment.editComment.button",[Se]:"Edit comment"})})),[ve]:e.handleEditComment}:"delete"===t?{key:De,[xe]:e=>s[we](te.Z,U()({},e,{icon:p.Z.trash({[ye]:16,[be]:16}),title:i()(v.FormattedMessage,{id:"comment.deleteComment.button",[Se]:"Delete comment"})})),[ve]:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",[xe]:e=>s[we](te.Z,U()({},e,{icon:p.Z.link({[ye]:16,[be]:16}),title:i()(v.FormattedMessage,{id:"comment.copyLinkToDiscussion.button",[Se]:"Copy link to discussion"})})),[ve]:M}:void(0,$.unreachable)(t)));return i()("div",{className:q.commentOverflowMenu},void 0,s[we](ie.Z,o,i()(se.Z,{type:se.i[he],[ge]:void 0,onAccept:t.close,sections:z()[fe]([n[Ze]&&{key:0,[xe]:e=>s[we](re.Z,e),items:n}])}),!r[Me]&&i()(re.Z,{topBorder:!0,disableDesktopPadding:!1},void 0,i()(le.Z,{title:i()(v.FormattedMessage,{[Se]:"Learn about comments",id:"comments.learn"}),href:(0,Y.getLocalizedUrl)("guides.comments"),[pe]:"comments"}))))}}):null}function Oe(e){window.__c={n:"ActionGroupOrigin"};const{buttonPopupEvents:t,[Le]:o}=e,{resolved:n,onResolve:r,onReopen:l}=e.buttonConfig[Ie],d=(0,a.O7)().device,c=(0,m.yK)((t=>({addIcon:{[be]:15,fill:t.mediumIconColor},[me]:{display:"flex",boxShadow:t.lightBoxShadow,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,...d[Me]?{borderRadius:3,marginTop:4,right:16}:{marginRight:"margin_comments"===o?0:8,marginTop:"updates_sidebar"===e[Le]?6:0,right:"margin_comments"===o?12:16,top:"margin_comments"===o?6:0,opacity:e[Ce]?1:0,gap:1,borderRadius:4,transition:"opacity 100ms ease-out",zIndex:1}}})),[d[Me],o,e[Le],e[Ce]]);return i()("div",{style:c[me]},void 0,e.buttonConfig.react[Ce]&&i()(ae.Z,{[ce]:()=>i()(v.FormattedMessage,{[Se]:"Add reaction",id:"comment.actions.addReaction.label"}),[xe]:t=>s[we](ne.Z,U()({hasBackground:!1,showShadow:!1,icon:()=>p.Z.reactionAdd(c.addIcon),[ue]:e.buttonConfig.react.onReact,style:{[ye]:22,[be]:22,flex:"0 0 auto"}},t))}),e.buttonConfig[Ie][Ce]&&i()(ae.Z,{[ce]:()=>i()(v.FormattedMessage,n?{[Se]:"Re-open",id:"comment.actions.reopenButton.label"}:{[Se]:"Resolve",id:"comment.actions.resolveButton.label"}),[xe]:e=>s[we](ne.Z,U()({hasBackground:!1,showShadow:!1,icon:n?p.Z.reopen:p.Z[Ie],[ue]:n?l:r,style:{[ye]:22,[be]:22,flex:"0 0 auto"}},e))}),e.buttonConfig.moreActions[Ce]&&i()(ae.Z,{[ce]:()=>i()(v.FormattedMessage,{[Se]:"More actions",id:"comment.actions.moreActions.label"}),[xe]:e=>s[we](ne.Z,U()({},t,e,{hasBackground:!1,showShadow:!1,icon:p.Z.dots,style:{[ye]:22,[be]:22,flex:"0 0 auto"}}))}))}var Ne=o(72893),Ue=o(95538),We=o(70203),ze=o(93286),He=o(72747),je=o(53471),Ge=o(68785),$e=o(41714),Xe=o(69721),Je=o(92628),qe=o(30398);const Qe=o(85).nx5,Ye=o(85).PXg,et=o(85).qqR,tt=o(85).j_V;function ot(e){if("image"!==e.getType())return!1;const t=We.getText(e.getPropertyValue("source"));return void 0!==t&&!(0,Ue.y_)(t,".jfif")&&!(0,Ue.y_)(t,".webp")}function nt(e){window.__c={n:"CommentContent"};const t=e[tt]===I.O2.Sidebar?He.vW.SidebarComment:He.vW.PageComment,{filmStripFiles:o,embedBlockStores:n}=(0,u.VK)((()=>{if(e.collapsed)return{filmStripFiles:je[et](e.contentStores),embedBlockStores:[]};if(e[tt]===I.O2.Page&&e.contentStores.filter((e=>ot(e))).length>1){const[t,o]=z().partition(e.contentStores,(e=>ot(e)));return{filmStripFiles:je[et](t),embedBlockStores:o}}return{filmStripFiles:[],embedBlockStores:e.contentStores}}),[e.contentStores,e.collapsed,e[tt]]),r=n.length>0&&n.map((o=>i()(Je.Z,{store:o,analyticsName:"comment_media",blockMenuActions:ze.qq,canTriggerContextMenu:!0,style:{marginTop:8}},o.id,$e.Z.hasRendererForStore(o)?i()($e.Z,{disabled:!1,disableDrag:!0,store:o,disableResizers:!0,preserveScale:!0,inlineContentStyle:{height:"auto",width:"auto",maxHeight:240,maxWidth:"100%",cursor:"zoom-in"},blockLocation:t,iconSvg:()=>i()(Ge.Z,{style:{[Ye]:10}}),onRemoveBlockFromComment:e.onRemoveContent},void 0,i()(v.FormattedMessage,{[Qe]:"Uploading file...",id:"comment.embeddedFile.uploadInProgressMessage"})):i()(Xe.Z,{disabled:!1,store:o})))),a=o.length>0&&i()(qe.Z,{files:o,disableRemove:!0});return s.createElement(s.Fragment,null,a,r)}const it=o(85).nx5;function st(){window.__c={n:"CommentNewBar"};const e=(0,m.yK)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.mediumTextColor,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:h.Z.fontWeight.semibold,display:"flex",alignItems:"center",marginRight:16,marginLeft:16,marginTop:10,marginBottom:10},newBarText:{padding:"0 10px"}})),[]);return i()("div",{style:e.newBarWrapper},void 0,i()("div",{style:e.newBarLine}),i()("div",{style:e.newBarText},void 0,i()(v.FormattedMessage,{id:"comment.newIndicator.label",[it]:"New comments"})),i()("div",{style:e.newBarLine}))}var rt=o(19195);const at=o(85).XNW,lt=o(85)._Fe,dt=o(85).Vgm,ct=o(85).H1U,ut=o(85).LtW,mt=o(85).tBn,pt=o(85).D7I,gt=o(85).PXg,ft=o(85).$Lq,ht=o(85).pkR,vt=o(85).lGm,wt=o(85).YRs,St=o(85).aOg,bt=o(85).DZV,yt=o(85).fBu,xt=o(85).FTQ,Ct=o(85).LlE,kt=o(85).nLZ,Zt=o(85).XCs,Dt=o(85).YDv,It=o(85).sM5,Mt=o(85).lzS,Rt=o(85).T9w,_t=o(85).cZW,Bt=o(85).NLk,Tt=o(85).ChN,Et=o(85).nAm,Pt=o(85).ydP,At=o(85).L_E,Ft=o(85).DIE,Vt=o(85).BQ6,Lt=o(85).j_V,Kt=o(85).Y$2,Ot=o(85).$W2,Nt=o(85).ZG6,Ut=o(85).DN1,Wt=o(85).TtP,zt=o(85).x2k,Ht=o(85).nx5,jt=o(85).PPM,Gt=o(85).Gc6,$t=o(85).LCr,Xt=o(85).q5h,Jt=o(85).wgE,qt=o(85).Drs,Qt=o(85).JJj,Yt=o(85).kUS,eo=o(85).F7X,to=o(85).cMN,oo=o(85).Tay,no=o(85).hDW,io=o(85).cS_,so=o(85).sbn,ro=o(85).V3e,ao=o(85).vIB,lo=o(85).XtO;function co(e){switch(e){case"margin_comments":return 0;case"updates_sidebar":return 35;case"comment_unfurl":return 29;default:return 32}}const uo=function(e){window.__c={n:"Comment"};const{[lo]:t,discussionContext:o,maxLines:n,[ao]:N}=e,U=(0,a.O7)(),W=(0,v.useIntl)(),[z,H]=(0,s.useState)(!1),[j,G]=(0,s.useState)(!1),[$,X]=(0,s.useState)(!1),J=co(N),q=(0,u.VK)((()=>e[lo].isDefined()?new T.Z(U,e[lo].getSpaceId()):void 0),[U,e[lo]]),Q=(0,u.VK)((()=>M[ro](e[lo]).filter((e=>(0,P.Vh)(e,{table:f.iU,id:e.id},"alive")[so]()))),[e[lo]]),Y=(0,u.VK)((()=>e[io].getResolved()),[e[io]]),ee=(0,u.VK)((()=>null==q?void 0:q.state.files),[q]),te=(0,u.VK)((()=>null==q?void 0:q.state.textStore),[q]),oe=(0,s.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,l.E)(t)&&G(!0)}),[]),ne=(0,s.useCallback)((()=>{G(!1)}),[]),ie=(0,s.useCallback)((()=>{E.Z.state||X(!0)}),[]),se=(0,s.useCallback)((()=>{X(!1)}),[]),re=(0,d.l)(),ae=(0,u.qz)(void 0,B.Z),le=(0,u.VK)((()=>ae.state.open),[ae]),ce=(0,u.VK)((()=>{const t=e[io].getComments();return Boolean(t&&t[0]===e[lo].id)}),[e[io],e[lo].id]),ue=(0,u.VK)((()=>{var t;const o=e[no].getRole(),n=ce&&"comment_unfurl"!==N,i=o&&g.canReadOnly(o),{device:s}=U,r="comment_only"===o||re&&"comment"===(null===(t=re.publicEditModeStore.state)||void 0===t?void 0:t.permission),a=n&&!s.isMobile&&!r&&!i;return $||j||e.hoveringDiscussion&&n||le||s.isMobile||e[oo]&&a}),[e[no],e.hoveringDiscussion,e[oo],ce,N,U,re,$,j,le]),me=(0,s.useContext)(D.Ue),pe=(0,u.VK)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,[to]:t.getLastEditedTime(),[eo]:t.getCreatedTime(),text:t.getText(),reactions:t.getUserVisibleReactions()}:null}),[t]),ge=(0,u.VK)((()=>{if(!pe)return null;const e=P.t1.createChildStore(t,pe.createdByPointer);return{[Yt]:e.getDisplayName(W),[lo]:e}}),[pe,W,t]),fe=(0,s.useCallback)((()=>{Z[Qt]({[qt]:"Comment.deleteComment",[Jt]:U,perform:t=>{b.deleteComment({[Jt]:U,[Xt]:e[lo],[$t]:t,[ao]:N})},[Gt]:!0})}),[U,e[lo],N]),he=(0,s.useCallback)((async()=>{await S[jt]({message:i()(v.FormattedMessage,{[Ht]:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:i()(v.FormattedMessage,{[Ht]:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})})&&(fe(),w.closeBlockDiscussionWhenOpenTabIsEmpty(),x.closeReplyDiscussionMenuWhenEmpty(U))}),[fe,U]),ve=(0,s.useCallback)((async t=>{const o=M[zt](e[lo])[so](),n=M[ro](e[lo]).filter((e=>e.id!==t.id)),i=o&&o[Wt]>0,s=0===n[Wt];!i&&s?(await he(),H(!1)):Z[Qt]({[qt]:"Comment.handleRemoveFileFromActions",[Jt]:U,perform:o=>{b.deleteFileBlocksFromComment({[Xt]:e[lo],fileBlocks:[t],[$t]:o})}})}),[U,he,e[lo]]),we=(0,s.useCallback)((()=>{Ce.current&&C.scrollElementIntoView({element:Ce.current,scrollers:{[Ut]:null==me?void 0:me[Ut]},vertical:{reveal:"closest"},horizontal:void 0,animate:!0})}),[me]),Se=(0,s.useCallback)((async()=>{if(!q)return;const t=M[zt](e[lo])[so]()||[],o=q.state.textStore;Z[Qt]({[qt]:"Comment.handleEditComment",[Jt]:U,perform:e=>{y.setValue({[lo]:o,value:t,[$t]:e})}}),H(!0),await r.default[Nt](),await r.default[Nt](),k.setSelectionAtEnd({[lo]:o})}),[q,U,e[lo]]),be=(0,s.useCallback)((async()=>{if(!q)return!1;if(!(0,I.hu)(q,e[lo]))return H(!1),!0;if(await S[jt]({message:i()(v.FormattedMessage,{[Ht]:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:i()(v.FormattedMessage,{[Ht]:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})}))return H(!1),!0;return!1}),[q,e[lo]]),ye=(0,s.useCallback)((async()=>{const t=null==te?void 0:te[so]();t&&t[Wt]>0||ee&&ee[Wt]>0?Z[Qt]({[qt]:"Comment.handleSubmitEdit",[Jt]:U,perform:o=>{b.editComment({[Jt]:U,[lo]:e[lo],text:t||[],[$t]:o,[ao]:N,files:ee||[]})}}):await he(),H(!1)}),[ee,te,N,U,he,e[lo]]),xe=(0,s.useRef)(null),Ce=(0,s.useRef)(null);(0,c.c)(_.Z,(()=>({edit:Se,handleCancelEdit:be,getNode:()=>xe.current,isEditing:()=>z,[ao]:N,commentId:e[lo].id})),[Se,be,z,N,e[lo].id]);const ke=I.Je[N],Ze=null==pe?void 0:pe.text,De=void 0!==Ze&&Ze[Wt]>0,Ie=De&&(0,I.p9)(Ze),Me=function(e){let{[ao]:t,isAllEmojis:o,[Ot]:n}=e;const i=co(t);return(0,m.yK)((e=>({[At]:{flexGrow:"comment_unfurl"===t?1:void 0},comment:{[It]:"flex",[ct]:"flex-start",position:"relative",fontSize:14},avatar:{[gt]:10,[kt]:"comment_unfurl"===t?16:2,userSelect:"none",[dt]:"none"},userRow:{[ct]:"center",position:"relative",[It]:"flex",flexDirection:"row",[Ct]:"margin_comments"===t?"8px 14px 0px 13px":"comment_unfurl"===t?"6px 16px 0px 10px":"6px 16px 0px 18px",[kt]:"comment_unfurl"===t?-11:void 0,userSelect:"none",[dt]:"none"},[_t]:{height:8,width:81,borderRadius:3,background:e.lightDividerColor},unfurlLessWrapper:{color:e[lt],[Tt]:h.Z[Tt].medium,[Dt]:i,[at]:7},unfurlMoreWrapper:{color:"comment_unfurl"===t?e[lt]:e.mediumTextColor,[Tt]:"comment_unfurl"===t?h.Z[Tt].medium:void 0},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,[Dt]:i,[at]:"comment_unfurl"===t?8:void 0,...o?{fontSize:32}:{}},textWrapper:{[Ct]:"margin_comments"===t?"4px 14px":"0px 16px 3px 16px",[kt]:"comment_unfurl"===t?"-14px":void 0},reactionContainer:{[at]:"margin_comments"===t?14:50,[gt]:14,[kt]:4,marginBottom:4},attachmentContainer:{[Ct]:"0px 16px 6px 54px",[kt]:-12,[It]:"flex",[ct]:"center"},[Rt]:{margin:"0 6px",flexBasis:"comment_unfurl"!==t?140:void 0,[Bt]:"normal",flexGrow:"updates_sidebar"===t||"comment_unfurl"===t?void 0:1,[It]:"inline"},commentAttachment:{margin:"0px 14px 0px "+("margin_comments"===t?"14px":"50px")},commentAuthorPlaceholder:{[gt]:8,[kt]:"comment_unfurl"===t?14:2,height:n,width:n,borderRadius:20,flexShrink:0}})),[t,i,o,n])}({[ao]:N,isAllEmojis:Ie,[Ot]:ke});if(!q)return null;if(!pe||!ge)return null;const Re="comment_unfurl"!==N;let _e,Be;pe[to]&&pe[to]>pe[eo]+100?(_e=i()(v.FormattedMessage,{[Ht]:"{lastEditedTime} (edited)",id:"comment.editedAtTime.label",values:{[to]:(0,R.IS)(pe[to])}}),Be=(0,R.uy)(pe[to])):(_e=(0,R.IS)(pe[eo]),Be=(0,R.uy)(pe[eo]));const Te=i()("div",{[Vt]:Me.commentAttachment},void 0,i()(nt,{contentStores:Q,onRemoveContent:ve,[Lt]:(0,I.ad)(N),[Kt]:e[Kt]}));return s[pt]("div",{ref:xe,onClick:e=>z&&e[Ft](),[Vt]:Me[At]},e.showNewBar&&i()(st,{}),i()("div",{[Vt]:Me.comment,onFocus:oe,onBlur:ne,onMouseMove:ie,onMouseLeave:se},void 0,i()("div",{[Vt]:{flexGrow:1,minWidth:0}},void 0,i()("div",{[Vt]:Me.userRow},void 0,i()(Ne.S,{authorStore:null==ge?void 0:ge[lo],[Ot]:ke,avatarStyle:Me.avatar,placeholderStyle:Me.commentAuthorPlaceholder}),i()("div",{[Vt]:{[Pt]:Et}},void 0,i()("span",{[Vt]:{[Tt]:h.Z[Tt].semibold,[Bt]:"normal"}},void 0,ge[Yt]||i()("span",{[Vt]:Me[_t]})),i()(F.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,[Vt]:Me[Rt]},void 0,i()(L.Z,{text:_e,tooltipText:Be,icon:p.Z[Mt]})),"comment_unfurl"===N&&Y&&i()("div",{[Vt]:{[It]:"inline-flex"}},void 0,i()(A.Z,{},void 0,i()(v.FormattedMessage,{id:"comment.unfurl.resolvedStatus",[Ht]:"Resolved"}))))),i()("div",{[Vt]:{[Dt]:J+15,[Zt]:16}},void 0,o),z?i()("div",{[Vt]:(0,I.ad)(N)===I.O2.Margin?{[kt]:8}:void 0},void 0,i()(rt.default,{[xt]:{[Ct]:"margin_comments"===N?"0px 14px 4px 14px":"0px 10px 0px 45px"},showAvatar:!1,[yt]:e[lo],[no]:e[no],onCancel:be,onSubmit:ye,[bt]:q,[St]:!0,isMobileSlideUpMenu:!0,[wt]:!1,[Xt]:e[lo],[Lt]:(0,I.ad)(N),canDrop:!0})):s[pt](s[mt],null,De&&!z&&i()("div",{[Vt]:Me.textWrapper},void 0,i()(K.Z,{onMore:"comment_unfurl"===N?void 0:()=>{},lessElement:"comment_unfurl"===N?i()("span",{[vt]:"notion-link",[Vt]:Me.unfurlLessWrapper},void 0,i()(v.FormattedMessage,{id:"comments.showLessLabel",[Ht]:"show less"})):void 0,moreElement:i()(V.Z,{disableUnderline:!0,[Vt]:Me.unfurlMoreWrapper},void 0,"…"," ",i()("span",{},void 0,i()(v.FormattedMessage,{id:"text.truncated.showMoreLabel",[Ht]:"more"}))),maxLines:e[Kt]?n:void 0},void 0,i()(O.Z,{[Vt]:Me.text,[lo]:M[zt](e[lo]),[ht]:!0,[ft]:!0,disableEquationInteraction:!0}))),"comment_unfurl"!==N?Te:!De&&i()("div",{[Vt]:Me.attachmentContainer},void 0,i()("div",{[Vt]:{[gt]:5}},void 0,p.Z.attachFile(Me.attachIcon)),i()(v.FormattedMessage,{[Ht]:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:Q[Wt]},id:"comment.unfurl.attachments.title"}))),s[pt]("div",{ref:Ce},Re&&pe.reactions[Wt]>0&&i()("div",{[Vt]:Me.reactionContainer},void 0,i()(de.default,{[yt]:e[lo],[ao]:N})))),"comment_unfurl"!==N&&!z&&i()(Ke,{[lo]:e[lo],[io]:e[io],[no]:e[no],[ao]:N,visible:ue,isFirstComment:ce,[ut]:ae,canShowReactions:Re,handleEditComment:Se,handleDeleteComment:he,handleReaction:we})))}},72893:(e,t,o)=>{o.d(t,{S:()=>h});var n=o(77094),i=o.n(n),s=(o(67294),o(81954)),r=o(24405),a=o(54368),l=o(77420),d=o(19889),c=o(97880),u=o(83420),m=o(70301),p=o(45653);const g=o(85).SEy,f=o(85).Scd;function h(e){let{authorStore:t,avatarSize:o,avatarStyle:n,placeholderStyle:h}=e;window.__c={n:"CommentAuthorAvatar"};const v=(0,r.Fg)(),w=(0,s.VK)((()=>(0,u.TL)(t)),[t]);return w.asActor?w.table===d.KJ?i()(p.Z,{hasTooltip:!0,userValue:w.asActor,style:n,size:o,avatarShouldShowShadow:!0}):w.table===l.cZ?i()(m.Z,{botValue:w,size:o,style:n}):w.table===a.y?i()("div",{style:{...h,[f]:v[g]}}):void(0,c.unreachable)(w):i()("div",{style:{...h,[f]:v[g]}})}},97543:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ht});var n=o(77094),i=o.n(n),s=o(96486),r=o.n(s),a=o(67294),l=o(1302),d=o(480),c=o(33125),u=o(81954),m=o(24405),p=o(70203),g=o(97880),f=o(5366),h=o(47307),v=o(96514),w=o(17503),S=o(61045),b=o(98104),y=o(12359),x=o(78089),C=o(65598),k=o(89574),Z=o(46351),D=o(95802),I=o(34859),M=o(87404),R=o(96049),_=o(45589),B=o(83575),T=o(18647),E=o(92628),P=o(93963),A=o(45338),F=o(13991),V=o(41432),L=o(99036),K=o(8848),O=o(83212),N=o(55384),U=o(82990),W=o(33929),z=o(2456);const H=o(85).Mm1,j=o(85).Wgn,G=o(85).PG2,$=o(85).kEu,X=o(85).gGi,J=o(85).EMU,q=o(85).sM5,Q=o(85).Oc6,Y=o(85).aFd,ee=o(85).g7N,te=o(85).nLZ,oe=o(85).t8X,ne=o(85).MHP,ie=o(85).xa7,se=o(85).OBh,re=o(85).G0x,ae=o(85).xg7,le=o(85).UNs,de=o(85).hDW,ce=new Set([V.Ti.toggle,V.Ti.bulletedList,V.Ti.numberedList,V.Ti.quote,V.Ti.toDo,V.Ti.code,V.Ti.callout,V.Ti.header,V.Ti.subHeader,V.Ti.subSubHeader,V.Ti.tableRow]);function ue(e){window.__c={n:"DiscussionContext"};const t=(0,m.Fg)(),o=(0,u.VK)((()=>{var t;return e.store.isDefined()?null===(t=e.store.getParentStore())||void 0===t?void 0:t.getValue():null}),[e.store]),n=(0,u.VK)((()=>e[de].getSpaceId()),[e[de]]),s=(0,u.VK)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return p.filterAnnotations(t,(t=>!p[le](t)||p[ae](t)===e.store.id))}),[e.store]);function r(o){if(!s)return null;const r={[q]:J,alignItems:"flex-start",fontSize:14,[te]:8,[ee]:8,color:t.mediumTextColor,width:X},a=L[$](W.default.getIntl()).title;return a?i()("div",{style:r},void 0,i()("div",{style:{[q]:J,width:X}},void 0,i()(me,{}),(o=>{let{[re]:s,[se]:r,discussionParentValue:a}=o;const l=i()("div",{style:{maxHeight:72,overflow:"hidden",lineHeight:"24px"}},void 0,i()(z.KX,{value:{value:s,spaceId:n},[se]:r,labeled:!1,[ie]:e[de],[ne]:!0,[oe]:!0}));if(!a)return l;const d=a.type;return d===V.Ti.code?i()(O.Z,{title:(0,z.SP)(a),theme:t,style:{[te]:0,[ee]:0}},void 0,i()("span",{style:{[Y]:U.Z[Q](F.SP).mono,fontSize:12,tabSize:2}},void 0,l)):(0,z.pH)(d)?i()(O.Z,{title:(0,z.pH)(d),theme:t,style:{[te]:0,[ee]:0}},void 0,l):l})({[re]:s,discussionParentValue:o,[se]:a}))):null}if("updates_sidebar"===e.discussionLocation){if(!o)return null;if("text"!==o.type)return i()("div",{[G]:e[G],style:{[q]:J,cursor:N.kk.fromBlock(o).isType(V.Zi)?"text":void 0}},void 0,s&&ce.has(o.type)?r(o):i()("div",{style:{[q]:J,[te]:8,[ee]:8,width:X}},void 0,i()(me,{}),i()(z.ZP,{[j]:o,[ie]:e[de],blockPreviewLocation:"comments_sidebar"})))}return i()("div",{[G]:e[G],style:{cursor:"text"}},void 0,r())}function me(){return i()("div",{style:{width:3,borderRadius:3,marginLeft:2,marginRight:8,background:K.DB,flexShrink:0,[H]:2}})}var pe=o(3909),ge=o(27006),fe=o(58032),he=o(19195);const ve=o(85).j_V,we=o(85).Dhe,Se=o(85).YRs,be=o(85).fBu,ye=o(85).FTQ,xe=o(85).D7I,Ce=o(85).DZV,ke=o(85).vIB,Ze=o(85).nx5,De=o(85).C_1,Ie=o(85).PXg,Me=o(85).QNi,Re=o(85).iwI,_e=o(85).XLC,Be=o(85).jkI,Te=o(85).UPJ,Ee=o(85).L_E,Pe=o(85).XCs,Ae=o(85).XeC,Fe=o(85).dLQ,Ve=o(85).YDv,Le=a.forwardRef(((e,t)=>{window.__c={n:"DiscussionPopupInput"};const o=(0,d.O7)(),{format:n,role:s,showMoreCommentsButton:r,onMoreCommentsClick:l,inputVisible:c}=e,p=s&&ge.canReadOnly(s),g=o.currentUser.isLoggedIn(),{device:h,WindowSizeStore:v}=o,w=(0,m.Fg)(),S=(0,u.VK)((()=>({[Ve]:h[Fe]&&v[Ae](18)||n===x.O2.Margin&&9||13,[Pe]:h[Fe]&&v[Ae](14)||n===x.O2.Margin&&12||16})),[v,h[Fe],n]),b=(0,m.yK)((t=>({[Ee]:{paddingTop:e.collapsed?1:4,[Ve]:S[Ve],[Pe]:S[Pe],paddingBottom:(h[Fe]&&n!==x.O2.Page?8:n===x.O2.Sidebar&&14)||0,position:"relative"},moreCommentsWrapper:{position:"absolute",display:"flex",[Te]:Be,alignItems:"flex-start",zIndex:1,left:0,right:0,marginTop:-32,height:30,background:`linear-gradient(to bottom, ${t[_e]} 0px, ${t[Re]} 30px`},[Me]:{...(0,fe.J)(t,!1),cursor:"pointer",display:"flex",[Te]:Be,alignItems:Be}})),[S,h[Fe],n,e.collapsed]);return a[xe](a.Fragment,null,g&&!p&&i()("div",{style:b[Ee]},void 0,r&&i()("div",{style:b.moreCommentsWrapper},void 0,i()("div",{style:b[Me],onClick:l},void 0,i()("div",{style:{[Ie]:5}},void 0,pe.Z.arrowDownSmall({fill:w[De],height:12,width:12})),i()(f.FormattedMessage,{[Ze]:"More",id:"discussion.moreMessageTooltip"}))),c&&a[xe](he.default,{showAvatar:"margin_comments"!==e[ke],[ye]:h[Fe]?void 0:{[Ve]:5,[Pe]:2},[be]:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,[Ce]:e[Ce],isMobileSlideUpMenu:!1,[Se]:!0,onEditPreviousComment:e.onEditPreviousComment,[we]:e.store.id,[ve]:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded})))}));var Ke=o(62385);const Oe=o(85).nx5;function Ne(e){window.__c={n:"DiscussionShowAllButton"};const t=(0,m.yK)((t=>({newBarLine:{height:"0px",borderBottom:`1px solid ${t.darkDividerColor}`,marginLeft:0,flex:1},moreCommentsWrapper:{color:t.lightTextColor,fontSize:14,paddingLeft:e.insetButton?38:2,flexGrow:1,display:"flex",alignItems:"center"},button:{padding:"14px 12px",margin:"1px 0",borderRadius:0,fontSize:14,color:t.mediumTextColor,width:"100%",justifyContent:"space-between"},buttonHovered:{background:t.focusDiscussionInputBackground}})),[e.insetButton]);return e.count<=0?null:i()(Ke.Z,{style:t.button,onClick:e.onClick,hoveredStyle:t.buttonHovered},"show",i()("div",{style:t.moreCommentsWrapper},void 0,i()(f.FormattedMessage,{[Oe]:"{moreCommentsNumber, plural, one {{moreCommentsNumber} more comment} other {{moreCommentsNumber} more comments}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})))}const Ue=o(85).cMS,We=o(85).TmH,ze=o(85).ZG6,He=o(85).wJk,je=o(85).nx5,Ge=o(85)._fk,$e=o(85).PG2,Xe=o(85).D7I,Je=o(85).Tay,qe=o(85).$bT,Qe=o(85).u53,Ye=o(85).DIE,et=o(85).Y$2,tt=o(85).Mm1,ot=o(85).hDW,nt=o(85).xg7,it=o(85).UNs,st=o(85).$ay,rt=o(85).vIB,at=o(85).TtP,lt=o(85).cS_,dt=o(85).urI,ct=o(85).iDK,ut=o(85).DZV,mt=o(85).G3i,pt=o(85).eiN,gt=o(85).XtO,ft=o(85).zb_;function ht(e){window.__c={n:ft};const t=(0,a.useRef)(null),o=(0,d.O7)(),n=(0,u.VK)((()=>C.getCommentStores(e[gt])),[e[gt]]),s=(0,u.VK)((()=>n[pt]((e=>e[mt]()))),[n]),F=(0,a.useRef)(e[ut]||new M.Z(o,e[gt].pointer.spaceId))[ct],V=(0,u.VK)((()=>(0,x.n9)(F)),[F]),L=(0,u.VK)((()=>e[gt][mt]()),[e[gt]]),K=(0,u.VK)((()=>e[gt].getResolved()),[e[gt]]),[O,N]=(0,a.useState)(!1),[U,W]=(0,a.useState)(!1),[z,H]=(0,a.useState)(!0),j=(0,u.qz)(void 0,_.Z),G=(0,u.VK)((()=>j.state.clientRect),[j]),$=e[dt]===x.O2.Sidebar,X=e[dt]===x.O2.Margin,J=(0,a.useRef)(null);(0,c.c)(Z.Z,(()=>({isSidebarFormat:()=>$,isMarginFormat:()=>X,getStore:()=>e[gt],getInputStore:()=>F,getNode:()=>J[ct]})),[$,X,e[gt],F]);const q=(0,u.VK)((()=>{if(!$)return;return(0,x.NI)(e[gt]).find((t=>w.t({[lt]:e[gt],commentStore:t})))}),[$,e[gt]]),Q=(0,a.useRef)(q),Y=(0,u.VK)((()=>{const{showAllRepliesAfterTimestamp:t}=e,o=(()=>{var o;if(U||s[at]<=5||"block_menu"===e[rt]||"page_discussion"===e[rt])return s;const n=[t,null===(o=Q[ct])||void 0===o?void 0:o[st](),null==q?void 0:q[st]()][pt](g.isDefined),i=n[at]>0?Math.min(...n):void 0;if(i){const e=s[pt]((e=>(e[st]()||0)>i)),t=s[pt]((e=>(e[st]()||0)<=i));return t[at]<=5?s:[...r().takeRight(t,2),...e]}return r().takeRight(s,2)})(),n=new Set(o.map((e=>e.id))),i=s[pt]((e=>!n.has(e.id))),a=i[at];return{commentStores:s,commentsToShow:o,commentsToCollapse:i,remainingCommentCount:a,shouldRenderFirstComment:a>0}}),[s,q,e,U],{useDeepEqual:!0}),ee=(0,a.useCallback)((()=>{if(!e[gt][mt]())return;const t=e[gt].getContext();if(!t)return;return p.filterAnnotations(t,(t=>!p[it](t)||p[nt](t)===e[gt].id))}),[e[gt]]),te=(0,u.VK)((()=>{if(!$)return;return(0,x.NI)(e[gt]).find((t=>w.t({[lt]:e[gt],commentStore:t})))}),[$,e[gt]]),oe=a.createRef(),ne=(0,a.useRef)(e[ot].clone())[ct],ie=(0,m.yK)((t=>({discussionWrapper:{...e[dt]===x.O2.Page&&{margin:"14px -14px 14px"},...e[dt]===x.O2.Menu&&{paddingTop:10,[tt]:12,marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e[dt]===x.O2.Margin&&{[tt]:e[et]?7:14,borderRadius:3}}})),[e[et],e[dt],e.isFirst]);(0,a.useEffect)((()=>{o.KatexStore.loadIfNeeded(ee)}),[o.KatexStore,ee]);const se=t=>{const{device:n}=o;if(!n.isMobile)return;if(!e[gt][mt]())return;t[Ye](),t.preventDefault(),B.Z.setState({open:!1});const i=r().compact(D.C.findSelectablesFromIds([e[gt].getParentId()])),s=null==i?void 0:i[0];s&&S[Qe]({component:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},re=()=>{const o=(0,x.QT)(n[at]);if(!e[et])return a[Xe](T.Z,{style:{display:"flex",[qe]:"column",maxHeight:500,overflowY:"scroll"},ref:t,type:I.Z.Y,[gt]:j},n.map((t=>i()(A.default,{[gt]:t,[lt]:e[gt],[ot]:e[ot],hoveringDiscussion:O,[rt]:e[rt],[Je]:e[Je],maxLines:o},t.id))));const s=n[0]&&i()(A.default,{[gt]:n[0],[lt]:e[gt],[ot]:e[ot],hoveringDiscussion:O,[rt]:e[rt],[Je]:e[Je],maxLines:o,[et]:e[et]},n[0].id),r=n[at]>1&&n[n[at]-1]&&i()(A.default,{[gt]:n[n[at]-1],[lt]:e[gt],[ot]:e[ot],hoveringDiscussion:O,[rt]:e[rt],[Je]:e[Je],maxLines:o,[et]:e[et]},n[n[at]-1].id),l=n[at]-2;return a[Xe](a.Fragment,null,s,i()(Ne,{insetButton:!X,count:l,[$e]:ge}),r)};const ae=(0,u.VK)((()=>e[ot].getRole()),[e[ot]]),le=t[ct],de=(0,u.VK)((()=>(null==le?void 0:le.atScrollEnd())??!0),[le]),ce=z&&!e[et]&&X&&G&&t[ct]&&!de,me=()=>{l.default[ze]((()=>{t[ct]&&t[ct].scrollToBottom({animate:!0})}))},pe=r().debounce((()=>{setTimeout((()=>H(!0)),50)}),50),ge=e=>{X||(e[Ye](),W(!0))},fe=()=>{F.reset()};return i()(E.Z,{[gt]:ne,analyticsName:Ue,canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;oe[ct]&&await oe[ct].uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0},void 0,a[Xe]("div",{ref:J,style:ie.discussionWrapper,onMouseMove:()=>{R.Z.state||N(!0)},onMouseLeave:()=>{N(!1)}},function(){if(X)return re();const{commentStores:t,shouldRenderFirstComment:o,commentsToShow:n,commentsToCollapse:s}=Y,r=n.map(((t,n)=>{var s;return i()(A.default,{[gt]:t,[lt]:e[gt],[ot]:e[ot],hoveringDiscussion:O,[rt]:e[rt],[Je]:e[Je],discussionContext:!o&&e[dt]!==x.O2.Margin&&0===n&&i()(ue,{[dt]:e[dt],[rt]:e[rt],[gt]:e[gt],[ot]:e[ot],[$e]:se}),showNewBar:t.id===(null===(s=Q[ct])||void 0===s?void 0:s.id)&&0!==n},t.id)})),a=o&&i()(A.default,{[gt]:t[0],[lt]:e[gt],[ot]:e[ot],hoveringDiscussion:O,[rt]:e[rt],[Je]:e[Je],discussionContext:e[dt]!==x.O2.Margin&&L&&i()(ue,{[dt]:e[dt],[rt]:e[rt],[gt]:e[gt],[ot]:e[ot],[$e]:se})},t[0].id);return i()("div",{style:{position:"relative"}},void 0,a,$&&te&&i()(P.z,{style:vt}),i()(Ne,{insetButton:!X,count:s[at]-1,[$e]:ge}),r)}(),K?i()("div",{style:{height:8}}):a[Xe](Le,{ref:oe,showMoreCommentsButton:!!ce,onMoreCommentsClick:me,inputVisible:!e[et]||!V,[gt]:e[gt],[dt]:e[dt],[ut]:F,[rt]:e[rt],onCancel:async()=>{if((0,x.hu)(F)){await h.confirmUserAction({message:i()(f.FormattedMessage,{[je]:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:i()(f.FormattedMessage,{[je]:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})})?(fe(),e[He]&&e[He]()):(await l.default[ze](),b.setSelectionAtEnd({[gt]:F.state[We]}))}else fe(),e[He]&&e[He]()},onSubmit:async()=>{H(!1);const{device:t}=o,{[gt]:n,[rt]:i}=e;y.createAndCommit({userAction:"Discussion.handleSubmitReply",environment:o,perform:e=>{v.submitReply({environment:o,[lt]:n,textValue:F.state[We].getValue()||[],transaction:e,[rt]:i,files:F.state.files})}}),fe(),b.clear(o),me(),pe(),t.isMobile||(await l.default[ze](),b.setSelectionAtStart({[gt]:F.state[We]}))},onEditPreviousComment:()=>{const t=o.currentUser.id;if(!t)return;const n=C.getCommentStores(e[gt])[pt]((e=>e.getCreatedById()===t)),i=r().last(n);if(!i)return;const s=k.Z.find((t=>t.commentId===i.id&&t[rt]===e[rt]));s&&(b.clear(o),s.edit())},showCtaButtons:!!X||void 0,onFileUploaded:()=>{const e=D.C[Ge](ne);e&&S[Qe]({component:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},role:ae})))}const vt={marginRight:4,position:"absolute",right:16,top:14}},19195:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ct});var n=o(77094),i=o.n(n),s=o(96486),r=o.n(s),a=o(67294),l=o(1302),d=o(480),c=o(6740),u=o(81954),m=o(24405),p=o(15157),g=o(5366),f=o(50906),h=o(47307),v=o(53471),w=o(65598);const S=o(85).qqR,b=o(85).V3e;var y=o(47798),x=o(993),C=o(98104),k=o(12359),Z=o(28020),D=o(43250),I=o(78089),M=o(33929),R=o(68056),_=o(77546),B=o(80935),T=o(24666);const E=o(85).nx5,P=(0,g.defineMessages)({defaultPlaceholder:{[E]:"Add a comment…",id:"discussionInput.defaultPlaceholder.addComment"},pasteFileIntoCommentNotAllowed:{id:"clipboardActions.pasteFileIntoCommentError.message",[E]:"Sorry, you cannot paste files into a comment."},replyInputPlaceholder:{[E]:"Reply...",id:"updateSidebar.placeholder.addComment"}}),A={height:{stiffness:80,damping:12,precision:.001}};var F=o(23063),V=o(37601),L=o(3386),K=o(45653),O=o(92628),N=o(65187),U=o(97464),W=o.n(U),z=o(3909),H=o(61519),j=o(73063),G=o(1892),$=o(58032);const X=o(85).Joh,J=o(85).D7I,q=o(85).XNW,Q=o(85).E0z,Y=o(85).dLQ;const ee=function(e){window.__c={n:"CommentActionButton"};const t=(0,d.O7)(),{icon:o,onClick:n,tooltip:s}=e;return i()(G.Z,{capture:!0,render:e=>i()($.Z,{[X]:()=>s,render:i=>a[J](j.Z,W()({ariaLabel:s,icon:o,iconStyle:{width:t[Q][Y]?20:16,height:t[Q][Y]?20:16},style:{[q]:t[Q][Y]?16:10},onClick:n},i,e))})})},te=o(85).tBn,oe=o(85).TVJ,ne=o(85).$p1,ie=o(85).O8Z,se=o(85).QNi,re=o(85).nx5,ae=o(85).Yzm,le=o(85).PXg,de=o(85).jkI,ce=o(85).H1U,ue=o(85).tLG,me=o(85).$bT,pe=o(85).EMU,ge=o(85).sM5,fe=o(85).bey,he=o(85).PG2,ve=o(85).D7I,we=o(85).X_m,Se=o(85).f57,be=o(85).qc1,ye=o(85).dLQ,xe=o(85).XNW,Ce=o(85).E0z;const ke=function(e){window.__c={n:"CommentInputActionBar"};const t=(0,g.useIntl)(),o=(0,d.O7)(),{[Ce]:n}=o,s=(0,m.yK)((e=>({icon:{background:e.mediumIconColor,borderRadius:"50%",[xe]:o[Ce][ye]?16:12,[be]:Se,[we]:20,width:20},iconHovered:{background:e.lightIconColor}})),[o[Ce][ye]]),{canSend:r,visible:l,onSend:c,onCancel:u,isEditing:p,animated:f,onMention:h,onAttach:v,inline:w}=e,S={opacity:l?1:0};return i()(F.Z,{springConfig:A,isVisible:!0,animationStyle:S,render:()=>i()("div",{style:{[ge]:pe,...w?{[me]:"column-reverse",[ce]:"end",[le]:8}:{[me]:"row",position:ue,bottom:7,right:12,[ce]:de},[be]:l?void 0:"none",...f&&S}},void 0,i()("div",{style:{[ge]:pe,[me]:"row",[ce]:de}},void 0,i()(ee,{icon:z.Z.attachFile,[he]:v,[se]:t[ae]({id:"discussionInput.uploadFile.button.tooltip",[re]:"Attach file"})}),!n[ie]&&i()(ee,{icon:z.Z[ne],[he]:h,[se]:t[ae]({id:"discussionInput.insertMention.button.tooltip",[re]:"Mention a person, page, or date"})}),p&&a[ve](a[te],null,i()("div",{style:{[we]:14,[xe]:o[Ce][ye]?10:8}},void 0,i()(H.Z,{[oe]:!0,size:1})),i()(G.Z,{capture:!0,render:e=>a[ve](j.Z,W()({icon:z.Z.closeSmall,isDarkIconColor:!0,[he]:u,[fe]:{fill:"white",[we]:o[Ce][ye]?18:16,width:o[Ce][ye]?18:16},hoveredStyle:s.iconHovered,style:s.icon},e))})),i()(G.Z,p?{capture:!0,render:e=>a[ve](j.Z,W()({icon:z.Z.circleCheckFilled,[he]:c,isBlue:r,disabled:!r,[fe]:{[we]:o[Ce][ye]?23:21,width:o[Ce][ye]?23:21},style:{[xe]:o[Ce][ye]?16:12,[be]:Se,[we]:20,width:20}},e))}:{capture:!0,render:e=>a[ve](j.Z,W()({icon:z.Z.sendArrow,[he]:c,isBlue:r,disabled:!r,[fe]:{[we]:o[Ce][ye]?26:24,width:o[Ce][ye]?26:24},style:{[xe]:o[Ce][ye]?16:12,[be]:Se,[we]:20,width:20}},e))})))})};var Ze=o(30398);const De=o(85).iyY,Ie=o(85).V7c,Me=o(85).JoY,Re=o(85).wJk,_e=o(85).Bgg,Be=o(85).PG2,Te=o(85).lGm,Ee=o(85).MHP,Pe=o(85).cZW,Ae=o(85).pkR,Fe=o(85).D7I,Ve=o(85).O8Z,Le=o(85).Yzm,Ke=o(85).BQ6,Oe=o(85).JJs,Ne=o(85).FTQ,Ue=o(85).jtM,We=o(85).EHj,ze=o(85).lp0,He=o(85).dPb,je=o(85).XCs,Ge=o(85).YDv,$e=o(85).iwI,Xe=o(85).$bT,Je=o(85).EMU,qe=o(85).sM5,Qe=o(85).Mm1,Ye=o(85).aOg,et=o(85).wgE,tt=o(85).JJj,ot=o(85).iDK,nt=o(85).YRs,it=o(85).Dhe,st=o(85).fBu,rt=o(85).t4B,at=o(85).MJp,lt=o(85).ZG6,dt=o(85).AQx,ct=o(85).XtO,ut=o(85).XQm,mt=o(85).j_V,pt=o(85).q5h,gt=o(85).DZV,ft=a.forwardRef(((e,t)=>{var o;window.__c={n:"DiscussionInput"};const n=(0,d.O7)(),{device:s,currentUser:_}=n,[B,E,O]=(0,u.AF)(e[gt]),{textStore:U,files:W}=B,z=(0,u.VK)((()=>U.getValue()),[U]),[H,j]=(0,a.useState)(!1),[G,$]=(0,a.useState)(!1),X=(0,a.useRef)(null),{[pt]:J}=e,q=e[mt]!==I.O2.Page;(0,a.useImperativeHandle)(t,(()=>({uploadFiles:re})));const Q=(0,u.VK)((()=>(0,Z.getCurrentUserStore)(n)),[n]),Y=(0,a.useRef)(null===(o=e.blockStore)||void 0===o?void 0:o.clone()),ee=(0,u.VK)((()=>{const e=T.default.state;return"editing"===e.mode&&(0,R.qS)(e[ut])&&e[ut].start[ct]===U}),[U]),te=(0,u.VK)((()=>({isEmpty:(0,I.n9)(O),hasChanged:(0,I.hu)(O,J)})),[O,J]),oe=(0,u.VK)((()=>ee||!te.isEmpty),[te.isEmpty,ee]),ne=(0,a.useCallback)((async()=>{const e=T.default.state;"editing"===e.mode&&(0,R.qS)(e[ut])&&e[ut].start[ct]===U||(C[dt]({[ct]:U}),await l.default[lt]())}),[U]),ie=e=>{const t=O.state;O.setState({...t,files:t.files.filter((t=>t.id!==e.id))})},se=async e=>{await re(e.files),f[at](n,{type:"paste"})},re=(0,a.useCallback)((async t=>{var o;if(await ne(),W.length+t.length>10)return void h.showErrorMessage(i()(g.FormattedMessage,{id:"discussionInput.uploadFile.tooManyFilesErrorMessage",defaultMessage:"You cannot upload more than {maxFiles} files per comment.",values:{maxFiles:10}}));const n=t.map(v.generateLocalFileUploadMetadata);E({...B,files:[...W,...n]}),null===(o=e.onFileUploaded)||void 0===o||o.call(e)}),[ne,W,E,B,e]),ae=e[mt]===I.O2.Margin,le=e[mt]===I.O2.Sidebar;(0,a.useEffect)((()=>{e[pt]&&function(e,t){const o=w[b](t),n=v[S](o);e.setState({...e.state,files:n})}(O,e[pt])}),[O,e[pt]]);const de=(0,a.useRef)(!1),ce=(0,a.useCallback)((t=>{t?p.Z.set({userId:_.id,key:xt(e[st].id,e[it]),value:t??null}):p.Z.remove({userId:_.id,key:xt(e[st].id,e[it])})}),[_.id,e[it],e[st].id]);(0,a.useEffect)((()=>{e[nt]&&de[ot]&&ce(z),de[ot]=!0}),[e[nt],ce,z]);const ue=(0,a.useRef)(U);(0,a.useEffect)((()=>{if(e[nt]){const t=p.Z.get({userId:_.id,key:xt(e[st].id,e[it])});t&&k[tt]({userAction:"DiscussionInput.willMount",[et]:n,perform:e=>{x.setValue({[et]:n,[ct]:ue[ot],value:t,transaction:e})}})}}),[n,_.id,e[it],e[st].id,e[nt]]);const me=(0,a.useRef)(W);(0,a.useEffect)((()=>{me[ot]=W}),[W]),(0,a.useEffect)((()=>()=>{me[ot]&&me[ot].forEach((e=>{"local"===e.type&&e.dataURL&&URL.revokeObjectURL(e.dataURL)}))}),[]);const pe=!(!e[Ye]&&(e[mt]===I.O2.Page||e[mt]===I.O2.Menu)),ge=()=>{var e;return null===(e=X[ot])||void 0===e?void 0:e.focus()},fe=W&&W.length>0,he=!(e[mt]===I.O2.Menu&&e[it])&&(le||ae&&!e.isNewComment),ve=void 0!==e.showCtaButtons?e.showCtaButtons:e[Ye]||oe||H,we={[Qe]:pe&&ve?34:4},Se=!e.isMobileSlideUpMenu,be=(ae||le)&&!e.isNewComment,ye=(0,m.yK)((t=>({inputWrapper:{[qe]:Je,[Xe]:"column",alignItems:"bottom",minHeight:ae?void 0:32,width:"100%",fontSize:14,paddingTop:ae?1:4,[Qe]:ae?1:4,borderRadius:4,boxShadow:!e.isNewComment&&ae?`0px 0px 0px 1px ${t.darkDividerColor}`:void 0,transition:"background 300ms ease",background:G&&!ve&&t.focusDiscussionInputBackground||ve&&!e[Ye]&&(e.isNewComment&&ae?t[$e]:t.discussionInputActivatedBackground)||"inherit",cursor:ve?"text":"pointer",alignSelf:"center",position:"relative"}})),[G,ae,e[Ye],e.isNewComment,ve]),xe=le?23:20,Ce={fontSize:14,marginTop:le?2:3,marginBottom:2,[Ge]:6,[je]:10,maxHeight:s[rt]?"50vh":"70vh",overflowY:"auto",overflowX:"hidden",[He]:"touch",userSelect:"auto",WebkitUserSelect:"auto"},De=()=>{if(!ee)return;0===(U.getValue()||[]).length&&e.onEditPreviousComment?e.onEditPreviousComment():q&&bt(X[ot],"start")},Ie=()=>{ee&&q&&bt(X[ot],"start")},Me=()=>{ee&&q&&bt(X[ot],"end")},ft=()=>{ce(void 0),e.onSubmit()},yt=()=>{if(!s.isMobile)return void ft();const e="editing"===T.default.state.mode&&T.default.state[ut];e&&k[tt]({userAction:"DiscussionInput.handleEnter",[et]:n,perform:t=>{x.insertString({[et]:n,string:"\n",[ut]:e,disableMentions:!0,disableDateMentions:!0,[ze]:!0,[We]:!0,disableEmojiCommands:!0,transaction:t})}})},Ct=i()(ke,{visible:ve,onAttach:async()=>{const{device:e}=n;e.isIOS&&e[rt]&&!e.isTablet&&(C.clear(n),await l.default[lt]());const t=await v.openFilePicker({multiple:!0});await re(t),f[at](n,{type:"file_picker"})},onMention:async()=>{await ne(),y.lZ(n,{page:!0,createPage:!1,user:!0,bot:!0,date:!0,reminder:!1,templateVariable:!1,group:!0})},canSend:!te.isEmpty,onSend:ft,onCancel:e.onCancel,isEditing:e[Ye]||!1,animated:ae,[Ue]:!pe});return i()(L.Z,{capture:ee,onCommandEnter:r().identity},void 0,i()(St,{enabled:!!Y[ot]&&!!e.canDrop,[ct]:Y[ot],onNativeDrop:async e=>{let{files:t}=e;await re(t),f[at](n,{type:"drop"})}},void 0,i()("div",{[Te]:e[Ye]?D.discussionInputEditExistingComment:D.discussionInput,[Ke]:{...ht,...e[Ne]||{}},onFocus:e=>{const t=e.target;t instanceof HTMLElement&&(0,c.E)(t)&&j(!0)},onBlur:()=>j(!1),onMouseOver:()=>$(!0),onMouseOut:()=>$(!1)},void 0,i()("div",{[Ke]:vt},void 0,e.showAvatar&&i()(K.Z,{[Oe]:Q,size:xe,avatarShouldShowShadow:!0,[Ke]:wt}),i()(F.Z,{springConfig:A,[_e]:!0,animationStyle:we,render:()=>i()("div",{[Te]:he?D.focusableWithin:"",[Be]:ge,[Ke]:{...ye.inputWrapper,...ae&&we},tabIndex:-1},void 0,i()("div",{[Ke]:{flexGrow:1,[qe]:Je}},void 0,a[Fe](N.Z,{[Ke]:Ce,[ct]:U,[st]:e[st],[Ae]:!1,onEnter:yt,onPasteFiles:se,onEsc:e.onCancel,onUp:De,onLeft:Ie,onRight:Me,onDown:Me,[Pe]:M.default[Le](be?P.replyInputPlaceholder:P.defaultPlaceholder),ref:X,isDiscussionInput:!0,[We]:!0,disableInsertText:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEmbedMenu:!0,[ze]:!0,disableMobileActionBar:!0,[Ee]:s[Ve],pasteBehavior:Ue}),!pe&&Ct),fe&&i()("div",{[Ke]:{[Qe]:pe?8:0,[Ge]:8,[je]:8}},void 0,i()(Ze.Z,{files:W,onRemoveFile:ie})),pe&&Ct)}),Se&&i()(V.Z,{show:ee,[Re]:()=>C.clear(n)})))))})),ht={[qe]:Je,[Xe]:"column",width:"100%",cursor:"pointer"},vt={[qe]:Je,alignItems:"center",flexGrow:1},wt={flexShrink:0,flexGrow:0,marginRight:6,alignSelf:"flex-start",marginTop:6};function St(e){const{enabled:t,children:o,[ct]:n,onNativeDrop:s}=e;return t&&n?i()(O.Z,{[ct]:n,analyticsName:"discussion_input",canNativeDropOnto:!0,onNativeDrop:s,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0},void 0,o):a[Fe](a.Fragment,null,o)}function bt(e,t){if(!e)return;const o=e.getNode();if(!(o&&o instanceof HTMLElement)||document.activeElement!==o)return;const n=o[Me];if(!n)return;const i=yt(n);if(!i)return;const s=i[Ie],r=B.toStaticRange(B.get());if(!r)return;const a=()=>{i[Ie]=s,"start"===t?C.setSelectionAtStart({[ct]:e.props[ct]}):C[dt]({[ct]:e.props[ct]})};window[De]((()=>{const e=Math.abs(i[Ie]-s),n=B.toStaticRange(B.get()),l=document.activeElement!==o;if(!n)return;const d=!B.areRangesEqual(r,n),c=o.contains(n.startContainer)&&o.contains(n.endContainer);let u=!1;var m;0!==e&&(m=i,Math.abs(m.scrollHeight-m.clientHeight-m[Ie])<1)&&!l&&!d?u=!0:c||(u=!0),u&&(o.focus(),a(),window[De]((()=>{a(),"end"===t&&window[De](a)})))}))}function yt(e){const t=(0,_.VW)(e);return t&&t[Ke].maxHeight&&t[Me]?yt(t[Me]):t}function xt(e,t){return t?`UnsentDiscussion-${e}-${t}`:`UnsentDiscussion-${e}`}const Ct=ft},30398:(e,t,o)=>{o.d(t,{Z:()=>ae});var n=o(77094),i=o.n(n),s=o(67294),r=o(81954),a=o(24405),l=o(3909),d=o(73744),c=o(34859),u=o(45589),m=o(73063),p=o(18647),g=o(480),f=o(95538),h=o(95477),v=o(1533),w=o(64921),S=o(54604),b=o(71669),y=o(81865);const x=o(85).H1U,C=o(85).jkI,k=o(85).UPJ;function Z(e){window.__c={n:"FullScreenImage"};const{url:t,imageNaturalHeight:o,imageNaturalWidth:n}=e,r=(0,s.useMemo)((()=>({display:"block",width:`min(${n}px, 100%)`,height:`min(${o}px, 100%)`,pointerEvents:"auto",objectFit:"cover"})),[n,o]);return i()("div",{style:D},void 0,i()(b.Z,{src:t,style:r,placeholderLoadedStyle:{display:"flex",[k]:C,[x]:C}}))}const D={alignSelf:C,margin:"0 auto",position:"relative",height:"100%",width:"100%",overflow:"hidden"},I=o(85).D7I,M=o(85).I9F,R=o(85).Ifi,_=o(85).c8b,B=o(85).fHO;const T=function(e){window.__c={n:"DiscussionInputImageRenderer"};const t=(0,s.useRef)(null),{file:o}=e,n=(0,g.O7)(),r=(0,a.yK)((e=>({[B]:{borderRadius:3,border:`1px solid ${e.lightDividerColor}`,objectFit:"cover",height:48,width:48,cursor:"zoom-in"}})),[]),l=(0,s.useCallback)((()=>{var e;const n=null===(e=t.current)||void 0===e?void 0:e[_]();if(!n)return;const{naturalHeight:s,naturalWidth:r}=n;return"local"===o.type?i()(Z,{url:o.dataURL,imageNaturalHeight:s,imageNaturalWidth:r}):i()(y.Z,{url:o.source,render:(e,t)=>i()(Z,{url:t,error:e,imageNaturalHeight:s,imageNaturalWidth:r}),[R]:!0,[M]:o.store.pointer})}),[o]),d=(0,s.useCallback)((e=>{var o;e.stopPropagation();const i=null===(o=t.current)||void 0===o?void 0:o[_]();i&&S.openFullscreen({environment:n,renderFullScreenNode:l,fullScreenNodeRect:i.clientRect,contentAspectRatio:i.naturalHeight/i.naturalWidth})}),[l,n]);return"local"===o.type?s[I](b.Z,{src:o.dataURL,style:r[B],placeholderStyle:r[B],onClick:d,ref:t}):i()(y.Z,{url:o.source,[R]:!0,[M]:o.store.pointer,render:(e,o)=>s[I](b.Z,{src:o,style:r[B],placeholderStyle:r[B],onClick:d,ref:t})})};var E=o(82990);const P=o(85).C_1,A=o(85).OM8,F=o(85).jkI,V=o(85).UPJ,L=o(85).Ixx,K=o(85).nAm;function O(e){window.__c={n:"DiscussionInputFileRenderer"};const{file:t,type:o}=e,n=(0,a.Fg)(),r=(0,s.useMemo)((()=>({doc:{title:"DOC",color:n.msDocDiscussionInputPreview},docx:{title:"DOCX",color:n.msDocDiscussionInputPreview},xls:{title:"XLS",color:n.msExcelDiscussionInputPreview},xlsx:{title:"XLSX",color:n.msExcelDiscussionInputPreview},pdf:{title:"PDF",color:n.pdfDiscussionInputPreview},video:{icon:l.Z.videoAttachment}})),[n]),d=(0,a.yK)((e=>{const t=r[o];return{wrapper:{height:48,width:220,display:"flex",background:"transparent",borderRadius:5,overflow:K,border:`1px solid ${e.regularDividerColor}`},fileTypeArea:{background:null!=t&&t.color?t.color:e[L],height:48,width:48,display:"flex",[V]:F,alignItems:F,flexShrink:0},icon:{height:26,width:26,fill:e.regularIconColor},fileType:{fontSize:11,[A]:"16.8px",fontWeight:E.Z.fontWeight.semibold,color:e[P]},fileDescription:{padding:"6px 12px 6px 12px",display:"flex",flexDirection:"column",[V]:F,overflow:K},fileTitle:{color:e.regularTextColor,textOverflow:"ellipsis",fontSize:14,[A]:"19.6px",whiteSpace:"nowrap",overflow:K,width:"100%",paddingBottom:20},fileSize:{color:e.lightTextColor,fontSize:12,[A]:"16.8px",width:"100%"}}}),[o,r]),c=r[o];return i()("div",{style:d.wrapper},void 0,i()("div",{style:d.fileTypeArea},void 0,null!=c&&c.title?i()("div",{style:d.fileType},void 0,c.title):null!=c&&c.icon?c.icon(d.icon):l.Z.fileAttachment(d.icon)),i()("div",{style:d.fileDescription},void 0,i()("div",{style:d.fileTitle},void 0,t.name),i()("div",{style:d.fileSize},void 0,t.size)))}const N=o(85).W_R,U=o(85).j_T,W=o(85).znQ,z={image:T,pdf:O,doc:O,xls:O,embed:O},H={[W]:"docx","application/msword":"doc","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",image:"image"};function j(e){return"local"===e.type?function(e){const[t]=e.split("/");return H[e]||H[t]}(e.file.type)||(0,f.Dz)({url:e.file.name,baseUrl:h.default[U],[N]:h.default[N]}):(0,f.y_)(e.source,".doc")?"doc":(0,f.y_)(e.source,".docx")?"docx":(0,f.y_)(e.source,".xls")?"xls":(0,f.y_)(e.source,".xlsx")?"xlsx":(0,f.Dz)({url:e.source,baseUrl:h.default[U],[N]:h.default[N]})}function G(e){let{file:t,onRemoveFile:o,disableRemove:n}=e;window.__c={n:"DiscussionInputFilePreview"};const[{hovered:a},,d]=(0,r.AF)(void 0,v.Z),c=(0,s.useCallback)((()=>null==o?void 0:o(t)),[t,o]),u=(0,g.O7)(),p=!n&&(a||u.device.isMobile);(0,s.useEffect)((()=>()=>{"local"===t.type&&t.dataURL&&URL.revokeObjectURL(t.dataURL)}),[t]);const f=j(t),h=z[f]||O;return i()(w.Z,{store:d,style:J,hoveredStyle:$,pressedStyle:X},void 0,i()(h,{file:t,type:f}),p&&i()(m.Z,{icon:l.Z.closeSmall,style:q,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:c}))}const $={background:"none"},X={background:"none"},J={display:"flex",alignItems:"center",justifyContent:"center",position:"relative",paddingRight:"10px",cursor:"pointer"},q={position:"absolute",top:"-5px",right:"6px",height:18,width:18,borderRadius:18,padding:4},Q=o(85).D7I,Y=o(85).JgC,ee=o(85).A_N,te=o(85).c_y,oe=o(85).DIE,ne=o(85).gdQ,ie=o(85).bey,se=o(85).Hco,re=o(85).Scd;function ae(e){window.__c={n:"DiscussionInputFilmStrip"};const t=(0,s.useRef)(null),o=(0,a.yK)((e=>({leftArrowStyle:{left:10,top:26,[re]:e[se],...ce},rightArrowStyle:{right:10,top:26,[re]:e[se],...ce},[ie]:{height:6,fill:e.contentBackground},[ne]:{[re]:e.regularIconColor}})),[]),[{scrollLeft:n,scrollWidth:g,clientWidth:f},,h]=(0,r.AF)(void 0,u.Z),v=(0,s.useCallback)((e=>{var o;e[oe](),null===(o=t.current)||void 0===o||o[te](0,-.8*f,{animate:!0})}),[f]),w=(0,s.useCallback)((e=>{var o;e[oe](),null===(o=t.current)||void 0===o||o[te](0,.8*f,{animate:!0})}),[f]),S=(0,s.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.getClientRect()}),[]);(0,s.useEffect)((()=>(d[ee](window,"resize",S),()=>{d[Y](window,"resize",S)})),[S]);const b=(0,s.useMemo)((()=>Math.floor(n)>0),[n]),y=(0,s.useMemo)((()=>Math.ceil(n+f)<g),[n,g,f]);return(0,s.useEffect)((()=>{S()}),[e.files,S]),0===e.files.length?null:i()("div",{style:de},void 0,s[Q](p.Z,{style:le,ref:t,type:c.Z.X,onScroll:S,zIndex:0,store:h},e.files.filter((e=>"local"===e.type||Boolean(e.source))).map((t=>i()(G,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove},t.id)))),b&&i()(m.Z,{icon:l.Z.collectionTimelineArrowLeft,hovered:!1,showShadow:!0,onClick:v,style:o.leftArrowStyle,[ie]:o[ie],[ne]:o[ne]}),y&&i()(m.Z,{icon:l.Z.collectionTimelineArrowRight,hovered:!1,showShadow:!0,onClick:w,style:o.rightArrowStyle,[ie]:o[ie],[ne]:o[ne]}))}const le={overflow:"scroll",display:"flex",alignItems:"flex-start",flexDirection:"row",paddingTop:10},de={display:"flex",paddingRight:0,position:"relative"},ce={position:"absolute",borderRadius:3,width:16,height:16,opacity:1,flexShrink:0,boxShadow:"none"}},16378:(e,t,o)=>{o.r(t),o.d(t,{default:()=>N});var n=o(77094),i=o.n(n),s=o(67294),r=o(480),a=o(81954),l=o(24405),d=o(7476),c=o(78089),u=o(10663),m=o(13884),p=o(36488),g=o(56940),f=o(44532),h=o(37064),v=o(73935),w=o(83355),S=o(14568),b=o(49085);class y extends b.default{getInitialState(){return{}}}const x=y,C=o(85).QP$,k=o(85).jx6,Z=o(85).$DE;class D extends w.Z{constructor(){super(...arguments),this.storeTypes={store:x},this.rootNode=void 0,this[Z]=void 0,this[k]=()=>{this.rootNode&&this.stores.store.setState({node:this.rootNode})}}get registries(){return[S.Z]}didMount(){this.props.capture&&this[C]()}willUpdate(e){e.capture&&!this.props.capture?this[C]():!e.capture&&this.props.capture&&this.stopListeners()}willUnmount(){this.stopListeners()}[C](){const e=v.findDOMNode(this);e&&(this.rootNode=e,this[Z]=new MutationObserver(this[k]),this[Z].observe(this.rootNode,{attributes:!0,subtree:!0}))}stopListeners(){this[Z]&&(this[Z].disconnect(),this.rootNode=void 0,this[Z]=void 0)}renderComponent(){return s.Children.only(this.props.children)}}D.displayName="SlideUpInputArea";const I=D;var M=o(19195);const R=o(85)._lc,_=o(85).rpY,B=o(85).j_V,T=o(85).YRs,E=o(85).fBu,P=o(85).K07,A=o(85).XCs,F=o(85).XeC,V=o(85).t4B,L=o(85).YDv,K=o(85).DZV,O=o(85).hDW;const N=function(){window.__c={n:"NewDiscussionMenu"};const e=(0,r.O7)(),{device:t,WindowSizeStore:o}=e,n=(0,a.VK)((()=>m.Z.state.rect),[]),s=(0,a.VK)((()=>{if(m.Z.state.open){const{[O]:t,[K]:o}=m.Z.state;return{[O]:t,[K]:o,canMarginCommentsRender:(0,u.az)(e,t)}}return null}),[e]),v=(0,a.VK)((()=>({[L]:t[V]?o[F](10):10,[A]:t[V]?o[P](10):10})),[o,t[V]]),w=(0,l.yK)((()=>({inputWrapper:{width:t[V]?"100%":470,maxWidth:t.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:t.isAndroid?12:8,[L]:v[L],[A]:v[A]}})),[t,v]),S=()=>{d.ZL(e)},b=()=>{s&&d.uK(s[K],e)};return null!=s&&s.canMarginCommentsRender?null:i()(f.ZP,{popupType:t[V]?f.ZP[R].SlideUp:f.ZP[R].Popup,keepFocus:!0,open:null!==s,originRect:n,placementToOrigin:f.ZP.Placement.Bottom,alignmentToOrigin:f.ZP.Alignment.Center,originGap:4,onDismiss:b,[_]:()=>{if(s){const{[O]:e,[K]:t}=s;return i()(g.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,[_]:()=>i()(I,{capture:!0},void 0,i()(p.Z,{capture:!0,allowOpenLinkMenu:!0,[_]:()=>i()(h.Z,{store:e,droppable:!0,[_]:()=>i()("div",{style:w.inputWrapper},void 0,i()(M.default,{showAvatar:!0,[E]:e,onCancel:b,onSubmit:S,[K]:t,isMobileSlideUpMenu:!0,[T]:!1,[B]:c.O2.Page,[O]:e,canDrop:!0}))},e.id)}))})}}})}},82899:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Re,openEmojiMenuForReaction:()=>Me});var n=o(97464),i=o.n(n),s=o(77094),r=o.n(s),a=o(67294),l=o(73935),d=o(480),c=o(81954),u=o(24405),m=o(8848),p=o(3909),g=o(97880),f=o(82990),h=o(5366),v=o(27153),w=o(4615),S=o(98459),b=o(80396),y=o(19889),x=o(94419),C=o(39098),k=o(50906),Z=o(9953),D=o(12359);const I=o(85).J$i,M=o(85).BvK,R=o(85).LCr,_=o(85).wgE,B=o(85).vIB,T=o(85).G3i,E=o(85).q5h;function P(e){const{[B]:t,[_]:o,[R]:n,[E]:i,icon:s}=e,r=function(e){let{[E]:t,icon:o}=e;const n=(0,C.Vh)(t,t.pointer,"reactions").getValue();if(void 0===n)return;return n.map((e=>{const o=C.t1.createChildStore(t,{table:b.yo,id:e,spaceId:(0,S.CG)(t.pointer.spaceId)});if(o[T]())return o})).filter(g.isDefined).find((e=>e.getIcon()===o))}({[E]:i,icon:s});if(void 0===o.currentUser.id)return;const a={table:y.KJ,id:o.currentUser.id};null!=r&&r[T]()?function(e){var t;let{store:o,actorPointer:n,[R]:i,[_]:s,[B]:r}=e;const a={store:o,actorPointer:n,[R]:i,[_]:s,[B]:r};(null===(t=o.getActors())||void 0===t?void 0:t.some((e=>e.id===n.id)))?function(e){const{store:t,actorPointer:o,[B]:n,[R]:i,[_]:s}=e;if(!t[T]())return;k.trackRemoveReaction({[_]:s,reaction_value:t.getIcon(),comment_id:t.getParentId(),reaction_count:t.getActors().length??0,from:n});const r=t.getModel();D[M]({[R]:i,store:t,operation:r.ops.removeActor(o)})}(a):function(e){const{store:t,actorPointer:o,[B]:n,[R]:i,[_]:s}=e;if(!t[T]())return;k.trackAddReaction({[_]:s,reaction_value:t.getIcon(),comment_id:t.getParentId(),reaction_count:t.getActors().length??0,from:n});const r=t.getModel();D[M]({[R]:i,store:t,operation:r.ops.appendActor(o)})}(a)}({[_]:o,store:r,actorPointer:a,[R]:n,[B]:t}):function(e){let{[_]:t,[R]:o,[E]:n,icon:i,currentActorPointer:s,[B]:r}=e;const a=(0,w.default)();k.trackAddReaction({[_]:t,reaction_value:i,comment_id:n.id,reaction_count:0,from:r});const l=Z.create({[_]:t,table:b.yo,args:{id:a,spaceId:(0,S.CG)(n.pointer.spaceId),commentId:n.id,icon:i,actorPointer:s},[I]:n[I],[R]:o}),d=(0,C.Vh)(n,n.pointer,"reactions");x.append({parent:d,append:l,[R]:o})}({[_]:o,[R]:n,[E]:i,icon:s,currentActorPointer:a,[B]:t})}var A=o(64921),F=o(92059),V=o(73063),L=o(58032),K=o(38797),O=o(87279);const N=o(85).kdG;var U=o(31945),W=o(78140),z=o(28992),H=o(66957),j=o(72893);const G=o(85).D7I,$=o(85).rGB,X=o(85).q5h,J=o(85).$W2,q=o(85).jkI,Q=o(85).UPJ;function Y(e){let{reactionStores:t,initialIndex:o}=e;window.__c={n:"ReactionSheetContent"};const[n,i]=a.useState(o),s=(0,h.useIntl)(),l=(0,c.VK)((()=>t.map((e=>e.getIcon()))),[t]),d=(0,c.VK)((()=>t[n].getActorStores().map((e=>({id:e.id,store:e,name:e.getDisplayName(s)}))).filter(g.isDefined)),[t,n,s]);return r()(W.Z,{menuType:O.og.ActionSheet},void 0,r()(H.Z,{tabStyle:{flex:1,[Q]:q,display:"flex",minWidth:60},tabs:l,selectedIndex:n,onChange:e=>i(e)}),d.map((e=>r()(z.Z,{title:e.name,dontShrinkIcon:!0,icon:r()(j.S,{authorStore:e.store,[J]:20,avatarStyle:{width:20,height:20},placeholderStyle:{width:20,height:20}})},e.id))))}function ee(e){window.__c={n:"ReactionSheet"};const t=(0,d.Fy)(),o=(0,c.VK)((()=>e[X].getUserVisibleReactions()),[e[X]]),n=(0,a.useRef)(null),i=function(e){const t=(0,d.O7)(),{onLongPress:o,hapticsEnabled:n=!0,timeout:i=300}=e,s=(0,a.useCallback)((()=>{var e,i,s;n&&(null!==(e=t[N])&&void 0!==e&&e.buzz?t[N].buzz():null===(i=(s=window.navigator).vibrate)||void 0===i||i.call(s,20)),o()}),[t[N],n,o]),r=(0,a.useRef)(),l=(0,a.useCallback)((()=>clearTimeout(r.current)),[]);return(0,a.useEffect)((()=>l),[l]),{onTouchStart:(0,a.useCallback)((()=>{clearTimeout(r.current),r.current=setTimeout(s,i)}),[i,s]),onTouchEnd:l,onTouchCancel:l}}({onLongPress:()=>{var e;return null===(e=n.current)||void 0===e?void 0:e.setOpen(!0)}});if(!t.isMobile)return a[G](a.Fragment,null,e[$]);const s=o.findIndex((t=>!e.reactionStore||t===e.reactionStore))??0;return a[G](U.ZP,{ref:n,key:e[X].id,renderOrigin:()=>a[G]("div",i,e[$]),popupType:t.isTablet?U.Z4.Popup:U.Z4.SlideUp,render:()=>r()(Y,{initialIndex:s,reactionStores:o})})}const te=o(85).G3i,oe=o(85).LCr,ne=o(85).Drs,ie=o(85).wgE,se=o(85).JJj,re=o(85).Omf,ae=o(85).iDK,le=o(85).Yzm,de=o(85).Hco,ce=o(85).L_E,ue=o(85).vIB,me=o(85).q5h,pe=o(85).nx5,ge=o(85).S6b,fe=o(85).D7I,he=o(85).TtP,ve=o(85).PG2,we=o(85).pkR,Se=o(85).qKK,be=o(85).L97,ye=o(85).Scd,xe=o(85).Exd;function Ce(){const{isMobile:e}=(0,d.Fy)();return(0,u.yK)((t=>({reaction:{display:"flex",margin:"1px",padding:"1px 6px 1px 6px",justifyContent:"center",gap:"4px",border:`1px solid ${t.regularDividerColor}`,borderRadius:"100px",[xe]:14,lineHeight:"20px",fontVariantNumeric:"tabular-nums",[ye]:t[be]},count:{color:t.mediumTextColor,[xe]:e?f.Z[xe].UISmall.mobile:f.Z[xe].UISmall.desktop,lineHeight:"20px"},countReacted:{color:t.blueColor},reacted:{[ye]:m.ZP[Se](.08),border:`1px solid ${t.filterPillBorder}`,fontWeight:500},reactedHover:{[ye]:m.ZP[Se](.18)},emojiStyle:{color:"black",display:"inline-block"}})),[e])}function ke(e){let{store:t,[we]:o,[ve]:n}=e;window.__c={n:"Reaction"};const s=(0,c.VK)((()=>t.getActors()),[t]),l=(0,c.VK)((()=>t.getIcon()),[t]),u=Ce(),{currentUser:m}=(0,d.O7)();if(!s||!l)return null;if(0===s[he])return null;const p=s.some((e=>e.id===m.id)),g={...u.reaction,...p&&u.reacted},f={...u.count,...p&&u.countReacted};return r()(L.Z,{placement:L.Z.Placement.Bottom,delayThreshold:300,renderTooltip:()=>r()(Ze,{store:t,icon:l}),render:e=>a[fe](A.Z,i()({[we]:o,style:g,hoveredStyle:p?u.reactedHover:void 0,[ve]:n},e),r()("span",{style:u.emojiStyle},void 0,r()(F.Z,{size:14,char:l})),r()("span",{style:f},void 0,s[he]))})}function Ze(e){let{store:t,icon:o}=e;window.__c={n:"ReactionTooltip"};const n=(0,u.yK)((e=>({text:{color:e[ge]}})),[]),i=(0,h.useIntl)(),s=(0,c.VK)((()=>t.getActorStores()),[t]),a=(0,c.VK)((()=>s.map((e=>e.getDisplayName(i))).filter(g.isDefined)),[s,i]);return r()(h.FormattedMessage,{[pe]:"{numberOfNames, plural, one {{nameOrNames} <medium>reacted with</medium> {icon}} other {{nameOrNames} <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.text",values:{numberOfNames:a[he],nameOrNames:a.join(", "),medium:e=>r()("span",{style:n.text},void 0,e),icon:r()(F.Z,{size:14,char:o})}})}function De(e){let{[me]:t,[ue]:o,onEmojiSelection:n}=e;window.__c={n:"NewReaction"};const i=(0,d.O7)(),s=(0,a.useRef)(null),l=(0,d.Fy)(),c=(0,u.yK)((e=>({[ce]:{padding:2,display:"flex",boxShadow:e.lightBoxShadow,backgroundColor:e.buttonGroupBackground,borderRadius:l.isMobile?3:4},addIcon:{width:15,fill:e[de]},iconButton:{height:22,width:22,flex:"0 0 auto"}})),[l.isMobile]),m=(0,h.useIntl)();return r()("div",{style:c[ce]},void 0,a[fe](V.Z,{hasBackground:!0,ariaLabel:m[le]({[pe]:"Add reaction",id:"ReactionBar.newReaction.ariaLabel"}),showShadow:!1,icon:()=>p.Z.reactionAdd(c.addIcon),style:c.iconButton,ref:s,[ve]:()=>Me(i,m,t,null==s?void 0:s[ae],o,n)}))}function Ie(e){let{[me]:t,[ue]:o,onEmojiSelection:n}=e;window.__c={n:"NewInlineReaction"};const i=(0,u.Fg)(),s=(0,d.O7)(),r=(0,a.useRef)(null),l=Ce(),c=(0,h.useIntl)(),m=p.Z.reactionAdd({width:15,height:20,marginTop:.5,marginLeft:.5,fill:i[de]});return a[fe](A.Z,{style:{...l.reaction,minWidth:"2em"},ref:r,[ve]:()=>Me(s,c,t,null==r?void 0:r[ae],o,n)},m)}function Me(e,t,o,n,i,s){const a=l.findDOMNode(n);if(!a)return;if(!(a instanceof Element))return;const d=a[re]();v.show(e,{originGap:4,originRect:d,popupWidth:K.ZP.desktopPopupWidth,popupHeight:K.ZP.desktopPopupHeight,isSmallWidth:!1,title:t[le]({[pe]:"Reaction",id:"ReactionBar.emojiModalMenu.title"}),currentTab:"emoji",tabs:[{type:"emoji",title:r()(h.FormattedMessage,{[pe]:"Emojis",id:"recordIcon.emojiTab.title"}),hideRandomButton:!0,onChange:(t,n)=>{s&&s(),D[se]({[ie]:e,[ne]:"Comment.toggleReactionFromMenu",perform:s=>{P({[ie]:e,[oe]:s,[me]:o,icon:t,[ue]:i}),n&&n.keepVisible||v.clear()}})}}]})}const Re=function(e){let{parentStore:t,[ue]:o,[ve]:n}=e;window.__c={n:"ReactionBar"};const i=(0,c.VK)((()=>t.canComment()),[t]),s=(0,c.VK)((()=>t.getUserVisibleReactions()),[t]),a=(0,d.O7)();return r()("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"4px",marginBottom:"4px"}},void 0,s.map((e=>r()(ee,{reactionStore:e,[me]:t},e.id,r()(ke,{[we]:!i,store:e,[ve]:()=>{e[te]()&&(n&&n(),D[se]({[ie]:a,[ne]:"Comment.toggleReaction",perform:n=>{P({[ie]:a,[oe]:n,[me]:t,icon:e.getIcon(),[ue]:o})}}))}})))),i&&s[he]>0&&r()(ee,{[me]:t},void 0,r()(Ie,{[me]:t,[ue]:o,onEmojiSelection:n})),i&&0===s[he]&&r()(De,{[me]:t,[ue]:o,onEmojiSelection:n}))}},51477:(e,t,o)=>{o.r(t),o.d(t,{default:()=>rt});var n=o(77094),i=o.n(n),s=o(67294),r=o(480),a=o(81954),l=o(24405),d=o(78316),c=o(10663),u=o(82136),m=o(23063),p=o(96486),g=o(14577),f=o(44805),h=o(80503),v=o(51454),w=o(96514),S=o(39500),b=o(49427),y=o(24229),x=o(35973),C=o(13884),k=o(50628),Z=o(7011),D=o(97464),I=o.n(D),M=o(97880),R=o(41432),_=o(3909),B=o(21202),T=o(19889),E=o(82990),P=o(5366),A=o(43250),F=o(65598),V=o(16402),L=o(39098),K=o(76798),O=o(64369),N=o(67706),U=o(72893);const W=o(85).lzS,z=o(85).tBn,H=o(85).D7I,j=o(85).nx5,G=o(85).TtP,$=o(85).BQ6,X=o(85).$W2,J=o(85).TEz,q=o(85).cMN,Q=o(85).XNW,Y=o(85).NLk,ee=o(85).Exd,te=o(85).H1U,oe=o(85).jkI,ne=o(85).UPJ,ie=o(85).PXg,se=o(85).EMU,re=o(85).sM5,ae=o(85).NF1,le=o(85).cMS,de=o(85).TLr,ce=o(85).G80,ue=o(85).cS_;function me(e){let{discussionData:{groupedDiscussionsData:t,id:o},onClick:n}=e;window.__c={n:"GroupedMarginDiscussionItem"};const[r,d]=(0,s.useState)(!1),u=(0,s.useCallback)((()=>{d(!0)}),[]),m=(0,s.useCallback)((()=>{d(!1)}),[]),p=(0,s.useCallback)((async e=>{const o=t[0][ue];await n(e,o)}),[n,t]),g=(0,a.VK)((()=>t.flatMap((e=>(0,F.getCommentStores)(e[ue])))),[t]),f=(0,a.VK)((()=>{const e=t[0][ce];return[...new Set(g.map((e=>e.getCreatedById())).filter(M.isDefined))].map((t=>L.U6[de](e,{table:T.KJ,id:t}))).slice(0,3)}),[t,g]),h=(0,a.VK)((()=>{const e=t[0].closestVisibleParentId,o=t[0][ce];if(!e)return;const n=L.G[de](o,{table:B.iU,id:e}),i=n.getParentStore();return i&&i.table===B.iU&&i.getType()===R.Ti.tab?n:void 0}),[t]),v=(0,a.VK)((()=>{const e=g.map((e=>e.getLastEditedTime()));return Math.max(...e)}),[g]),w=(0,l.yK)((e=>({[le]:{border:`1px solid ${e.regularDividerColor}`,[ae]:3,background:r?e.hoveredMarginDiscussionBackground:e.contentBackground,width:c.Z,[re]:se,padding:"10px 12px",cursor:"pointer"},userAvatarsContainer:{[re]:se,[ie]:6,[ne]:oe,[te]:oe,flexDirection:"row-reverse"},hiddenUsers:{[ee]:14,color:e.mediumTextColor,[ie]:6},commentCount:{[ee]:14,fontWeight:E.Z.fontWeight.semibold,[Y]:"normal",[Q]:6},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,[ae]:3,[Q]:4},[q]:{margin:"1px 0px 0px 6px",[Y]:"normal",[re]:se,[ne]:oe,[te]:oe,lineHeight:"21px"},commentAuthorAvatarStyle:{width:20,height:20,[ae]:20,[ie]:-3,position:"relative",userSelect:"none",WebkitUserSelect:"none"},commentAuthorPlaceholderStyle:{width:20,height:20,[ae]:20,[ie]:-3,position:"relative"},secondaryLabel:{[ee]:E.Z[ee].UISmall.desktop,[Q]:4,color:e[J],marginTop:1,[Y]:"normal",[re]:se,[ne]:oe,[te]:oe,lineHeight:"21px"},expandIcon:{width:E.Z[ee].UISmall.desktop,height:E.Z[ee].UISmall.desktop,fill:e[J],marginTop:1}})),[r]);return i()("div",{[$]:w[le],onMouseEnter:u,onMouseLeave:m,onClick:p,className:A.marginDiscussionItem},void 0,s[H](s[z],null,i()("div",{[$]:w.userAvatarsContainer},void 0,f.map((e=>i()(U.S,{authorStore:e,[X]:20,avatarStyle:w.commentAuthorAvatarStyle,placeholderStyle:w.commentAuthorPlaceholderStyle},e.id)))),g[G]>0?i()("div",{[$]:w.commentCount},void 0,i()(P.FormattedMessage,{[j]:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:g[G]}})):i()("div",{[$]:w.textPlaceholder}),r?s[H](s[z],null,i()("div",{[$]:{[Q]:10,[re]:se,[ne]:oe,[te]:oe}},void 0,_.Z.expand(w.expandIcon)),i()("div",{[$]:w.secondaryLabel},void 0,i()(P.FormattedMessage,{[j]:"Expand",id:"marginComments.collapsed.expand.label"}))):v&&i()(O.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,[$]:w[q]},void 0,i()(N.Z,{text:(0,V.IS)(v),tooltipText:(0,V.uy)(v),icon:_.Z[W]})),h&&i()("div",{[$]:w.secondaryLabel},void 0,i()(K.Z,{store:h,maxLength:10}))))}var pe=o(74725),ge=o(7476),fe=o(78089),he=o(19195);const ve=o(85).FTQ,we=o(85).j_V,Se=o(85).YRs,be=o(85).iwI,ye=o(85).cMS,xe=o(85).DZV,Ce=o(85).G80;function ke(e){let{discussionData:{[Ce]:t,[xe]:o},isVisible:n}=e;window.__c={n:"NewMarginDiscussionItem"};const a=(0,s.useRef)(null),d=(0,r.O7)(),u=(0,s.useCallback)((()=>{ge.ZL(d)}),[d]),m=(0,s.useCallback)((()=>{ge.uK(o,d)}),[d,o]),p=(0,s.useMemo)((()=>[`.${A.overlayContainer}`]),[]);(0,pe.O)({active:n,closeHandler:m,ref:a,excludedSelectors:p,ignoreKeydown:!0});const g=(0,l.yK)((e=>({[ye]:{borderRadius:3,boxShadow:e.marginDiscussionSelectedShadow,width:c.Z,background:e[be]},discussionInputContainer:{borderRadius:3,padding:"6px 4px 4px 8px"}})),[]);return s.createElement("div",{style:g[ye],ref:a,className:A.marginDiscussionItem},i()(he.default,{parentStore:t,[xe]:o,[Se]:!1,isMobileSlideUpMenu:!1,[we]:fe.O2.Margin,onSubmit:u,onCancel:m,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,[ve]:g.discussionInputContainer,showCtaButtons:!0}))}var Ze=o(80357),De=o(50906),Ie=o(54564),Me=o(89574),Re=o(87404),_e=o(97543);const Be=o(85).DZV,Te=o(85).vIB,Ee=o(85).Tay,Pe=o(85).gTZ,Ae=o(85).iwI,Fe=o(85).cMS,Ve=o(85).tge,Le=o(85).G80,Ke=o(85).cS_;function Oe(e){let{discussionData:{[Ke]:t,[Le]:o},timeMounted:n,onClick:a,isVisible:d,isDiscussionSelected:u,isDiscussionHovered:m}=e;window.__c={n:"SingleMarginDiscussionItem"};const p=(0,s.useRef)(null),g=(0,r.O7)(),[f,h]=(0,s.useState)((()=>new Re.Z(g,t.pointer.spaceId))),v=t.id,w=(0,s.useMemo)((()=>[`.${(0,Ze.dk)({discussionId:v})}`,`.${A.overlayContainer}`,`.${A.marginDiscussionItem}`]),[v]),S=(0,s.useCallback)((async()=>{const e=Me.Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}Ie[Ve]()}),[]);(0,pe.O)({active:d&&u,closeHandler:S,ref:p,excludedSelectors:w,ignoreKeydown:!0});const b=(0,l.yK)((e=>({[Fe]:{border:u?void 0:`1px solid ${e.regularDividerColor}`,borderRadius:3,padding:u?"1px":void 0,background:u?e[Ae]:m?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:u?e.marginDiscussionSelectedShadow:void 0,width:c.Z,willChange:"transform",transition:"transform 150ms",transform:u?"translateX(-20px)":m?"translateX(-5px)":void 0,cursor:u?void 0:"pointer"}})),[m,u]),y=(0,s.useCallback)((async e=>{u||(De.trackClickDiscussion(g,{from:Pe}),await a(e,t))}),[a,t,u,g]);return s.createElement("div",{style:b[Fe],onClick:y,ref:p,className:A.marginDiscussionItem},i()(_e.default,{store:t,blockStore:o,format:fe.O2.Margin,isFirst:!1,isOnly:!1,[Ee]:!1,[Te]:Pe,showAllRepliesAfterTimestamp:n,[Be]:f,collapsed:!u}))}const Ne=s.memo(Oe),Ue=o(85).a$o,We=o(85).D7I;function ze(e){window.__c={n:"MarginDiscussionItem"};const{discussionData:t,isLastItem:o,isDiscussionSelected:n,discussionItemElementMap:i}=e,r=(0,l.yK)((e=>({discussionContainer:{transition:"background 300ms ease\n\t\t\t\t"+(t.hide?"":", top 200ms ease-in-out"),top:t.offsetTop,position:"absolute",paddingBottom:o?c.Vs:c.wo,zIndex:n?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,n,o]);let a;const d=t.type;"existing"===d?a=s[We](Ne,I()({},e,{discussionData:t})):"new"===d?a=s[We](ke,I()({},e,{discussionData:t})):"grouped"===d?a=s[We](me,I()({},e,{discussionData:t})):(0,M.unreachable)(d);const u=(0,s.useCallback)((()=>{x.Z.setState({source:"margin_comments",[Ue]:[t.id]})}),[t.id]),m=(0,s.useCallback)((()=>{x.Z.setState({[Ue]:[]})}),[]),p=(0,s.useCallback)((e=>{i.set(t.id,e)}),[t.id,i]);return s[We]("div",{style:r.discussionContainer,onMouseEnter:u,onMouseLeave:m,ref:p},a)}const He=s.memo(ze),je=o(85).XLC,Ge=o(85).qc1,$e=o(85).PR5,Xe=o(85).c0M,Je=o(85).DZV,qe=o(85).hDW,Qe=o(85).xPG,Ye=o(85).QmD,et=o(85).iDK,tt=o(85).Bgg,ot=`.${f.PageMentionTokenClassName}, .${f.LinkTokenClassName}`;function nt(e){let{pageBlockStore:t,timeMounted:o,[tt]:n,animating:d,pageViewBlockAccessor:u,width:m}=e;window.__c={n:"MarginCommentsContent"};const f=(0,r.O7)(),D=(0,s.useRef)(null),I=(0,s.useRef)(new Map),M=(0,s.useRef)(new Map),R=(0,a.VK)((()=>x.Z.getFirstSelectedDiscussionId()),[]),_=(0,s.useCallback)((async(e,o)=>{(0,S.mouseDidMoveAfterLastMouseDown)()||e.target instanceof Element&&e.target.closest(ot)||await w.openDiscussion({discussionStore:o,currentBlockStore:t,environment:f,analyticsFrom:"margin_comments",currentEl:D[et]})}),[t,f]),[B,T]=(0,s.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[E,P]=(0,s.useState)(!1),{WindowSizeStore:A}=f,F=h.R6(f.device.isElectronMac);(0,s.useEffect)((()=>{if(!n)return;const e=new g.Z((()=>({selectableRectMap:k.Z[Ye].selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:Z.ZP[Ye].isAnimating,windowHeight:A[Ye].height})),{[Qe]:"effectDataStore"}),o=new g.Z((()=>c.EM[Ye]),{[Qe]:"discussionStoresStore"}),i=new g.Z((()=>{const e=C.Z[Ye];if(e.open&&e.rect&&b.Z.isBlockInFrame(e[qe]))return{[qe]:e[qe],[Je]:e[Je]}}),{[Qe]:"newMarginDiscussionArgsStore"}),s=new g.Z((()=>y.Z.getFramePageFirstSelectedDiscussionId()),{[Qe]:"selectedDiscussionIdStore"});let r=!1;const a=(0,p.debounce)((()=>{const{selectableRectMap:n,pageContentStores:a,sidebarIsAnimating:l,windowHeight:m}=e[Ye],p=o[Ye],g=i[Ye],f=s[Ye];if(d||l)return;const h=u();if(!(h&&D[et]&&n&&n.size))return;(0,c.H0)({discussionStores:p,pageContentStores:a,marginDiscussionItemRefs:I[et],selectedDiscussionId:f,newMarginDiscussionArgs:g,marginContainerElement:D[et],pageViewBlockElement:h,onComputeComplete:(e,t)=>{r||(M[et]=t,E||P(!0),T(e))},computedOnce:E,topbarHeight:F,windowHeight:m,isFullWidth:t.isFullWidth(),prevSelectedDiscussionId:B.selectedDiscussion,previousDiscussionElements:M[et]})}),5);return e[Xe](a),o[Xe](a),s[Xe](a),i[Xe](a),()=>{r=!0,e[$e](a),o[$e](a),s[$e](a),i[$e](a)}}),[n,d,u,E,t,B.selectedDiscussion,A,F]);const V=(0,l.yK)((e=>({gradientOverlay:{position:"absolute",[Ge]:"none",width:"100%",height:"100%",top:"-5px",background:`linear-gradient(to bottom, ${e.contentBackground} 0px, ${e[je]} 15px)`},marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:5,paddingBottom:5,paddingLeft:c.fS,paddingRight:c.fS,width:m-2*c.fS,flexShrink:0,height:"100%",position:"relative",[Ge]:"none",zIndex:v.marginCommentContent}})),[m]);return s.createElement("div",{style:V.marginCommentsContainer,ref:D},B.data.map(((e,t)=>i()(He,{discussionData:e,timeMounted:o,onClick:_,[tt]:n,discussionItemElementMap:I[et],isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===R,isLastItem:t===B.data.length-1},`margin-discussion-${e.id}`))),i()("div",{style:V.gradientOverlay}))}const it=s.memo(nt),st=o(85).Bgg;function rt(e){let{pageBlockStore:t,[st]:o,pageViewBlockAccessor:n,context:p}=e;window.__c={n:"MarginCommentsSection"};const[g,f]=(0,s.useState)(!1),h=(0,r.O7)(),v=(0,s.useMemo)((()=>(new Date).getTime()),[]),w=(0,a.VK)((()=>t.isFullWidth()||p===u.S.CollectionPageView),[p,t]),S=(0,a.VK)((()=>{if(!w)return{position:"absolute",right:(0,c.oS)(h,(0,d.isInPeekRenderer)(t),(0,d.isInFrameWhenSidePeekOpen)(t))}}),[w,h,t]),b=(0,s.useCallback)((()=>{f(!0)}),[]),y=(0,s.useCallback)((()=>{f(!1)}),[]),x=(0,l.yK)((()=>({marginCommentsSection:{display:o||g?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?c.QB:0,...S}})),[o,g,S]);return i()(m.Z,{[st]:!0,animationStyle:{opacity:o?1:0},onAnimationStart:b,onAnimationEnd:y,render:()=>i()("div",{style:x.marginCommentsSection},void 0,i()(it,{pageBlockStore:t,timeMounted:v,[st]:o,animating:g,pageViewBlockAccessor:n,width:c.QB}))})}},56940:(e,t,o)=>{o.d(t,{Z:()=>k});var n=o(83355),i=o(1302),s=o(24677),r=o(98104),a=o(80935),l=o(63334),d=o(27724),c=o(24666);const u=o(85).ZG6,m=o(85).mPA,p=o(85).t5q,g=o(85).kzQ,f=o(85).Wp_,h=o(85).P0R,v=o(85).l81,w=o(85).Gnd,S=o(85).QmD,b=o(85).NHZ,y=o(85).yKO,x=o(85).XtO;class C extends n.Z{constructor(){super(...arguments),this.storeTypes={[x]:l.Z},this[y]=()=>{const{savedHref:e,savedSelectionStoreState:t,[b]:o}=this[w][x][S];window[v].href===e&&(this[h].ignoreBlockSelection&&t&&d.default[f]({...d.default[S],...t}),o&&"editing"===o.mode&&c.default[f]({...c.default[S],...o})),this[g]()}}willMount(){this[h][p]&&(this[m]=document.createElement(m),this[m].style.position="fixed",this[m].style.top="-9999px",this[m].style.left="-9999px",document.body.appendChild(this[m])),this[h].capture&&(this.saveSelection(),this[h][p]&&i.default[u]((()=>{this[m].focus()})))}willUpdate(e){this[h].capture?e.capture||(e[y]?this[y]():this[g]()):e.capture&&(this.saveSelection(),this[h][p]&&i.default[u]((()=>{this[m].focus()})))}willUnmount(){this[h].capture&&(this[h][y]?this[y]():this[g]()),this[h][p]&&document.body.removeChild(this[m])}renderComponent(){return this[h].render(this[y])}saveSelection(){this[w][x][f]({...this[w][x][S],savedHref:window[v].href,savedSelectionStoreState:d.default.cloneState(),[b]:c.default.cloneState(),savedTextSelectionRect:a.getSelectionRect()}),this[h].ignoreBlockSelection?s.clear(this.environment):r.clear(this.environment)}[g](){this[w][x][f]({...this[w][x][S],savedHref:void 0,savedSelectionStoreState:void 0,[b]:void 0,savedTextSelectionRect:void 0});const e=this[m];i.default[u]((()=>{e&&document.activeElement===e&&e.blur()}))}}C.displayName="IgnoreSelectionArea";const k=C},74136:(e,t,o)=>{o.d(t,{Z:()=>p});var n=o(97464),i=o.n(n),s=o(77094),r=o.n(s),a=o(67294),l=o(480),d=o(24405),c=o(64921);const u=o(85).rGB,m=o(85).sI1;function p(e){window.__c={n:"Pill"};const t=(0,l.Fy)(),o=(0,d.yK)((e=>({sharedStyle:{display:"flex",alignItems:"center",borderRadius:3},[m]:{padding:"2px 6px",borderRadius:3,color:e.mediumTextColor,background:e.defaultBadgeBackground,fontSize:t.isMobile?11:9,lineHeight:t.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",whiteSpace:"nowrap"}})),[t.isAndroid,t.isMobile]);return t.isMobile?r()(c.Z,{style:{...o.sharedStyle,...e.mobileStyle},disabled:void 0===e.onClick},void 0,r()("div",{style:{...o[m],...e[m]}},void 0,e[u])):a.createElement(c.Z,i()({style:{...o.sharedStyle,...e.desktopStyle},disabled:void 0===e.onClick},e),r()("div",{style:{...o[m],...e[m]}},void 0,e[u]))}},14568:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(35431);class i extends n.Z{}const s=new i},63334:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(49085);class i extends n.default{getInitialState(){return{}}}const s=i}}]);